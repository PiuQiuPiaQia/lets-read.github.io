"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BasePreferences=void 0;var _app_options=require("./app_options.js");class BasePreferences{constructor(){if(this.constructor===BasePreferences)throw new Error("Cannot initialize BasePreferences.");Object.defineProperty(this,"defaults",{value:Object.freeze({annotationMode:2,cursorToolOnLoad:0,defaultZoomValue:"",disablePageLabels:!1,enablePermissions:!1,enablePrintAutoRotate:!0,enableScripting:!0,externalLinkTarget:0,historyUpdateUrl:!1,ignoreDestinationZoom:!1,pdfBugEnabled:!1,renderer:"canvas",sidebarViewOnLoad:-1,scrollModeOnLoad:-1,spreadModeOnLoad:-1,textLayerMode:1,useOnlyCssZoom:!1,viewerCssTheme:0,viewOnLoad:0,disableAutoFetch:!1,disableFontFace:!1,disableRange:!1,disableStream:!1,enableXfa:!0}),writable:!1,enumerable:!0,configurable:!1}),this.prefs=Object.create(null),this._initializedPromise=this._readFromStorage(this.defaults).then((e=>{for(const t in this.defaults){const r=e?.[t];typeof r===typeof this.defaults[t]&&(this.prefs[t]=r)}}))}async _writeToStorage(e){throw new Error("Not implemented: _writeToStorage")}async _readFromStorage(e){throw new Error("Not implemented: _readFromStorage")}async reset(){return await this._initializedPromise,this.prefs=Object.create(null),this._writeToStorage(this.defaults)}async set(e,t){await this._initializedPromise;const r=this.defaults[e];if(void 0===r)throw new Error(`Set preference: "${e}" is undefined.`);if(void 0===t)throw new Error("Set preference: no value is specified.");const i=typeof t,s=typeof r;if(i!==s){if("number"!==i||"string"!==s)throw new Error(`Set preference: "${t}" is a ${i}, expected a ${s}.`);t=t.toString()}else if("number"===i&&!Number.isInteger(t))throw new Error(`Set preference: "${t}" must be an integer.`);return this.prefs[e]=t,this._writeToStorage(this.prefs)}async get(e){await this._initializedPromise;const t=this.defaults[e],r=this.prefs[e];if(void 0===t)throw new Error(`Get preference: "${e}" is undefined.`);return void 0!==r?r:t}async getAll(){await this._initializedPromise;const e=Object.create(null);for(const t in this.defaults){const r=this.prefs[t];e[t]=void 0!==r?r:this.defaults[t]}return e}}exports.BasePreferences=BasePreferences;