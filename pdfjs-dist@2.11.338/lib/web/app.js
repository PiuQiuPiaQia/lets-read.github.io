"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PDFViewerApplication=exports.PDFPrintServiceFactory=exports.DefaultExternalServices=void 0;var _ui_utils=require("./ui_utils.js"),_app_options=require("./app_options.js"),_pdf=require("../pdf"),_pdf_cursor_tools=require("./pdf_cursor_tools.js"),_pdf_rendering_queue=require("./pdf_rendering_queue.js"),_overlay_manager=require("./overlay_manager.js"),_password_prompt=require("./password_prompt.js"),_pdf_attachment_viewer=require("./pdf_attachment_viewer.js"),_pdf_document_properties=require("./pdf_document_properties.js"),_pdf_find_bar=require("./pdf_find_bar.js"),_pdf_find_controller=require("./pdf_find_controller.js"),_pdf_history=require("./pdf_history.js"),_pdf_layer_viewer=require("./pdf_layer_viewer.js"),_pdf_link_service=require("./pdf_link_service.js"),_pdf_outline_viewer=require("./pdf_outline_viewer.js"),_pdf_presentation_mode=require("./pdf_presentation_mode.js"),_pdf_scripting_manager=require("./pdf_scripting_manager.js"),_pdf_sidebar=require("./pdf_sidebar.js"),_pdf_sidebar_resizer=require("./pdf_sidebar_resizer.js"),_pdf_thumbnail_viewer=require("./pdf_thumbnail_viewer.js"),_pdf_viewer=require("./pdf_viewer.js"),_secondary_toolbar=require("./secondary_toolbar.js"),_toolbar=require("./toolbar.js"),_view_history=require("./view_history.js");const DISABLE_AUTO_FETCH_LOADING_BAR_TIMEOUT=5e3,FORCE_PAGES_LOADED_TIMEOUT=1e4,WHEEL_ZOOM_DISABLED_TIMEOUT=1e3,ENABLE_PERMISSIONS_CLASS="enablePermissions",ViewOnLoad={UNKNOWN:-1,PREVIOUS:0,INITIAL:1},ViewerCssTheme={AUTOMATIC:0,LIGHT:1,DARK:2},KNOWN_VERSIONS=["1.0","1.1","1.2","1.3","1.4","1.5","1.6","1.7","1.8","1.9","2.0","2.1","2.2","2.3"],KNOWN_GENERATORS=["acrobat distiller","acrobat pdfwriter","adobe livecycle","adobe pdf library","adobe photoshop","ghostscript","tcpdf","cairo","dvipdfm","dvips","pdftex","pdfkit","itext","prince","quarkxpress","mac os x","microsoft","openoffice","oracle","luradocument","pdf-xchange","antenna house","aspose.cells","fpdf"];class DefaultExternalServices{constructor(){throw new Error("Cannot initialize DefaultExternalServices.")}static updateFindControlState(e){}static updateFindMatchesCount(e){}static initPassiveLoading(e){}static async fallback(e){}static reportTelemetry(e){}static createDownloadManager(e){throw new Error("Not implemented: createDownloadManager")}static createPreferences(){throw new Error("Not implemented: createPreferences")}static createL10n(e){throw new Error("Not implemented: createL10n")}static createScripting(e){throw new Error("Not implemented: createScripting")}static get supportsIntegratedFind(){return(0,_pdf.shadow)(this,"supportsIntegratedFind",!1)}static get supportsDocumentFonts(){return(0,_pdf.shadow)(this,"supportsDocumentFonts",!0)}static get supportedMouseWheelZoomModifierKeys(){return(0,_pdf.shadow)(this,"supportedMouseWheelZoomModifierKeys",{ctrlKey:!0,metaKey:!0})}static get isInAutomation(){return(0,_pdf.shadow)(this,"isInAutomation",!1)}}exports.DefaultExternalServices=DefaultExternalServices;const PDFViewerApplication={initialBookmark:document.location.hash.substring(1),_initializedCapability:(0,_pdf.createPromiseCapability)(),_fellback:!1,appConfig:null,pdfDocument:null,pdfLoadingTask:null,printService:null,pdfViewer:null,pdfThumbnailViewer:null,pdfRenderingQueue:null,pdfPresentationMode:null,pdfDocumentProperties:null,pdfLinkService:null,pdfHistory:null,pdfSidebar:null,pdfSidebarResizer:null,pdfOutlineViewer:null,pdfAttachmentViewer:null,pdfLayerViewer:null,pdfCursorTools:null,pdfScriptingManager:null,store:null,downloadManager:null,overlayManager:null,preferences:null,toolbar:null,secondaryToolbar:null,eventBus:null,l10n:null,isInitialViewSet:!1,downloadComplete:!1,isViewerEmbedded:window.parent!==window,url:"",baseUrl:"",_downloadUrl:"",externalServices:DefaultExternalServices,_boundEvents:Object.create(null),documentInfo:null,metadata:null,_contentDispositionFilename:null,_contentLength:null,_saveInProgress:!1,_wheelUnusedTicks:0,_idleCallbacks:new Set,async initialize(e){this.preferences=this.externalServices.createPreferences(),this.appConfig=e,await this._readPreferences(),await this._parseHashParameters(),this._forceCssTheme(),await this._initializeL10n(),this.isViewerEmbedded&&_app_options.AppOptions.get("externalLinkTarget")===_pdf.LinkTarget.NONE&&_app_options.AppOptions.set("externalLinkTarget",_pdf.LinkTarget.TOP),await this._initializeViewerComponents(),this.bindEvents(),this.bindWindowEvents();const i=e.appContainer||document.documentElement;this.l10n.translate(i).then((()=>{this.eventBus.dispatch("localized",{source:this})})),this._initializedCapability.resolve()},async _readPreferences(){if(!_app_options.AppOptions.get("disablePreferences")){_app_options.AppOptions._hasUserOptions()&&console.warn('_readPreferences: The Preferences may override manually set AppOptions; please use the "disablePreferences"-option in order to prevent that.');try{_app_options.AppOptions.setAll(await this.preferences.getAll())}catch(e){console.error(`_readPreferences: "${e?.message}".`)}}},async _parseHashParameters(){if(!_app_options.AppOptions.get("pdfBugEnabled"))return;const e=document.location.hash.substring(1);if(!e)return;const i=(0,_ui_utils.parseQueryString)(e),t=[];if("true"===i.get("disableworker")&&t.push(loadFakeWorker()),i.has("disablerange")&&_app_options.AppOptions.set("disableRange","true"===i.get("disablerange")),i.has("disablestream")&&_app_options.AppOptions.set("disableStream","true"===i.get("disablestream")),i.has("disableautofetch")&&_app_options.AppOptions.set("disableAutoFetch","true"===i.get("disableautofetch")),i.has("disablefontface")&&_app_options.AppOptions.set("disableFontFace","true"===i.get("disablefontface")),i.has("disablehistory")&&_app_options.AppOptions.set("disableHistory","true"===i.get("disablehistory")),i.has("verbosity")&&_app_options.AppOptions.set("verbosity",0|i.get("verbosity")),i.has("textlayer"))switch(i.get("textlayer")){case"off":_app_options.AppOptions.set("textLayerMode",_ui_utils.TextLayerMode.DISABLE);break;case"visible":case"shadow":case"hover":const e=this.appConfig.viewerContainer;e.classList.add(`textLayer-${i.get("textlayer")}`);break}if(i.has("pdfbug")){_app_options.AppOptions.set("pdfBug",!0),_app_options.AppOptions.set("fontExtraProperties",!0);const e=i.get("pdfbug").split(",");t.push(initPDFBug(e))}if(i.has("locale")&&_app_options.AppOptions.set("locale",i.get("locale")),0!==t.length)try{await Promise.all(t)}catch(n){console.error(`_parseHashParameters: "${n.message}".`)}},async _initializeL10n(){this.l10n=this.externalServices.createL10n({locale:_app_options.AppOptions.get("locale")});const e=await this.l10n.getDirection();document.getElementsByTagName("html")[0].dir=e},_forceCssTheme(){const e=_app_options.AppOptions.get("viewerCssTheme");if(e!==ViewerCssTheme.AUTOMATIC&&Object.values(ViewerCssTheme).includes(e))try{const i=document.styleSheets[0],t=i?.cssRules||[],n="prefers-color-scheme",o=`(${n}: dark)`,r=new RegExp(`^@media \\(${n}: dark\\) {\\n\\s*([\\w\\s-.,:;/\\\\{}()]+)\\n}$`);for(let a=0,s=t.length;a<s;a++){const n=t[a];if(n instanceof CSSMediaRule&&n.media?.[0]===o){if(e===ViewerCssTheme.LIGHT)return void i.deleteRule(a);const t=r.exec(n.cssText);return void(t?.[1]&&(i.deleteRule(a),i.insertRule(t[1],a)))}}}catch(i){console.error(`_forceCssTheme: "${i?.message}".`)}},async _initializeViewerComponents(){const{appConfig:e,externalServices:i}=this;let t;t=e.eventBus?e.eventBus:i.isInAutomation?new _ui_utils.AutomationEventBus:new _ui_utils.EventBus,this.eventBus=t,this.overlayManager=new _overlay_manager.OverlayManager;const n=new _pdf_rendering_queue.PDFRenderingQueue;n.onIdle=this._cleanup.bind(this),this.pdfRenderingQueue=n;const o=new _pdf_link_service.PDFLinkService({eventBus:t,externalLinkTarget:_app_options.AppOptions.get("externalLinkTarget"),externalLinkRel:_app_options.AppOptions.get("externalLinkRel"),ignoreDestinationZoom:_app_options.AppOptions.get("ignoreDestinationZoom")});this.pdfLinkService=o;const r=i.createDownloadManager();this.downloadManager=r;const a=new _pdf_find_controller.PDFFindController({linkService:o,eventBus:t});this.findController=a;const s=new _pdf_scripting_manager.PDFScriptingManager({eventBus:t,sandboxBundleSrc:_app_options.AppOptions.get("sandboxBundleSrc"),scriptingFactory:i,docPropertiesLookup:this._scriptingDocProperties.bind(this)});this.pdfScriptingManager=s;const p=e.mainContainer,l=e.viewerContainer;this.pdfViewer=new _pdf_viewer.PDFViewer({container:p,viewer:l,eventBus:t,renderingQueue:n,linkService:o,downloadManager:r,findController:a,scriptingManager:_app_options.AppOptions.get("enableScripting")&&s,renderer:_app_options.AppOptions.get("renderer"),l10n:this.l10n,textLayerMode:_app_options.AppOptions.get("textLayerMode"),annotationMode:_app_options.AppOptions.get("annotationMode"),imageResourcesPath:_app_options.AppOptions.get("imageResourcesPath"),enablePrintAutoRotate:_app_options.AppOptions.get("enablePrintAutoRotate"),useOnlyCssZoom:_app_options.AppOptions.get("useOnlyCssZoom"),maxCanvasPixels:_app_options.AppOptions.get("maxCanvasPixels")}),n.setViewer(this.pdfViewer),o.setViewer(this.pdfViewer),s.setViewer(this.pdfViewer),this.pdfThumbnailViewer=new _pdf_thumbnail_viewer.PDFThumbnailViewer({container:e.sidebar.thumbnailView,eventBus:t,renderingQueue:n,linkService:o,l10n:this.l10n}),n.setThumbnailViewer(this.pdfThumbnailViewer),this.isViewerEmbedded||_app_options.AppOptions.get("disableHistory")||(this.pdfHistory=new _pdf_history.PDFHistory({linkService:o,eventBus:t}),o.setHistory(this.pdfHistory)),this.supportsIntegratedFind||(this.findBar=new _pdf_find_bar.PDFFindBar(e.findBar,t,this.l10n)),this.pdfDocumentProperties=new _pdf_document_properties.PDFDocumentProperties(e.documentProperties,this.overlayManager,t,this.l10n),this.pdfCursorTools=new _pdf_cursor_tools.PDFCursorTools({container:p,eventBus:t,cursorToolOnLoad:_app_options.AppOptions.get("cursorToolOnLoad")}),this.toolbar=new _toolbar.Toolbar(e.toolbar,t,this.l10n),this.secondaryToolbar=new _secondary_toolbar.SecondaryToolbar(e.secondaryToolbar,p,t),this.supportsFullscreen&&(this.pdfPresentationMode=new _pdf_presentation_mode.PDFPresentationMode({container:p,pdfViewer:this.pdfViewer,eventBus:t})),this.passwordPrompt=new _password_prompt.PasswordPrompt(e.passwordOverlay,this.overlayManager,this.l10n,this.isViewerEmbedded),this.pdfOutlineViewer=new _pdf_outline_viewer.PDFOutlineViewer({container:e.sidebar.outlineView,eventBus:t,linkService:o}),this.pdfAttachmentViewer=new _pdf_attachment_viewer.PDFAttachmentViewer({container:e.sidebar.attachmentsView,eventBus:t,downloadManager:r}),this.pdfLayerViewer=new _pdf_layer_viewer.PDFLayerViewer({container:e.sidebar.layersView,eventBus:t,l10n:this.l10n}),this.pdfSidebar=new _pdf_sidebar.PDFSidebar({elements:e.sidebar,pdfViewer:this.pdfViewer,pdfThumbnailViewer:this.pdfThumbnailViewer,eventBus:t,l10n:this.l10n}),this.pdfSidebar.onToggled=this.forceRendering.bind(this),this.pdfSidebarResizer=new _pdf_sidebar_resizer.PDFSidebarResizer(e.sidebarResizer,t,this.l10n)},run(e){this.initialize(e).then(webViewerInitialized)},get initialized(){return this._initializedCapability.settled},get initializedPromise(){return this._initializedCapability.promise},zoomIn(e){this.pdfViewer.isInPresentationMode||this.pdfViewer.increaseScale(e)},zoomOut(e){this.pdfViewer.isInPresentationMode||this.pdfViewer.decreaseScale(e)},zoomReset(){this.pdfViewer.isInPresentationMode||(this.pdfViewer.currentScaleValue=_ui_utils.DEFAULT_SCALE_VALUE)},get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0},get page(){return this.pdfViewer.currentPageNumber},set page(e){this.pdfViewer.currentPageNumber=e},get supportsPrinting(){return PDFPrintServiceFactory.instance.supportsPrinting},get supportsFullscreen(){return(0,_pdf.shadow)(this,"supportsFullscreen",document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled)},get supportsIntegratedFind(){return this.externalServices.supportsIntegratedFind},get supportsDocumentFonts(){return this.externalServices.supportsDocumentFonts},get loadingBar(){const e=new _ui_utils.ProgressBar("#loadingBar");return(0,_pdf.shadow)(this,"loadingBar",e)},get supportedMouseWheelZoomModifierKeys(){return this.externalServices.supportedMouseWheelZoomModifierKeys},initPassiveLoading(){throw new Error("Not implemented: initPassiveLoading")},setTitleUsingUrl(e="",i=null){this.url=e,this.baseUrl=e.split("#")[0],i&&(this._downloadUrl=i===e?this.baseUrl:i.split("#")[0]);let t=(0,_pdf.getPdfFilenameFromUrl)(e,"");if(!t)try{t=decodeURIComponent((0,_pdf.getFilenameFromUrl)(e))||e}catch(n){t=e}this.setTitle(t)},setTitle(e){this.isViewerEmbedded||(document.title=e)},get _docFilename(){return this._contentDispositionFilename||(0,_pdf.getPdfFilenameFromUrl)(this.url)},_hideViewBookmark(){const{toolbar:e,secondaryToolbar:i}=this.appConfig;e.viewBookmark.hidden=!0,i.viewBookmarkButton.hidden=!0},_cancelIdleCallbacks(){if(this._idleCallbacks.size){for(const e of this._idleCallbacks)window.cancelIdleCallback(e);this._idleCallbacks.clear()}},async close(){this._unblockDocumentLoadEvent(),this._hideViewBookmark();const{container:e}=this.appConfig.errorWrapper;if(e.hidden=!0,!this.pdfLoadingTask)return;if(this.pdfDocument?.annotationStorage.size>0&&this._annotationStorageModified)try{await this.save({sourceEventType:"save"})}catch(t){}const i=[];i.push(this.pdfLoadingTask.destroy()),this.pdfLoadingTask=null,this.pdfDocument&&(this.pdfDocument=null,this.pdfThumbnailViewer.setDocument(null),this.pdfViewer.setDocument(null),this.pdfLinkService.setDocument(null),this.pdfDocumentProperties.setDocument(null)),webViewerResetPermissions(),this.pdfLinkService.externalLinkEnabled=!0,this._fellback=!1,this.store=null,this.isInitialViewSet=!1,this.downloadComplete=!1,this.url="",this.baseUrl="",this._downloadUrl="",this.documentInfo=null,this.metadata=null,this._contentDispositionFilename=null,this._contentLength=null,this._saveInProgress=!1,this._cancelIdleCallbacks(),i.push(this.pdfScriptingManager.destroyPromise),this.pdfSidebar.reset(),this.pdfOutlineViewer.reset(),this.pdfAttachmentViewer.reset(),this.pdfLayerViewer.reset(),this.pdfHistory?.reset(),this.findBar?.reset(),this.toolbar.reset(),this.secondaryToolbar.reset(),"undefined"!==typeof PDFBug&&PDFBug.cleanup(),await Promise.all(i)},async open(e,i){this.pdfLoadingTask&&await this.close();const t=_app_options.AppOptions.getAll(_app_options.OptionKind.WORKER);for(const a in t)_pdf.GlobalWorkerOptions[a]=t[a];const n=Object.create(null);"string"===typeof e?(this.setTitleUsingUrl(e,e),n.url=e):e&&"byteLength"in e?n.data=e:e.url&&e.originalUrl&&(this.setTitleUsingUrl(e.originalUrl,e.url),n.url=e.url);const o=_app_options.AppOptions.getAll(_app_options.OptionKind.API);for(const a in o){let e=o[a];n[a]=e}if(i)for(const a in i)n[a]=i[a];const r=(0,_pdf.getDocument)(n);return this.pdfLoadingTask=r,r.onPassword=(e,i)=>{this.pdfLinkService.externalLinkEnabled=!1,this.passwordPrompt.setUpdateCallback(e,i),this.passwordPrompt.open()},r.onProgress=({loaded:e,total:i})=>{this.progress(e/i)},r.onUnsupportedFeature=this.fallback.bind(this),r.promise.then((e=>{this.load(e)}),(e=>{if(r!==this.pdfLoadingTask)return;let i="loading_error";return e instanceof _pdf.InvalidPDFException?i="invalid_file_error":e instanceof _pdf.MissingPDFException?i="missing_file_error":e instanceof _pdf.UnexpectedResponseException&&(i="unexpected_response_error"),this.l10n.get(i).then((i=>{throw this._documentError(i,{message:e?.message}),e}))}))},_ensureDownloadComplete(){if(!this.pdfDocument||!this.downloadComplete)throw new Error("PDF document not downloaded.")},async download({sourceEventType:e="download"}={}){const i=this._downloadUrl,t=this._docFilename;try{this._ensureDownloadComplete();const n=await this.pdfDocument.getData(),o=new Blob([n],{type:"application/pdf"});await this.downloadManager.download(o,i,t,e)}catch(n){await this.downloadManager.downloadUrl(i,t)}},async save({sourceEventType:e="download"}={}){if(this._saveInProgress)return;this._saveInProgress=!0,await this.pdfScriptingManager.dispatchWillSave();const i=this._downloadUrl,t=this._docFilename;try{this._ensureDownloadComplete();const n=await this.pdfDocument.saveDocument(),o=new Blob([n],{type:"application/pdf"});await this.downloadManager.download(o,i,t,e)}catch(n){console.error(`Error when saving the document: ${n.message}`),await this.download({sourceEventType:e})}finally{await this.pdfScriptingManager.dispatchDidSave(),this._saveInProgress=!1}},downloadOrSave(e){this.pdfDocument?.annotationStorage.size>0?this.save(e):this.download(e)},fallback(e){this.externalServices.reportTelemetry({type:"unsupportedFeature",featureId:e}),this._fellback||(this._fellback=!0,this.externalServices.fallback({featureId:e,url:this.baseUrl}).then((e=>{e&&this.download({sourceEventType:"download"})})))},_documentError(e,i=null){this._unblockDocumentLoadEvent(),this._otherError(e,i)},_otherError(e,i=null){const t=[this.l10n.get("error_version_info",{version:_pdf.version||"?",build:_pdf.build||"?"})];i&&(t.push(this.l10n.get("error_message",{message:i.message})),i.stack?t.push(this.l10n.get("error_stack",{stack:i.stack})):(i.filename&&t.push(this.l10n.get("error_file",{file:i.filename})),i.lineNumber&&t.push(this.l10n.get("error_line",{line:i.lineNumber}))));const n=this.appConfig.errorWrapper,o=n.container;o.hidden=!1;const r=n.errorMessage;r.textContent=e;const a=n.closeButton;a.onclick=function(){o.hidden=!0};const s=n.errorMoreInfo,p=n.moreInfoButton,l=n.lessInfoButton;p.onclick=function(){s.hidden=!1,p.hidden=!0,l.hidden=!1,s.style.height=s.scrollHeight+"px"},l.onclick=function(){s.hidden=!0,p.hidden=!1,l.hidden=!0},p.oncontextmenu=_ui_utils.noContextMenuHandler,l.oncontextmenu=_ui_utils.noContextMenuHandler,a.oncontextmenu=_ui_utils.noContextMenuHandler,p.hidden=!1,l.hidden=!0,Promise.all(t).then((e=>{s.value=e.join("\n")}))},progress(e){if(this.downloadComplete)return;const i=Math.round(100*e);if(i>this.loadingBar.percent||isNaN(i)){this.loadingBar.percent=i;const e=this.pdfDocument?this.pdfDocument.loadingParams.disableAutoFetch:_app_options.AppOptions.get("disableAutoFetch");e&&i&&(this.disableAutoFetchLoadingBarTimeout&&(clearTimeout(this.disableAutoFetchLoadingBarTimeout),this.disableAutoFetchLoadingBarTimeout=null),this.loadingBar.show(),this.disableAutoFetchLoadingBarTimeout=setTimeout((()=>{this.loadingBar.hide(),this.disableAutoFetchLoadingBarTimeout=null}),DISABLE_AUTO_FETCH_LOADING_BAR_TIMEOUT))}},load(e){this.pdfDocument=e,e.getDownloadInfo().then((({length:e})=>{this._contentLength=e,this.downloadComplete=!0,this.loadingBar.hide(),a.then((()=>{this.eventBus.dispatch("documentloaded",{source:this})}))}));const i=e.getPageLayout().catch((function(){})),t=e.getPageMode().catch((function(){})),n=e.getOpenAction().catch((function(){}));let o;this.toolbar.setPagesCount(e.numPages,!1),this.secondaryToolbar.setPagesCount(e.numPages),o=null,this.pdfLinkService.setDocument(e,o),this.pdfDocumentProperties.setDocument(e,this.url);const r=this.pdfViewer;r.setDocument(e);const{firstPagePromise:a,onePageRendered:s,pagesPromise:p}=r,l=this.pdfThumbnailViewer;l.setDocument(e);const d=(this.store=new _view_history.ViewHistory(e.fingerprints[0])).getMultiple({page:null,zoom:_ui_utils.DEFAULT_SCALE_VALUE,scrollLeft:"0",scrollTop:"0",rotation:null,sidebarView:_ui_utils.SidebarView.UNKNOWN,scrollMode:_ui_utils.ScrollMode.UNKNOWN,spreadMode:_ui_utils.SpreadMode.UNKNOWN}).catch((()=>Object.create(null)));a.then((o=>{this.loadingBar.setWidth(this.appConfig.viewerContainer),this._initializeAnnotationStorageCallbacks(e),Promise.all([_ui_utils.animationStarted,d,i,t,n]).then((async([i,t,n,o,a])=>{const s=_app_options.AppOptions.get("viewOnLoad");this._initializePdfHistory({fingerprint:e.fingerprints[0],viewOnLoad:s,initialDest:a?.dest});const l=this.initialBookmark,d=_app_options.AppOptions.get("defaultZoomValue");let c=d?`zoom=${d}`:null,u=null,w=_app_options.AppOptions.get("sidebarViewOnLoad"),h=_app_options.AppOptions.get("scrollModeOnLoad"),f=_app_options.AppOptions.get("spreadModeOnLoad");t.page&&s!==ViewOnLoad.INITIAL&&(c=`page=${t.page}&zoom=${d||t.zoom},${t.scrollLeft},${t.scrollTop}`,u=parseInt(t.rotation,10),w===_ui_utils.SidebarView.UNKNOWN&&(w=0|t.sidebarView),h===_ui_utils.ScrollMode.UNKNOWN&&(h=0|t.scrollMode),f===_ui_utils.SpreadMode.UNKNOWN&&(f=0|t.spreadMode)),o&&w===_ui_utils.SidebarView.UNKNOWN&&(w=(0,_ui_utils.apiPageModeToSidebarView)(o)),n&&f===_ui_utils.SpreadMode.UNKNOWN&&(f=(0,_ui_utils.apiPageLayoutToSpreadMode)(n)),this.setInitialView(c,{rotation:u,sidebarView:w,scrollMode:h,spreadMode:f}),this.eventBus.dispatch("documentinit",{source:this}),this.isViewerEmbedded||r.focus(),this._initializePermissions(e),await Promise.race([p,new Promise((e=>{setTimeout(e,FORCE_PAGES_LOADED_TIMEOUT)}))]),(l||c)&&(r.hasEqualPageSizes||(this.initialBookmark=l,r.currentScaleValue=r.currentScaleValue,this.setInitialView(c)))})).catch((()=>{this.setInitialView()})).then((function(){r.update()}))})),p.then((()=>{this._unblockDocumentLoadEvent(),this._initializeAutoPrint(e,n)})),s.then((()=>{if(e.getOutline().then((i=>{e===this.pdfDocument&&this.pdfOutlineViewer.render({outline:i,pdfDocument:e})})),e.getAttachments().then((i=>{e===this.pdfDocument&&this.pdfAttachmentViewer.render({attachments:i})})),r.optionalContentConfigPromise.then((i=>{e===this.pdfDocument&&this.pdfLayerViewer.render({optionalContentConfig:i,pdfDocument:e})})),"requestIdleCallback"in window){const i=window.requestIdleCallback((()=>{this._collectTelemetry(e),this._idleCallbacks.delete(i)}),{timeout:1e3});this._idleCallbacks.add(i)}})),this._initializePageLabels(e),this._initializeMetadata(e)},async _scriptingDocProperties(e){return(this.documentInfo||(await new Promise((e=>{this.eventBus._on("metadataloaded",e,{once:!0})})),e===this.pdfDocument))&&(this._contentLength||(await new Promise((e=>{this.eventBus._on("documentloaded",e,{once:!0})})),e===this.pdfDocument))?{...this.documentInfo,baseURL:this.baseUrl,filesize:this._contentLength,filename:this._docFilename,metadata:this.metadata?.getRaw(),authors:this.metadata?.get("dc:creator"),numPages:this.pagesCount,URL:this.url}:null},async _collectTelemetry(e){const i=await this.pdfDocument.getMarkInfo();if(e!==this.pdfDocument)return;const t=i?.Marked||!1;this.externalServices.reportTelemetry({type:"tagged",tagged:t})},async _initializeAutoPrint(e,i){const[t,n]=await Promise.all([i,this.pdfViewer.enableScripting?null:e.getJavaScript()]);if(e!==this.pdfDocument)return;let o=!1;if("Print"===t?.action&&(o=!0),n&&(n.some((e=>!!e&&(console.warn("Warning: JavaScript support is not enabled"),this.fallback(_pdf.UNSUPPORTED_FEATURES.javaScript),!0))),!o))for(const r of n)if(r&&_ui_utils.AutoPrintRegExp.test(r)){o=!0;break}o&&this.triggerPrinting()},async _initializeMetadata(e){const{info:i,metadata:t,contentDispositionFilename:n,contentLength:o}=await e.getMetadata();if(e!==this.pdfDocument)return;this.documentInfo=i,this.metadata=t,this._contentDispositionFilename??=n,this._contentLength??=o,console.log(`PDF ${e.fingerprints[0]} [${i.PDFFormatVersion} ${(i.Producer||"-").trim()} / ${(i.Creator||"-").trim()}] (PDF.js: ${_pdf.version||"-"})`);let r=i?.Title;const a=t?.get("dc:title");a&&("Untitled"===a||/[\uFFF0-\uFFFF]/g.test(a)||(r=a)),r?this.setTitle(`${r} - ${n||document.title}`):n&&this.setTitle(n),!i.IsXFAPresent||i.IsAcroFormPresent||e.isPureXfa?!i.IsAcroFormPresent&&!i.IsXFAPresent||this.pdfViewer.renderForms||(console.warn("Warning: Interactive form support is not enabled"),this.fallback(_pdf.UNSUPPORTED_FEATURES.forms)):(e.loadingParams.enableXfa?console.warn("Warning: XFA Foreground documents are not supported"):console.warn("Warning: XFA support is not enabled"),this.fallback(_pdf.UNSUPPORTED_FEATURES.forms)),i.IsSignaturesPresent&&(console.warn("Warning: Digital signatures validation is not supported"),this.fallback(_pdf.UNSUPPORTED_FEATURES.signatures));let s="other";KNOWN_VERSIONS.includes(i.PDFFormatVersion)&&(s=`v${i.PDFFormatVersion.replace(".","_")}`);let p="other";if(i.Producer){const e=i.Producer.toLowerCase();KNOWN_GENERATORS.some((function(i){return!!e.includes(i)&&(p=i.replace(/[ .-]/g,"_"),!0)}))}let l=null;i.IsXFAPresent?l="xfa":i.IsAcroFormPresent&&(l="acroform"),this.externalServices.reportTelemetry({type:"documentInfo",version:s,generator:p,formType:l}),this.eventBus.dispatch("metadataloaded",{source:this})},async _initializePageLabels(e){const i=await e.getPageLabels();if(e!==this.pdfDocument)return;if(!i||_app_options.AppOptions.get("disablePageLabels"))return;const t=i.length;if(t!==this.pagesCount)return void console.error("The number of Page Labels does not match the number of pages in the document.");let n=0;while(n<t&&i[n]===(n+1).toString())n++;if(n===t)return;const{pdfViewer:o,pdfThumbnailViewer:r,toolbar:a}=this;o.setPageLabels(i),r.setPageLabels(i),a.setPagesCount(t,!0),a.setPageNumber(o.currentPageNumber,o.currentPageLabel)},_initializePdfHistory({fingerprint:e,viewOnLoad:i,initialDest:t=null}){this.pdfHistory&&(this.pdfHistory.initialize({fingerprint:e,resetHistory:i===ViewOnLoad.INITIAL,updateUrl:_app_options.AppOptions.get("historyUpdateUrl")}),this.pdfHistory.initialBookmark&&(this.initialBookmark=this.pdfHistory.initialBookmark,this.initialRotation=this.pdfHistory.initialRotation),t&&!this.initialBookmark&&i===ViewOnLoad.UNKNOWN&&(this.initialBookmark=JSON.stringify(t),this.pdfHistory.push({explicitDest:t,pageNumber:null})))},async _initializePermissions(e){const i=await e.getPermissions();e===this.pdfDocument&&i&&_app_options.AppOptions.get("enablePermissions")&&(i.includes(_pdf.PermissionFlag.COPY)||this.appConfig.viewerContainer.classList.add(ENABLE_PERMISSIONS_CLASS))},_initializeAnnotationStorageCallbacks(e){if(e!==this.pdfDocument)return;const{annotationStorage:i}=e;i.onSetModified=()=>{window.addEventListener("beforeunload",beforeUnload),this._annotationStorageModified=!0},i.onResetModified=()=>{window.removeEventListener("beforeunload",beforeUnload),delete this._annotationStorageModified}},setInitialView(e,{rotation:i,sidebarView:t,scrollMode:n,spreadMode:o}={}){const r=e=>{(0,_ui_utils.isValidRotation)(e)&&(this.pdfViewer.pagesRotation=e)},a=(e,i)=>{(0,_ui_utils.isValidScrollMode)(e)&&(this.pdfViewer.scrollMode=e),(0,_ui_utils.isValidSpreadMode)(i)&&(this.pdfViewer.spreadMode=i)};this.isInitialViewSet=!0,this.pdfSidebar.setInitialView(t),a(n,o),this.initialBookmark?(r(this.initialRotation),delete this.initialRotation,this.pdfLinkService.setHash(this.initialBookmark),this.initialBookmark=null):e&&(r(i),this.pdfLinkService.setHash(e)),this.toolbar.setPageNumber(this.pdfViewer.currentPageNumber,this.pdfViewer.currentPageLabel),this.secondaryToolbar.setPageNumber(this.pdfViewer.currentPageNumber),this.pdfViewer.currentScaleValue||(this.pdfViewer.currentScaleValue=_ui_utils.DEFAULT_SCALE_VALUE)},_cleanup(){this.pdfDocument&&(this.pdfViewer.cleanup(),this.pdfThumbnailViewer.cleanup(),this.pdfDocument.cleanup(this.pdfViewer.renderer===_ui_utils.RendererType.SVG))},forceRendering(){this.pdfRenderingQueue.printing=!!this.printService,this.pdfRenderingQueue.isThumbnailViewEnabled=this.pdfSidebar.isThumbnailViewVisible,this.pdfRenderingQueue.renderHighestPriority()},beforePrint(){if(this.pdfScriptingManager.dispatchWillPrint(),this.printService)return;if(!this.supportsPrinting)return void this.l10n.get("printing_not_supported").then((e=>{this._otherError(e)}));if(!this.pdfViewer.pageViewsReady)return void this.l10n.get("printing_not_ready").then((e=>{window.alert(e)}));const e=this.pdfViewer.getPagesOverview(),i=this.appConfig.printContainer,t=_app_options.AppOptions.get("printResolution"),n=this.pdfViewer.optionalContentConfigPromise,o=PDFPrintServiceFactory.instance.createPrintService(this.pdfDocument,e,i,t,n,this.l10n);this.printService=o,this.forceRendering(),o.layout(),this.externalServices.reportTelemetry({type:"print"})},afterPrint(){this.pdfScriptingManager.dispatchDidPrint(),this.printService&&(this.printService.destroy(),this.printService=null,this.pdfDocument?.annotationStorage.resetModified()),this.forceRendering()},rotatePages(e){this.pdfViewer.pagesRotation+=e},requestPresentationMode(){this.pdfPresentationMode?.request()},triggerPrinting(){this.supportsPrinting&&window.print()},bindEvents(){const{eventBus:e,_boundEvents:i}=this;i.beforePrint=this.beforePrint.bind(this),i.afterPrint=this.afterPrint.bind(this),e._on("resize",webViewerResize),e._on("hashchange",webViewerHashchange),e._on("beforeprint",i.beforePrint),e._on("afterprint",i.afterPrint),e._on("pagerendered",webViewerPageRendered),e._on("updateviewarea",webViewerUpdateViewarea),e._on("pagechanging",webViewerPageChanging),e._on("scalechanging",webViewerScaleChanging),e._on("rotationchanging",webViewerRotationChanging),e._on("sidebarviewchanged",webViewerSidebarViewChanged),e._on("pagemode",webViewerPageMode),e._on("namedaction",webViewerNamedAction),e._on("presentationmodechanged",webViewerPresentationModeChanged),e._on("presentationmode",webViewerPresentationMode),e._on("print",webViewerPrint),e._on("download",webViewerDownload),e._on("save",webViewerSave),e._on("firstpage",webViewerFirstPage),e._on("lastpage",webViewerLastPage),e._on("nextpage",webViewerNextPage),e._on("previouspage",webViewerPreviousPage),e._on("zoomin",webViewerZoomIn),e._on("zoomout",webViewerZoomOut),e._on("zoomreset",webViewerZoomReset),e._on("pagenumberchanged",webViewerPageNumberChanged),e._on("scalechanged",webViewerScaleChanged),e._on("rotatecw",webViewerRotateCw),e._on("rotateccw",webViewerRotateCcw),e._on("optionalcontentconfig",webViewerOptionalContentConfig),e._on("switchscrollmode",webViewerSwitchScrollMode),e._on("scrollmodechanged",webViewerScrollModeChanged),e._on("switchspreadmode",webViewerSwitchSpreadMode),e._on("spreadmodechanged",webViewerSpreadModeChanged),e._on("documentproperties",webViewerDocumentProperties),e._on("find",webViewerFind),e._on("findfromurlhash",webViewerFindFromUrlHash),e._on("updatefindmatchescount",webViewerUpdateFindMatchesCount),e._on("updatefindcontrolstate",webViewerUpdateFindControlState),_app_options.AppOptions.get("pdfBug")&&(i.reportPageStatsPDFBug=reportPageStatsPDFBug,e._on("pagerendered",i.reportPageStatsPDFBug),e._on("pagechanging",i.reportPageStatsPDFBug)),e._on("fileinputchange",webViewerFileInputChange),e._on("openfile",webViewerOpenFile)},bindWindowEvents(){const{eventBus:e,_boundEvents:i}=this;i.windowResize=()=>{e.dispatch("resize",{source:window})},i.windowHashChange=()=>{e.dispatch("hashchange",{source:window,hash:document.location.hash.substring(1)})},i.windowBeforePrint=()=>{e.dispatch("beforeprint",{source:window})},i.windowAfterPrint=()=>{e.dispatch("afterprint",{source:window})},i.windowUpdateFromSandbox=i=>{e.dispatch("updatefromsandbox",{source:window,detail:i.detail})},window.addEventListener("visibilitychange",webViewerVisibilityChange),window.addEventListener("wheel",webViewerWheel,{passive:!1}),window.addEventListener("touchstart",webViewerTouchStart,{passive:!1}),window.addEventListener("click",webViewerClick),window.addEventListener("keydown",webViewerKeyDown),window.addEventListener("resize",i.windowResize),window.addEventListener("hashchange",i.windowHashChange),window.addEventListener("beforeprint",i.windowBeforePrint),window.addEventListener("afterprint",i.windowAfterPrint),window.addEventListener("updatefromsandbox",i.windowUpdateFromSandbox)},unbindEvents(){const{eventBus:e,_boundEvents:i}=this;e._off("resize",webViewerResize),e._off("hashchange",webViewerHashchange),e._off("beforeprint",i.beforePrint),e._off("afterprint",i.afterPrint),e._off("pagerendered",webViewerPageRendered),e._off("updateviewarea",webViewerUpdateViewarea),e._off("pagechanging",webViewerPageChanging),e._off("scalechanging",webViewerScaleChanging),e._off("rotationchanging",webViewerRotationChanging),e._off("sidebarviewchanged",webViewerSidebarViewChanged),e._off("pagemode",webViewerPageMode),e._off("namedaction",webViewerNamedAction),e._off("presentationmodechanged",webViewerPresentationModeChanged),e._off("presentationmode",webViewerPresentationMode),e._off("print",webViewerPrint),e._off("download",webViewerDownload),e._off("save",webViewerSave),e._off("firstpage",webViewerFirstPage),e._off("lastpage",webViewerLastPage),e._off("nextpage",webViewerNextPage),e._off("previouspage",webViewerPreviousPage),e._off("zoomin",webViewerZoomIn),e._off("zoomout",webViewerZoomOut),e._off("zoomreset",webViewerZoomReset),e._off("pagenumberchanged",webViewerPageNumberChanged),e._off("scalechanged",webViewerScaleChanged),e._off("rotatecw",webViewerRotateCw),e._off("rotateccw",webViewerRotateCcw),e._off("optionalcontentconfig",webViewerOptionalContentConfig),e._off("switchscrollmode",webViewerSwitchScrollMode),e._off("scrollmodechanged",webViewerScrollModeChanged),e._off("switchspreadmode",webViewerSwitchSpreadMode),e._off("spreadmodechanged",webViewerSpreadModeChanged),e._off("documentproperties",webViewerDocumentProperties),e._off("find",webViewerFind),e._off("findfromurlhash",webViewerFindFromUrlHash),e._off("updatefindmatchescount",webViewerUpdateFindMatchesCount),e._off("updatefindcontrolstate",webViewerUpdateFindControlState),i.reportPageStatsPDFBug&&(e._off("pagerendered",i.reportPageStatsPDFBug),e._off("pagechanging",i.reportPageStatsPDFBug),i.reportPageStatsPDFBug=null),e._off("fileinputchange",webViewerFileInputChange),e._off("openfile",webViewerOpenFile),i.beforePrint=null,i.afterPrint=null},unbindWindowEvents(){const{_boundEvents:e}=this;window.removeEventListener("visibilitychange",webViewerVisibilityChange),window.removeEventListener("wheel",webViewerWheel,{passive:!1}),window.removeEventListener("touchstart",webViewerTouchStart,{passive:!1}),window.removeEventListener("click",webViewerClick),window.removeEventListener("keydown",webViewerKeyDown),window.removeEventListener("resize",e.windowResize),window.removeEventListener("hashchange",e.windowHashChange),window.removeEventListener("beforeprint",e.windowBeforePrint),window.removeEventListener("afterprint",e.windowAfterPrint),window.removeEventListener("updatefromsandbox",e.windowUpdateFromSandbox),e.windowResize=null,e.windowHashChange=null,e.windowBeforePrint=null,e.windowAfterPrint=null,e.windowUpdateFromSandbox=null},accumulateWheelTicks(e){(this._wheelUnusedTicks>0&&e<0||this._wheelUnusedTicks<0&&e>0)&&(this._wheelUnusedTicks=0),this._wheelUnusedTicks+=e;const i=Math.sign(this._wheelUnusedTicks)*Math.floor(Math.abs(this._wheelUnusedTicks));return this._wheelUnusedTicks-=i,i},_unblockDocumentLoadEvent(){document.blockUnblockOnload&&document.blockUnblockOnload(!1),this._unblockDocumentLoadEvent=()=>{}},get scriptingReady(){return this.pdfScriptingManager.ready}};let validateFileURL,webViewerFileInputChange,webViewerOpenFile;exports.PDFViewerApplication=PDFViewerApplication;{const e=["null","http://mozilla.github.io","https://mozilla.github.io"];validateFileURL=function(i){if(void 0!==i)try{const t=new URL(window.location.href).origin||"null";if(e.includes(t))return;const{origin:n,protocol:o}=new URL(i,window.location.href);if(n!==t&&"blob:"!==o)throw new Error("file origin does not match viewer's")}catch(t){throw PDFViewerApplication.l10n.get("loading_error").then((e=>{PDFViewerApplication._documentError(e,{message:t?.message})})),t}}}async function loadFakeWorker(){_pdf.GlobalWorkerOptions.workerSrc||(_pdf.GlobalWorkerOptions.workerSrc=_app_options.AppOptions.get("workerSrc")),await(0,_pdf.loadScript)(_pdf.PDFWorker.workerSrc)}async function initPDFBug(e){const{debuggerScriptPath:i,mainContainer:t}=PDFViewerApplication.appConfig;await(0,_pdf.loadScript)(i),PDFBug.init({OPS:_pdf.OPS},t,e)}function reportPageStatsPDFBug({pageNumber:e}){if("undefined"===typeof Stats||!Stats.enabled)return;const i=PDFViewerApplication.pdfViewer.getPageView(e-1),t=i?.pdfPage?.stats;t&&Stats.add(e,t)}function webViewerInitialized(){const e=PDFViewerApplication.appConfig;let i;const t=document.location.search.substring(1),n=(0,_ui_utils.parseQueryString)(t);i=n.get("file")??_app_options.AppOptions.get("defaultUrl"),validateFileURL(i);const o=document.createElement("input");o.id=e.openFileInputName,o.className="fileInput",o.setAttribute("type","file"),o.oncontextmenu=_ui_utils.noContextMenuHandler,document.body.appendChild(o),window.File&&window.FileReader&&window.FileList&&window.Blob?o.value=null:(e.toolbar.openFile.hidden=!0,e.secondaryToolbar.openFileButton.hidden=!0),o.addEventListener("change",(function(e){const i=e.target.files;i&&0!==i.length&&PDFViewerApplication.eventBus.dispatch("fileinputchange",{source:this,fileInput:e.target})})),e.mainContainer.addEventListener("dragover",(function(e){e.preventDefault(),e.dataTransfer.dropEffect="move"})),e.mainContainer.addEventListener("drop",(function(e){e.preventDefault();const i=e.dataTransfer.files;i&&0!==i.length&&PDFViewerApplication.eventBus.dispatch("fileinputchange",{source:this,fileInput:e.dataTransfer})})),PDFViewerApplication.supportsDocumentFonts||(_app_options.AppOptions.set("disableFontFace",!0),PDFViewerApplication.l10n.get("web_fonts_disabled").then((e=>{console.warn(e)}))),PDFViewerApplication.supportsPrinting||(e.toolbar.print.classList.add("hidden"),e.secondaryToolbar.printButton.classList.add("hidden")),PDFViewerApplication.supportsFullscreen||(e.toolbar.presentationModeButton.classList.add("hidden"),e.secondaryToolbar.presentationModeButton.classList.add("hidden")),PDFViewerApplication.supportsIntegratedFind&&e.toolbar.viewFind.classList.add("hidden"),e.mainContainer.addEventListener("transitionend",(function(e){e.target===this&&PDFViewerApplication.eventBus.dispatch("resize",{source:this})}),!0);try{webViewerOpenFileViaURL(i)}catch(r){PDFViewerApplication.l10n.get("loading_error").then((e=>{PDFViewerApplication._documentError(e,r)}))}}function webViewerOpenFileViaURL(e){e?PDFViewerApplication.open(e):PDFViewerApplication._hideViewBookmark()}function webViewerResetPermissions(){const{appConfig:e}=PDFViewerApplication;e&&e.viewerContainer.classList.remove(ENABLE_PERMISSIONS_CLASS)}function webViewerPageRendered({pageNumber:e,timestamp:i,error:t}){if(e===PDFViewerApplication.page&&PDFViewerApplication.toolbar.updateLoadingIndicatorState(!1),PDFViewerApplication.pdfSidebar.isThumbnailViewVisible){const i=PDFViewerApplication.pdfViewer.getPageView(e-1),t=PDFViewerApplication.pdfThumbnailViewer.getThumbnail(e-1);i&&t&&t.setImage(i)}t&&PDFViewerApplication.l10n.get("rendering_error").then((e=>{PDFViewerApplication._otherError(e,t)})),PDFViewerApplication.externalServices.reportTelemetry({type:"pageInfo",timestamp:i}),PDFViewerApplication.pdfDocument.getStats().then((function(e){PDFViewerApplication.externalServices.reportTelemetry({type:"documentStats",stats:e})}))}function webViewerPageMode({mode:e}){let i;switch(e){case"thumbs":i=_ui_utils.SidebarView.THUMBS;break;case"bookmarks":case"outline":i=_ui_utils.SidebarView.OUTLINE;break;case"attachments":i=_ui_utils.SidebarView.ATTACHMENTS;break;case"layers":i=_ui_utils.SidebarView.LAYERS;break;case"none":i=_ui_utils.SidebarView.NONE;break;default:return void console.error('Invalid "pagemode" hash parameter: '+e)}PDFViewerApplication.pdfSidebar.switchView(i,!0)}function webViewerNamedAction(e){switch(e.action){case"GoToPage":PDFViewerApplication.appConfig.toolbar.pageNumber.select();break;case"Find":PDFViewerApplication.supportsIntegratedFind||PDFViewerApplication.findBar.toggle();break;case"Print":PDFViewerApplication.triggerPrinting();break;case"SaveAs":webViewerSave();break}}function webViewerPresentationModeChanged(e){PDFViewerApplication.pdfViewer.presentationModeState=e.state}function webViewerSidebarViewChanged(e){PDFViewerApplication.pdfRenderingQueue.isThumbnailViewEnabled=PDFViewerApplication.pdfSidebar.isThumbnailViewVisible;const i=PDFViewerApplication.store;i&&PDFViewerApplication.isInitialViewSet&&i.set("sidebarView",e.view).catch((function(){}))}function webViewerUpdateViewarea(e){const i=e.location,t=PDFViewerApplication.store;t&&PDFViewerApplication.isInitialViewSet&&t.setMultiple({page:i.pageNumber,zoom:i.scale,scrollLeft:i.left,scrollTop:i.top,rotation:i.rotation}).catch((function(){}));const n=PDFViewerApplication.pdfLinkService.getAnchorUrl(i.pdfOpenParams);PDFViewerApplication.appConfig.toolbar.viewBookmark.href=n,PDFViewerApplication.appConfig.secondaryToolbar.viewBookmarkButton.href=n;const o=PDFViewerApplication.pdfViewer.getPageView(PDFViewerApplication.page-1),r=o?.renderingState!==_pdf_rendering_queue.RenderingStates.FINISHED;PDFViewerApplication.toolbar.updateLoadingIndicatorState(r)}function webViewerScrollModeChanged(e){const i=PDFViewerApplication.store;i&&PDFViewerApplication.isInitialViewSet&&i.set("scrollMode",e.mode).catch((function(){}))}function webViewerSpreadModeChanged(e){const i=PDFViewerApplication.store;i&&PDFViewerApplication.isInitialViewSet&&i.set("spreadMode",e.mode).catch((function(){}))}function webViewerResize(){const{pdfDocument:e,pdfViewer:i}=PDFViewerApplication;if(!e)return;const t=i.currentScaleValue;"auto"!==t&&"page-fit"!==t&&"page-width"!==t||(i.currentScaleValue=t),i.update()}function webViewerHashchange(e){const i=e.hash;i&&(PDFViewerApplication.isInitialViewSet?PDFViewerApplication.pdfHistory?.popStateInProgress||PDFViewerApplication.pdfLinkService.setHash(i):PDFViewerApplication.initialBookmark=i)}function webViewerPresentationMode(){PDFViewerApplication.requestPresentationMode()}function webViewerPrint(){PDFViewerApplication.triggerPrinting()}function webViewerDownload(){PDFViewerApplication.downloadOrSave({sourceEventType:"download"})}function webViewerSave(){PDFViewerApplication.downloadOrSave({sourceEventType:"save"})}function webViewerFirstPage(){PDFViewerApplication.pdfDocument&&(PDFViewerApplication.page=1)}function webViewerLastPage(){PDFViewerApplication.pdfDocument&&(PDFViewerApplication.page=PDFViewerApplication.pagesCount)}function webViewerNextPage(){PDFViewerApplication.pdfViewer.nextPage()}function webViewerPreviousPage(){PDFViewerApplication.pdfViewer.previousPage()}function webViewerZoomIn(){PDFViewerApplication.zoomIn()}function webViewerZoomOut(){PDFViewerApplication.zoomOut()}function webViewerZoomReset(){PDFViewerApplication.zoomReset()}function webViewerPageNumberChanged(e){const i=PDFViewerApplication.pdfViewer;""!==e.value&&PDFViewerApplication.pdfLinkService.goToPage(e.value),e.value!==i.currentPageNumber.toString()&&e.value!==i.currentPageLabel&&PDFViewerApplication.toolbar.setPageNumber(i.currentPageNumber,i.currentPageLabel)}function webViewerScaleChanged(e){PDFViewerApplication.pdfViewer.currentScaleValue=e.value}function webViewerRotateCw(){PDFViewerApplication.rotatePages(90)}function webViewerRotateCcw(){PDFViewerApplication.rotatePages(-90)}function webViewerOptionalContentConfig(e){PDFViewerApplication.pdfViewer.optionalContentConfigPromise=e.promise}function webViewerSwitchScrollMode(e){PDFViewerApplication.pdfViewer.scrollMode=e.mode}function webViewerSwitchSpreadMode(e){PDFViewerApplication.pdfViewer.spreadMode=e.mode}function webViewerDocumentProperties(){PDFViewerApplication.pdfDocumentProperties.open()}function webViewerFind(e){PDFViewerApplication.findController.executeCommand("find"+e.type,{query:e.query,phraseSearch:e.phraseSearch,caseSensitive:e.caseSensitive,entireWord:e.entireWord,highlightAll:e.highlightAll,findPrevious:e.findPrevious})}function webViewerFindFromUrlHash(e){PDFViewerApplication.findController.executeCommand("find",{query:e.query,phraseSearch:e.phraseSearch,caseSensitive:!1,entireWord:!1,highlightAll:!0,findPrevious:!1})}function webViewerUpdateFindMatchesCount({matchesCount:e}){PDFViewerApplication.supportsIntegratedFind?PDFViewerApplication.externalServices.updateFindMatchesCount(e):PDFViewerApplication.findBar.updateResultsCount(e)}function webViewerUpdateFindControlState({state:e,previous:i,matchesCount:t,rawQuery:n}){PDFViewerApplication.supportsIntegratedFind?PDFViewerApplication.externalServices.updateFindControlState({result:e,findPrevious:i,matchesCount:t,rawQuery:n}):PDFViewerApplication.findBar.updateUIState(e,i,t)}function webViewerScaleChanging(e){PDFViewerApplication.toolbar.setPageScale(e.presetValue,e.scale),PDFViewerApplication.pdfViewer.update()}function webViewerRotationChanging(e){PDFViewerApplication.pdfThumbnailViewer.pagesRotation=e.pagesRotation,PDFViewerApplication.forceRendering(),PDFViewerApplication.pdfViewer.currentPageNumber=e.pageNumber}function webViewerPageChanging({pageNumber:e,pageLabel:i}){PDFViewerApplication.toolbar.setPageNumber(e,i),PDFViewerApplication.secondaryToolbar.setPageNumber(e),PDFViewerApplication.pdfSidebar.isThumbnailViewVisible&&PDFViewerApplication.pdfThumbnailViewer.scrollThumbnailIntoView(e)}function webViewerVisibilityChange(e){"visible"===document.visibilityState&&setZoomDisabledTimeout()}webViewerFileInputChange=function(e){if(PDFViewerApplication.pdfViewer?.isInPresentationMode)return;const i=e.fileInput.files[0];if(_app_options.compatibilityParams.disableCreateObjectURL){PDFViewerApplication.setTitleUsingUrl(i.name);const e=new FileReader;e.onload=function(e){const i=e.target.result;PDFViewerApplication.open(new Uint8Array(i))},e.readAsArrayBuffer(i)}else{let e=URL.createObjectURL(i);i.name&&(e={url:e,originalUrl:i.name}),PDFViewerApplication.open(e)}},webViewerOpenFile=function(e){const i=PDFViewerApplication.appConfig.openFileInputName;document.getElementById(i).click()};let zoomDisabledTimeout=null;function setZoomDisabledTimeout(){zoomDisabledTimeout&&clearTimeout(zoomDisabledTimeout),zoomDisabledTimeout=setTimeout((function(){zoomDisabledTimeout=null}),WHEEL_ZOOM_DISABLED_TIMEOUT)}function webViewerWheel(e){const{pdfViewer:i,supportedMouseWheelZoomModifierKeys:t}=PDFViewerApplication;if(!i.isInPresentationMode)if(e.ctrlKey&&t.ctrlKey||e.metaKey&&t.metaKey){if(e.preventDefault(),zoomDisabledTimeout||"hidden"===document.visibilityState)return;const t=i.currentScale,n=(0,_ui_utils.normalizeWheelEventDirection)(e);let o=0;if(e.deltaMode===WheelEvent.DOM_DELTA_LINE||e.deltaMode===WheelEvent.DOM_DELTA_PAGE)o=Math.abs(n)>=1?Math.sign(n):PDFViewerApplication.accumulateWheelTicks(n);else{const e=30;o=PDFViewerApplication.accumulateWheelTicks(n/e)}o<0?PDFViewerApplication.zoomOut(-o):o>0&&PDFViewerApplication.zoomIn(o);const r=i.currentScale;if(t!==r){const n=r/t-1,o=i.container.getBoundingClientRect(),a=e.clientX-o.left,s=e.clientY-o.top;i.container.scrollLeft+=a*n,i.container.scrollTop+=s*n}}else setZoomDisabledTimeout()}function webViewerTouchStart(e){e.touches.length>1&&e.preventDefault()}function webViewerClick(e){if(!PDFViewerApplication.secondaryToolbar.isOpen)return;const i=PDFViewerApplication.appConfig;(PDFViewerApplication.pdfViewer.containsElement(e.target)||i.toolbar.container.contains(e.target)&&e.target!==i.secondaryToolbar.toggleButton)&&PDFViewerApplication.secondaryToolbar.close()}function webViewerKeyDown(e){if(PDFViewerApplication.overlayManager.active)return;let i=!1,t=!1;const n=(e.ctrlKey?1:0)|(e.altKey?2:0)|(e.shiftKey?4:0)|(e.metaKey?8:0),o=PDFViewerApplication.pdfViewer,r=o?.isInPresentationMode;if(1===n||8===n||5===n||12===n)switch(e.keyCode){case 70:PDFViewerApplication.supportsIntegratedFind||e.shiftKey||(PDFViewerApplication.findBar.open(),i=!0);break;case 71:if(!PDFViewerApplication.supportsIntegratedFind){const e=PDFViewerApplication.findController.state;e&&PDFViewerApplication.findController.executeCommand("findagain",{query:e.query,phraseSearch:e.phraseSearch,caseSensitive:e.caseSensitive,entireWord:e.entireWord,highlightAll:e.highlightAll,findPrevious:5===n||12===n}),i=!0}break;case 61:case 107:case 187:case 171:r||PDFViewerApplication.zoomIn(),i=!0;break;case 173:case 109:case 189:r||PDFViewerApplication.zoomOut(),i=!0;break;case 48:case 96:r||(setTimeout((function(){PDFViewerApplication.zoomReset()})),i=!1);break;case 38:(r||PDFViewerApplication.page>1)&&(PDFViewerApplication.page=1,i=!0,t=!0);break;case 40:(r||PDFViewerApplication.page<PDFViewerApplication.pagesCount)&&(PDFViewerApplication.page=PDFViewerApplication.pagesCount,i=!0,t=!0);break}const{eventBus:a}=PDFViewerApplication;if(1===n||8===n)switch(e.keyCode){case 83:a.dispatch("download",{source:window}),i=!0;break;case 79:a.dispatch("openfile",{source:window}),i=!0;break}if(3===n||10===n)switch(e.keyCode){case 80:PDFViewerApplication.requestPresentationMode(),i=!0;break;case 71:PDFViewerApplication.appConfig.toolbar.pageNumber.select(),i=!0;break}if(i)return t&&!r&&o.focus(),void e.preventDefault();const s=(0,_ui_utils.getActiveOrFocusedElement)(),p=s?.tagName.toUpperCase();if("INPUT"!==p&&"TEXTAREA"!==p&&"SELECT"!==p&&!s?.isContentEditable||27===e.keyCode){if(0===n){let n=0,a=!1;switch(e.keyCode){case 38:case 33:o.isVerticalScrollbarEnabled&&(a=!0),n=-1;break;case 8:r||(a=!0),n=-1;break;case 37:o.isHorizontalScrollbarEnabled&&(a=!0);case 75:case 80:n=-1;break;case 27:PDFViewerApplication.secondaryToolbar.isOpen&&(PDFViewerApplication.secondaryToolbar.close(),i=!0),!PDFViewerApplication.supportsIntegratedFind&&PDFViewerApplication.findBar.opened&&(PDFViewerApplication.findBar.close(),i=!0);break;case 40:case 34:o.isVerticalScrollbarEnabled&&(a=!0),n=1;break;case 13:case 32:r||(a=!0),n=1;break;case 39:o.isHorizontalScrollbarEnabled&&(a=!0);case 74:case 78:n=1;break;case 36:(r||PDFViewerApplication.page>1)&&(PDFViewerApplication.page=1,i=!0,t=!0);break;case 35:(r||PDFViewerApplication.page<PDFViewerApplication.pagesCount)&&(PDFViewerApplication.page=PDFViewerApplication.pagesCount,i=!0,t=!0);break;case 83:PDFViewerApplication.pdfCursorTools.switchTool(_pdf_cursor_tools.CursorTool.SELECT);break;case 72:PDFViewerApplication.pdfCursorTools.switchTool(_pdf_cursor_tools.CursorTool.HAND);break;case 82:PDFViewerApplication.rotatePages(90);break;case 115:PDFViewerApplication.pdfSidebar.toggle();break}0===n||a&&"page-fit"!==o.currentScaleValue||(n>0?o.nextPage():o.previousPage(),i=!0)}if(4===n)switch(e.keyCode){case 13:case 32:if(!r&&"page-fit"!==o.currentScaleValue)break;PDFViewerApplication.page>1&&PDFViewerApplication.page--,i=!0;break;case 82:PDFViewerApplication.rotatePages(-90);break}i||r||(e.keyCode>=33&&e.keyCode<=40||32===e.keyCode&&"BUTTON"!==p)&&(t=!0),t&&!o.containsElement(s)&&o.focus(),i&&e.preventDefault()}}function beforeUnload(e){return e.preventDefault(),e.returnValue="",!1}const PDFPrintServiceFactory={instance:{supportsPrinting:!1,createPrintService(){throw new Error("Not implemented: createPrintService")}}};exports.PDFPrintServiceFactory=PDFPrintServiceFactory;