"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SecondaryToolbar=void 0;var _ui_utils=require("./ui_utils.js"),_pdf_cursor_tools=require("./pdf_cursor_tools.js"),_pdf_single_page_viewer=require("./pdf_single_page_viewer.js");class SecondaryToolbar{constructor(e,t,o){this.toolbar=e.toolbar,this.toggleButton=e.toggleButton,this.toolbarButtonContainer=e.toolbarButtonContainer,this.buttons=[{element:e.presentationModeButton,eventName:"presentationmode",close:!0},{element:e.openFileButton,eventName:"openfile",close:!0},{element:e.printButton,eventName:"print",close:!0},{element:e.downloadButton,eventName:"download",close:!0},{element:e.viewBookmarkButton,eventName:null,close:!0},{element:e.firstPageButton,eventName:"firstpage",close:!0},{element:e.lastPageButton,eventName:"lastpage",close:!0},{element:e.pageRotateCwButton,eventName:"rotatecw",close:!1},{element:e.pageRotateCcwButton,eventName:"rotateccw",close:!1},{element:e.cursorSelectToolButton,eventName:"switchcursortool",eventDetails:{tool:_pdf_cursor_tools.CursorTool.SELECT},close:!0},{element:e.cursorHandToolButton,eventName:"switchcursortool",eventDetails:{tool:_pdf_cursor_tools.CursorTool.HAND},close:!0},{element:e.scrollVerticalButton,eventName:"switchscrollmode",eventDetails:{mode:_ui_utils.ScrollMode.VERTICAL},close:!0},{element:e.scrollHorizontalButton,eventName:"switchscrollmode",eventDetails:{mode:_ui_utils.ScrollMode.HORIZONTAL},close:!0},{element:e.scrollWrappedButton,eventName:"switchscrollmode",eventDetails:{mode:_ui_utils.ScrollMode.WRAPPED},close:!0},{element:e.spreadNoneButton,eventName:"switchspreadmode",eventDetails:{mode:_ui_utils.SpreadMode.NONE},close:!0},{element:e.spreadOddButton,eventName:"switchspreadmode",eventDetails:{mode:_ui_utils.SpreadMode.ODD},close:!0},{element:e.spreadEvenButton,eventName:"switchspreadmode",eventDetails:{mode:_ui_utils.SpreadMode.EVEN},close:!0},{element:e.documentPropertiesButton,eventName:"documentproperties",close:!0}],this.items={firstPage:e.firstPageButton,lastPage:e.lastPageButton,pageRotateCw:e.pageRotateCwButton,pageRotateCcw:e.pageRotateCcwButton},this.mainContainer=t,this.eventBus=o,this.opened=!1,this.containerHeight=null,this.previousContainerHeight=null,this.reset(),this._bindClickListeners(),this._bindCursorToolsListener(e),this._bindScrollModeListener(e),this._bindSpreadModeListener(e),this.eventBus._on("resize",this._setMaxHeight.bind(this)),this.eventBus._on("baseviewerinit",(e=>{e.source instanceof _pdf_single_page_viewer.PDFSinglePageViewer?this.toolbarButtonContainer.classList.add("hiddenScrollModeButtons","hiddenSpreadModeButtons"):this.toolbarButtonContainer.classList.remove("hiddenScrollModeButtons","hiddenSpreadModeButtons")}))}get isOpen(){return this.opened}setPageNumber(e){this.pageNumber=e,this._updateUIState()}setPagesCount(e){this.pagesCount=e,this._updateUIState()}reset(){this.pageNumber=0,this.pagesCount=0,this._updateUIState(),this.eventBus.dispatch("secondarytoolbarreset",{source:this})}_updateUIState(){this.items.firstPage.disabled=this.pageNumber<=1,this.items.lastPage.disabled=this.pageNumber>=this.pagesCount,this.items.pageRotateCw.disabled=0===this.pagesCount,this.items.pageRotateCcw.disabled=0===this.pagesCount}_bindClickListeners(){this.toggleButton.addEventListener("click",this.toggle.bind(this));for(const{element:e,eventName:t,close:o,eventDetails:s}of this.buttons)e.addEventListener("click",(e=>{if(null!==t){const e={source:this};for(const t in s)e[t]=s[t];this.eventBus.dispatch(t,e)}o&&this.close()}))}_bindCursorToolsListener(e){this.eventBus._on("cursortoolchanged",(function({tool:t}){e.cursorSelectToolButton.classList.toggle("toggled",t===_pdf_cursor_tools.CursorTool.SELECT),e.cursorHandToolButton.classList.toggle("toggled",t===_pdf_cursor_tools.CursorTool.HAND)}))}_bindScrollModeListener(e){function t({mode:t}){e.scrollVerticalButton.classList.toggle("toggled",t===_ui_utils.ScrollMode.VERTICAL),e.scrollHorizontalButton.classList.toggle("toggled",t===_ui_utils.ScrollMode.HORIZONTAL),e.scrollWrappedButton.classList.toggle("toggled",t===_ui_utils.ScrollMode.WRAPPED);const o=t===_ui_utils.ScrollMode.HORIZONTAL;e.spreadNoneButton.disabled=o,e.spreadOddButton.disabled=o,e.spreadEvenButton.disabled=o}this.eventBus._on("scrollmodechanged",t),this.eventBus._on("secondarytoolbarreset",(e=>{e.source===this&&t({mode:_ui_utils.ScrollMode.VERTICAL})}))}_bindSpreadModeListener(e){function t({mode:t}){e.spreadNoneButton.classList.toggle("toggled",t===_ui_utils.SpreadMode.NONE),e.spreadOddButton.classList.toggle("toggled",t===_ui_utils.SpreadMode.ODD),e.spreadEvenButton.classList.toggle("toggled",t===_ui_utils.SpreadMode.EVEN)}this.eventBus._on("spreadmodechanged",t),this.eventBus._on("secondarytoolbarreset",(e=>{e.source===this&&t({mode:_ui_utils.SpreadMode.NONE})}))}open(){this.opened||(this.opened=!0,this._setMaxHeight(),this.toggleButton.classList.add("toggled"),this.toggleButton.setAttribute("aria-expanded","true"),this.toolbar.classList.remove("hidden"))}close(){this.opened&&(this.opened=!1,this.toolbar.classList.add("hidden"),this.toggleButton.classList.remove("toggled"),this.toggleButton.setAttribute("aria-expanded","false"))}toggle(){this.opened?this.close():this.open()}_setMaxHeight(){this.opened&&(this.containerHeight=this.mainContainer.clientHeight,this.containerHeight!==this.previousContainerHeight&&(this.toolbarButtonContainer.style.maxHeight=this.containerHeight-_ui_utils.SCROLLBAR_PADDING+"px",this.previousContainerHeight=this.containerHeight))}}exports.SecondaryToolbar=SecondaryToolbar;