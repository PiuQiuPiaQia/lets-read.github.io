"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.FirefoxPrintService=FirefoxPrintService;var _pdf=require("../pdf"),_print_utils=require("./print_utils.js"),_app=require("./app.js");function composePage(t,e,n,i,o,r){const a=document.createElement("canvas"),s=o/_pdf.PixelsPerInch.PDF;a.width=Math.floor(n.width*s),a.height=Math.floor(n.height*s);const c=document.createElement("div");c.className="printedPage",c.appendChild(a),i.appendChild(c);let l=null;a.mozPrintCallback=function(i){const o=i.context;o.save(),o.fillStyle="rgb(255, 255, 255)",o.fillRect(0,0,a.width,a.height),o.restore();let c=null;t.getPage(e).then((function(t){l&&(l.cancel(),l=null);const e={canvasContext:o,transform:[s,0,0,s,0,0],viewport:t.getViewport({scale:1,rotation:n.rotation}),intent:"print",annotationMode:_pdf.AnnotationMode.ENABLE_STORAGE,optionalContentConfigPromise:r};return l=c=t.render(e),c.promise})).then((function(){l===c&&(l=null),i.done()}),(function(t){t instanceof _pdf.RenderingCancelledException||console.error(t),l===c&&(l.cancel(),l=null),"abort"in i?i.abort():i.done()}))}}function FirefoxPrintService(t,e,n,i,o=null){this.pdfDocument=t,this.pagesOverview=e,this.printContainer=n,this._printResolution=i||150,this._optionalContentConfigPromise=o||t.getOptionalContentConfig()}FirefoxPrintService.prototype={layout(){const{pdfDocument:t,pagesOverview:e,printContainer:n,_printResolution:i,_optionalContentConfigPromise:o}=this,r=document.querySelector("body");if(r.setAttribute("data-pdfjsprinting",!0),t.isPureXfa)(0,_print_utils.getXfaHtmlForPrinting)(n,t);else for(let a=0,s=e.length;a<s;++a)composePage(t,a+1,e[a],n,i,o)},destroy(){this.printContainer.textContent="";const t=document.querySelector("body");t.removeAttribute("data-pdfjsprinting")}},_app.PDFPrintServiceFactory.instance={get supportsPrinting(){const t=document.createElement("canvas"),e="mozPrintCallback"in t;return(0,_pdf.shadow)(this,"supportsPrinting",e)},createPrintService(t,e,n,i,o){return new FirefoxPrintService(t,e,n,i,o)}};