"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Toolbar=void 0;var _ui_utils=require("./ui_utils.js");const PAGE_NUMBER_LOADING_INDICATOR="visiblePageIsLoading";class Toolbar{constructor(e,t,a){this.toolbar=e.container,this.eventBus=t,this.l10n=a,this.buttons=[{element:e.previous,eventName:"previouspage"},{element:e.next,eventName:"nextpage"},{element:e.zoomIn,eventName:"zoomin"},{element:e.zoomOut,eventName:"zoomout"},{element:e.openFile,eventName:"openfile"},{element:e.print,eventName:"print"},{element:e.presentationModeButton,eventName:"presentationmode"},{element:e.download,eventName:"download"},{element:e.viewBookmark,eventName:null}],this.items={numPages:e.numPages,pageNumber:e.pageNumber,scaleSelect:e.scaleSelect,customScaleOption:e.customScaleOption,previous:e.previous,next:e.next,zoomIn:e.zoomIn,zoomOut:e.zoomOut},this._wasLocalized=!1,this.reset(),this._bindListeners()}setPageNumber(e,t){this.pageNumber=e,this.pageLabel=t,this._updateUIState(!1)}setPagesCount(e,t){this.pagesCount=e,this.hasPageLabels=t,this._updateUIState(!0)}setPageScale(e,t){this.pageScaleValue=(e||t).toString(),this.pageScale=t,this._updateUIState(!1)}reset(){this.pageNumber=0,this.pageLabel=null,this.hasPageLabels=!1,this.pagesCount=0,this.pageScaleValue=_ui_utils.DEFAULT_SCALE_VALUE,this.pageScale=_ui_utils.DEFAULT_SCALE,this._updateUIState(!0),this.updateLoadingIndicatorState()}_bindListeners(){const{pageNumber:e,scaleSelect:t}=this.items,a=this;for(const{element:s,eventName:n}of this.buttons)s.addEventListener("click",(e=>{null!==n&&this.eventBus.dispatch(n,{source:this})}));e.addEventListener("click",(function(){this.select()})),e.addEventListener("change",(function(){a.eventBus.dispatch("pagenumberchanged",{source:a,value:this.value})})),t.addEventListener("change",(function(){"custom"!==this.value&&a.eventBus.dispatch("scalechanged",{source:a,value:this.value})})),t.addEventListener("click",(function(e){const t=e.target;this.value===a.pageScaleValue&&"OPTION"===t.tagName.toUpperCase()&&this.blur()})),t.oncontextmenu=_ui_utils.noContextMenuHandler,this.eventBus._on("localized",(()=>{this._wasLocalized=!0,this._adjustScaleWidth(),this._updateUIState(!0)}))}_updateUIState(e=!1){if(!this._wasLocalized)return;const{pageNumber:t,pagesCount:a,pageScaleValue:s,pageScale:n,items:i}=this;e&&(this.hasPageLabels?i.pageNumber.type="text":(i.pageNumber.type="number",this.l10n.get("of_pages",{pagesCount:a}).then((e=>{i.numPages.textContent=e}))),i.pageNumber.max=a),this.hasPageLabels?(i.pageNumber.value=this.pageLabel,this.l10n.get("page_of_pages",{pageNumber:t,pagesCount:a}).then((e=>{i.numPages.textContent=e}))):i.pageNumber.value=t,i.previous.disabled=t<=1,i.next.disabled=t>=a,i.zoomOut.disabled=n<=_ui_utils.MIN_SCALE,i.zoomIn.disabled=n>=_ui_utils.MAX_SCALE,this.l10n.get("page_scale_percent",{scale:Math.round(1e4*n)/100}).then((e=>{let t=!1;for(const a of i.scaleSelect.options)a.value===s?(a.selected=!0,t=!0):a.selected=!1;t||(i.customScaleOption.textContent=e,i.customScaleOption.selected=!0)}))}updateLoadingIndicatorState(e=!1){const t=this.items.pageNumber;t.classList.toggle(PAGE_NUMBER_LOADING_INDICATOR,e)}async _adjustScaleWidth(){const{items:e,l10n:t}=this,a=Promise.all([t.get("page_scale_auto"),t.get("page_scale_actual"),t.get("page_scale_fit"),t.get("page_scale_width")]),s=getComputedStyle(e.scaleSelect),n=parseInt(s.getPropertyValue("--scale-select-container-width"),10),i=parseInt(s.getPropertyValue("--scale-select-overflow"),10);let o=document.createElement("canvas");o.mozOpaque=!0;let l=o.getContext("2d",{alpha:!1});await _ui_utils.animationStarted,l.font=`${s.fontSize} ${s.fontFamily}`;let u=0;for(const c of await a){const{width:e}=l.measureText(c);e>u&&(u=e)}if(u+=2*i,u>n){const e=document.documentElement;e.style.setProperty("--scale-select-container-width",`${u}px`)}o.width=0,o.height=0,o=l=null}}exports.Toolbar=Toolbar;