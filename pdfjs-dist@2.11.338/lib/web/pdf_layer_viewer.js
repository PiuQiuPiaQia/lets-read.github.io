"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PDFLayerViewer=void 0;var _base_tree_viewer=require("./base_tree_viewer.js");class PDFLayerViewer extends _base_tree_viewer.BaseTreeViewer{constructor(e){super(e),this.l10n=e.l10n,this.eventBus._on("resetlayers",this._resetLayers.bind(this)),this.eventBus._on("togglelayerstree",this._toggleAllTreeItems.bind(this))}reset(){super.reset(),this._optionalContentConfig=null}_dispatchEvent(e){this.eventBus.dispatch("layersloaded",{source:this,layersCount:e})}_bindLink(e,{groupId:t,input:n}){const o=()=>{this._optionalContentConfig.setVisibility(t,n.checked),this.eventBus.dispatch("optionalcontentconfig",{source:this,promise:Promise.resolve(this._optionalContentConfig)})};e.onclick=t=>t.target===n?(o(),!0):t.target!==e||(n.checked=!n.checked,o(),!1)}async _setNestedName(e,{name:t=null}){"string"!==typeof t?(e.textContent=await this.l10n.get("additional_layers"),e.style.fontStyle="italic"):e.textContent=this._normalizeTextContent(t)}_addToggleButton(e,{name:t=null}){super._addToggleButton(e,null===t)}_toggleAllTreeItems(){this._optionalContentConfig&&super._toggleAllTreeItems()}render({optionalContentConfig:e,pdfDocument:t}){this._optionalContentConfig&&this.reset(),this._optionalContentConfig=e||null,this._pdfDocument=t||null;const n=e?.getOrder();if(!n)return void this._dispatchEvent(0);const o=document.createDocumentFragment(),s=[{parent:o,groups:n}];let i=0,r=!1;while(s.length>0){const t=s.shift();for(const n of t.groups){const o=document.createElement("div");o.className="treeItem";const a=document.createElement("a");if(o.appendChild(a),"object"===typeof n){r=!0,this._addToggleButton(o,n),this._setNestedName(a,n);const e=document.createElement("div");e.className="treeItems",o.appendChild(e),s.push({parent:e,groups:n.order})}else{const t=e.getGroup(n),o=document.createElement("input");this._bindLink(a,{groupId:n,input:o}),o.type="checkbox",o.id=n,o.checked=t.visible;const s=document.createElement("label");s.setAttribute("for",n),s.textContent=this._normalizeTextContent(t.name),a.appendChild(o),a.appendChild(s),i++}t.parent.appendChild(o)}}this._finishRendering(o,i,r)}async _resetLayers(){if(!this._optionalContentConfig)return;const e=await this._pdfDocument.getOptionalContentConfig();this.eventBus.dispatch("optionalcontentconfig",{source:this,promise:Promise.resolve(e)}),this.render({optionalContentConfig:e,pdfDocument:this._pdfDocument})}}exports.PDFLayerViewer=PDFLayerViewer;