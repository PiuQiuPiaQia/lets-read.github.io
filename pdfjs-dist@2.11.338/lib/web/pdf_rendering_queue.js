"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.RenderingStates=exports.PDFRenderingQueue=void 0;var _pdf=require("../pdf");const CLEANUP_TIMEOUT=3e4,RenderingStates={INITIAL:0,RUNNING:1,PAUSED:2,FINISHED:3};exports.RenderingStates=RenderingStates;class PDFRenderingQueue{constructor(){this.pdfViewer=null,this.pdfThumbnailViewer=null,this.onIdle=null,this.highestPriorityPage=null,this.idleTimeout=null,this.printing=!1,this.isThumbnailViewEnabled=!1}setViewer(e){this.pdfViewer=e}setThumbnailViewer(e){this.pdfThumbnailViewer=e}isHighestPriority(e){return this.highestPriorityPage===e.renderingId}hasViewer(){return!!this.pdfViewer}renderHighestPriority(e){this.idleTimeout&&(clearTimeout(this.idleTimeout),this.idleTimeout=null),this.pdfViewer.forceRendering(e)||this.pdfThumbnailViewer&&this.isThumbnailViewEnabled&&this.pdfThumbnailViewer.forceRendering()||this.printing||this.onIdle&&(this.idleTimeout=setTimeout(this.onIdle.bind(this),CLEANUP_TIMEOUT))}getHighestPriority(e,i,t,r=!1){const n=e.views,s=n.length;if(0===s)return null;for(let l=0;l<s;++l){const e=n[l].view;if(!this.isViewFinished(e))return e}let d=t?e.last.id:e.first.id-2,h=i[d];return h&&!this.isViewFinished(h)||r&&(d+=t?1:-1,h=i[d],h&&!this.isViewFinished(h))?h:null}isViewFinished(e){return e.renderingState===RenderingStates.FINISHED}renderView(e){switch(e.renderingState){case RenderingStates.FINISHED:return!1;case RenderingStates.PAUSED:this.highestPriorityPage=e.renderingId,e.resume();break;case RenderingStates.RUNNING:this.highestPriorityPage=e.renderingId;break;case RenderingStates.INITIAL:this.highestPriorityPage=e.renderingId,e.draw().finally((()=>{this.renderHighestPriority()})).catch((e=>{e instanceof _pdf.RenderingCancelledException||console.error(`renderView: "${e}"`)}));break}return!0}}exports.PDFRenderingQueue=PDFRenderingQueue;