"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.apiPageLayoutToSpreadMode=apiPageLayoutToSpreadMode,exports.apiPageModeToSidebarView=apiPageModeToSidebarView,exports.approximateFraction=approximateFraction,exports.backtrackBeforeAllVisibleElements=backtrackBeforeAllVisibleElements,exports.binarySearchFirstItem=binarySearchFirstItem,exports.getActiveOrFocusedElement=getActiveOrFocusedElement,exports.getOutputScale=getOutputScale,exports.getPageSizeInches=getPageSizeInches,exports.getVisibleElements=getVisibleElements,exports.isPortraitOrientation=isPortraitOrientation,exports.isValidRotation=isValidRotation,exports.isValidScrollMode=isValidScrollMode,exports.isValidSpreadMode=isValidSpreadMode,exports.moveToEndOfArray=moveToEndOfArray,exports.noContextMenuHandler=noContextMenuHandler,exports.normalizeWheelEventDelta=normalizeWheelEventDelta,exports.normalizeWheelEventDirection=normalizeWheelEventDirection,exports.parseQueryString=parseQueryString,exports.roundToDivide=roundToDivide,exports.scrollIntoView=scrollIntoView,exports.waitOnEventOrTimeout=waitOnEventOrTimeout,exports.watchScroll=watchScroll,exports.WaitOnType=exports.VERTICAL_PADDING=exports.UNKNOWN_SCALE=exports.TextLayerMode=exports.SpreadMode=exports.SidebarView=exports.ScrollMode=exports.SCROLLBAR_PADDING=exports.RendererType=exports.ProgressBar=exports.PresentationModeState=exports.MIN_SCALE=exports.MAX_SCALE=exports.MAX_AUTO_SCALE=exports.EventBus=exports.DEFAULT_SCALE_VALUE=exports.DEFAULT_SCALE_DELTA=exports.DEFAULT_SCALE=exports.AutoPrintRegExp=exports.AutomationEventBus=exports.animationStarted=void 0;const DEFAULT_SCALE_VALUE="auto";exports.DEFAULT_SCALE_VALUE=DEFAULT_SCALE_VALUE;const DEFAULT_SCALE=1;exports.DEFAULT_SCALE=DEFAULT_SCALE;const DEFAULT_SCALE_DELTA=1.1;exports.DEFAULT_SCALE_DELTA=DEFAULT_SCALE_DELTA;const MIN_SCALE=.1;exports.MIN_SCALE=MIN_SCALE;const MAX_SCALE=10;exports.MAX_SCALE=MAX_SCALE;const UNKNOWN_SCALE=0;exports.UNKNOWN_SCALE=UNKNOWN_SCALE;const MAX_AUTO_SCALE=1.25;exports.MAX_AUTO_SCALE=MAX_AUTO_SCALE;const SCROLLBAR_PADDING=40;exports.SCROLLBAR_PADDING=SCROLLBAR_PADDING;const VERTICAL_PADDING=5;exports.VERTICAL_PADDING=VERTICAL_PADDING;const LOADINGBAR_END_OFFSET_VAR="--loadingBar-end-offset",PresentationModeState={UNKNOWN:0,NORMAL:1,CHANGING:2,FULLSCREEN:3};exports.PresentationModeState=PresentationModeState;const SidebarView={UNKNOWN:-1,NONE:0,THUMBS:1,OUTLINE:2,ATTACHMENTS:3,LAYERS:4};exports.SidebarView=SidebarView;const RendererType={CANVAS:"canvas",SVG:"svg"};exports.RendererType=RendererType;const TextLayerMode={DISABLE:0,ENABLE:1,ENABLE_ENHANCE:2};exports.TextLayerMode=TextLayerMode;const ScrollMode={UNKNOWN:-1,VERTICAL:0,HORIZONTAL:1,WRAPPED:2};exports.ScrollMode=ScrollMode;const SpreadMode={UNKNOWN:-1,NONE:0,ODD:1,EVEN:2};exports.SpreadMode=SpreadMode;const AutoPrintRegExp=/\bprint\s*\(/;function getOutputScale(e){const t=window.devicePixelRatio||1,o=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.backingStorePixelRatio||1,n=t/o;return{sx:n,sy:n,scaled:1!==n}}function scrollIntoView(e,t,o=!1){let n=e.offsetParent;if(!n)return void console.error("offsetParent is not set -- cannot scroll");let i=e.offsetTop+e.clientTop,r=e.offsetLeft+e.clientLeft;while(n.clientHeight===n.scrollHeight&&n.clientWidth===n.scrollWidth||o&&(n.classList.contains("markedContent")||"hidden"===getComputedStyle(n).overflow))if(i+=n.offsetTop,r+=n.offsetLeft,n=n.offsetParent,!n)return;t&&(void 0!==t.top&&(i+=t.top),void 0!==t.left&&(r+=t.left,n.scrollLeft=r)),n.scrollTop=i}function watchScroll(e,t){const o=function(o){i||(i=window.requestAnimationFrame((function(){i=null;const o=e.scrollLeft,r=n.lastX;o!==r&&(n.right=o>r),n.lastX=o;const s=e.scrollTop,a=n.lastY;s!==a&&(n.down=s>a),n.lastY=s,t(n)})))},n={right:!0,down:!0,lastX:e.scrollLeft,lastY:e.scrollTop,_eventHandler:o};let i=null;return e.addEventListener("scroll",o,!0),n}function parseQueryString(e){const t=new Map;for(const o of e.split("&")){const e=o.split("="),n=e[0].toLowerCase(),i=e.length>1?e[1]:"";t.set(decodeURIComponent(n),decodeURIComponent(i))}return t}function binarySearchFirstItem(e,t){let o=0,n=e.length-1;if(n<0||!t(e[n]))return e.length;if(t(e[o]))return o;while(o<n){const i=o+n>>1,r=e[i];t(r)?n=i:o=i+1}return o}function approximateFraction(e){if(Math.floor(e)===e)return[e,1];const t=1/e,o=8;if(t>o)return[1,o];if(Math.floor(t)===t)return[1,t];const n=e>1?t:e;let i,r=0,s=1,a=1,l=1;while(1){const e=r+a,t=s+l;if(t>o)break;n<=e/t?(a=e,l=t):(r=e,s=t)}return i=n-r/s<a/l-n?n===e?[r,s]:[s,r]:n===e?[a,l]:[l,a],i}function roundToDivide(e,t){const o=e%t;return 0===o?e:Math.round(e-o+t)}function getPageSizeInches({view:e,userUnit:t,rotate:o}){const[n,i,r,s]=e,a=o%180!==0,l=(r-n)/72*t,c=(s-i)/72*t;return{width:a?c:l,height:a?l:c}}function backtrackBeforeAllVisibleElements(e,t,o){if(e<2)return e;let n=t[e].div,i=n.offsetTop+n.clientTop;i>=o&&(n=t[e-1].div,i=n.offsetTop+n.clientTop);for(let r=e-2;r>=0;--r){if(n=t[r].div,n.offsetTop+n.clientTop+n.clientHeight<=i)break;e=r}return e}function getVisibleElements({scrollEl:e,views:t,sortByVisibility:o=!1,horizontal:n=!1,rtl:i=!1}){const r=e.scrollTop,s=r+e.clientHeight,a=e.scrollLeft,l=a+e.clientWidth;function c(e){const t=e.div,o=t.offsetTop+t.clientTop+t.clientHeight;return o>r}function d(e){const t=e.div,o=t.offsetLeft+t.clientLeft,n=o+t.clientWidth;return i?o<l:n>a}const u=[],p=t.length;let f=binarySearchFirstItem(t,n?d:c);f>0&&f<p&&!n&&(f=backtrackBeforeAllVisibleElements(f,t,r));let h=n?l:-1;for(let S=f;S<p;S++){const e=t[S],o=e.div,i=o.offsetLeft+o.clientLeft,c=o.offsetTop+o.clientTop,d=o.clientWidth,p=o.clientHeight,f=i+d,E=c+p;if(-1===h)E>=s&&(h=E);else if((n?i:c)>h)break;if(E<=r||c>=s||f<=a||i>=l)continue;const A=Math.max(0,r-c)+Math.max(0,E-s),L=Math.max(0,a-i)+Math.max(0,f-l),T=(p-A)/p,x=(d-L)/d,m=T*x*100|0;u.push({id:e.id,x:i,y:c,view:e,percent:m,widthPercent:100*x|0})}const E=u[0],A=u[u.length-1];return o&&u.sort((function(e,t){const o=e.percent-t.percent;return Math.abs(o)>.001?-o:e.id-t.id})),{first:E,last:A,views:u}}function noContextMenuHandler(e){e.preventDefault()}function normalizeWheelEventDirection(e){let t=Math.hypot(e.deltaX,e.deltaY);const o=Math.atan2(e.deltaY,e.deltaX);return-.25*Math.PI<o&&o<.75*Math.PI&&(t=-t),t}function normalizeWheelEventDelta(e){let t=normalizeWheelEventDirection(e);const o=0,n=1,i=30,r=30;return e.deltaMode===o?t/=i*r:e.deltaMode===n&&(t/=r),t}function isValidRotation(e){return Number.isInteger(e)&&e%90===0}function isValidScrollMode(e){return Number.isInteger(e)&&Object.values(ScrollMode).includes(e)&&e!==ScrollMode.UNKNOWN}function isValidSpreadMode(e){return Number.isInteger(e)&&Object.values(SpreadMode).includes(e)&&e!==SpreadMode.UNKNOWN}function isPortraitOrientation(e){return e.width<=e.height}exports.AutoPrintRegExp=AutoPrintRegExp;const WaitOnType={EVENT:"event",TIMEOUT:"timeout"};function waitOnEventOrTimeout({target:e,name:t,delay:o=0}){return new Promise((function(n,i){if("object"!==typeof e||!t||"string"!==typeof t||!(Number.isInteger(o)&&o>=0))throw new Error("waitOnEventOrTimeout - invalid parameters.");function r(o){e instanceof EventBus?e._off(t,s):e.removeEventListener(t,s),l&&clearTimeout(l),n(o)}const s=r.bind(null,WaitOnType.EVENT);e instanceof EventBus?e._on(t,s):e.addEventListener(t,s);const a=r.bind(null,WaitOnType.TIMEOUT),l=setTimeout(a,o)}))}exports.WaitOnType=WaitOnType;const animationStarted=new Promise((function(e){"undefined"!==typeof window?window.requestAnimationFrame(e):setTimeout(e,20)}));exports.animationStarted=animationStarted;class EventBus{constructor(){this._listeners=Object.create(null)}on(e,t,o=null){this._on(e,t,{external:!0,once:o?.once})}off(e,t,o=null){this._off(e,t,{external:!0,once:o?.once})}dispatch(e,t){const o=this._listeners[e];if(!o||0===o.length)return;let n;for(const{listener:i,external:r,once:s}of o.slice(0))s&&this._off(e,i),r?(n||=[]).push(i):i(t);if(n){for(const e of n)e(t);n=null}}_on(e,t,o=null){const n=this._listeners[e]||=[];n.push({listener:t,external:!0===o?.external,once:!0===o?.once})}_off(e,t,o=null){const n=this._listeners[e];if(n)for(let i=0,r=n.length;i<r;i++)if(n[i].listener===t)return void n.splice(i,1)}}exports.EventBus=EventBus;class AutomationEventBus extends EventBus{dispatch(e,t){throw new Error("Not implemented: AutomationEventBus.dispatch")}}function clamp(e,t,o){return Math.min(Math.max(e,t),o)}exports.AutomationEventBus=AutomationEventBus;class ProgressBar{constructor(e,{height:t,width:o,units:n}={}){this.visible=!0,this.div=document.querySelector(e+" .progress"),this.bar=this.div.parentNode,this.height=t||100,this.width=o||100,this.units=n||"%",this.div.style.height=this.height+this.units,this.percent=0}_updateBar(){if(this._indeterminate)return this.div.classList.add("indeterminate"),void(this.div.style.width=this.width+this.units);this.div.classList.remove("indeterminate");const e=this.width*this._percent/100;this.div.style.width=e+this.units}get percent(){return this._percent}set percent(e){this._indeterminate=isNaN(e),this._percent=clamp(e,0,100),this._updateBar()}setWidth(e){if(!e)return;const t=e.parentNode,o=t.offsetWidth-e.offsetWidth;if(o>0){const e=document.documentElement;e.style.setProperty(LOADINGBAR_END_OFFSET_VAR,`${o}px`)}}hide(){this.visible&&(this.visible=!1,this.bar.classList.add("hidden"))}show(){this.visible||(this.visible=!0,this.bar.classList.remove("hidden"))}}function moveToEndOfArray(e,t){const o=[],n=e.length;let i=0;for(let r=0;r<n;++r)t(e[r])?o.push(e[r]):(e[i]=e[r],++i);for(let r=0;i<n;++r,++i)e[i]=o[r]}function getActiveOrFocusedElement(){let e=document,t=e.activeElement||e.querySelector(":focus");while(t?.shadowRoot)e=t.shadowRoot,t=e.activeElement||e.querySelector(":focus");return t}function apiPageLayoutToSpreadMode(e){switch(e){case"SinglePage":case"OneColumn":return SpreadMode.NONE;case"TwoColumnLeft":case"TwoPageLeft":return SpreadMode.ODD;case"TwoColumnRight":case"TwoPageRight":return SpreadMode.EVEN}return SpreadMode.NONE}function apiPageModeToSidebarView(e){switch(e){case"UseNone":return SidebarView.NONE;case"UseThumbs":return SidebarView.THUMBS;case"UseOutlines":return SidebarView.OUTLINE;case"UseAttachments":return SidebarView.ATTACHMENTS;case"UseOC":return SidebarView.LAYERS}return SidebarView.NONE}exports.ProgressBar=ProgressBar;