"use strict";var _util=require("../../shared/util.js"),_fetch_stream=require("../../display/fetch_stream.js");describe("fetch_stream",(function(){const e=new URL("../pdfs/tracemonkey.pdf",window.location).href,t=1016315;it("read with streaming",(async function(){const a=new _fetch_stream.PDFFetchStream({url:e,disableStream:!1,disableRange:!0}),n=a.getFullReader();let r,u;const i=n.headersReady.then((function(){r=n.isStreamingSupported,u=n.isRangeSupported}));let l=0;const c=function(){return n.read().then((function(e){if(!e.done)return l+=e.value.byteLength,c()}))};await Promise.all([c(),i]),expect(l).toEqual(t),expect(r).toEqual(!0),expect(u).toEqual(!1)})),it("read ranges with streaming",(async function(){const a=32768,n=new _fetch_stream.PDFFetchStream({url:e,rangeChunkSize:a,disableStream:!1,disableRange:!1}),r=n.getFullReader();let u,i,l;const c=r.headersReady.then((function(){u=r.isStreamingSupported,i=r.isRangeSupported,r.cancel(new _util.AbortException("Don't need fullReader.")),l=!0})),o=t%a||a,s=n.getRangeReader(t-o-a,t-o),d=n.getRangeReader(t-o,t),f={value:0},h={value:0},p=function(e,t){return e.read().then((function(a){if(!a.done)return t.value+=a.value.byteLength,p(e,t)}))};await Promise.all([p(s,f),p(d,h),c]),expect(u).toEqual(!0),expect(i).toEqual(!0),expect(l).toEqual(!0),expect(f.value).toEqual(a),expect(h.value).toEqual(o)}))}));