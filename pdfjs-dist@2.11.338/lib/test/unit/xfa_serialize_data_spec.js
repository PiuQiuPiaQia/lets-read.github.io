"use strict";var _xfa_object=require("../../core/xfa/xfa_object.js"),_data=require("../../core/xfa/data.js"),_som=require("../../core/xfa/som.js"),_parser=require("../../core/xfa/parser.js");describe("Data serializer",(function(){it("should serialize data with an annotationStorage",(function(){const a='\n<?xml version="1.0"?>\n<xdp:xdp xmlns:xdp="http://ns.adobe.com/xdp/">\n  <xfa:datasets xmlns:xfa="http://www.xfa.org/schema/xfa-data/1.0/">\n    <foo>bar</foo>\n    <xfa:data>\n      <Receipt>\n        <Page>1</Page>\n        <Detail PartNo="GS001">\n          <Description>Giant Slingshot</Description>\n          <Units>1</Units>\n          <Unit_Price>250.00</Unit_Price>\n          <Total_Price>250.00</Total_Price>\n        </Detail>\n        <Page>2</Page>\n        <Detail PartNo="RRB-LB">\n          <Description>Road Runner Bait, large bag</Description>\n          <Units>5</Units>\n          <Unit_Price>12.00</Unit_Price>\n          <Total_Price>60.00</Total_Price>\n        </Detail>\n        <Sub_Total>310.00</Sub_Total>\n        <Tax>24.80</Tax>\n        <Total_Price>334.80</Total_Price>\n      </Receipt>\n    </xfa:data>\n    <bar>foo</bar>\n  </xfa:datasets>\n</xdp:xdp>\n    ',t=(new _parser.XFAParser).parse(a),e=t.datasets.data,i=new _data.DataHandler(t,e),r=new Map;for(const[s,c]of[["Receipt.Detail[0].Units","12&3"],["Receipt.Detail[0].Unit_Price","456>"],["Receipt.Detail[0].Total_Price","789"],["Receipt.Detail[1].PartNo","foo-bar\ud83d\ude00"],["Receipt.Detail[1].Description","hello world"]])r.set((0,_som.searchNode)(t,e,s)[0][_xfa_object.$uid],{value:c});const n=i.serialize(r),o='<xfa:datasets xmlns:xfa="http://www.xfa.org/schema/xfa-data/1.0/"><foo>bar</foo><bar>foo</bar><xfa:data><Receipt><Page>1</Page><Detail PartNo="GS001"><Description>Giant Slingshot</Description><Units>12&amp;3</Units><Unit_Price>456&gt;</Unit_Price><Total_Price>789</Total_Price></Detail><Page>2</Page><Detail PartNo="foo-bar&#x1F600;"><Description>hello world</Description><Units>5</Units><Unit_Price>12.00</Unit_Price><Total_Price>60.00</Total_Price></Detail><Sub_Total>310.00</Sub_Total><Tax>24.80</Tax><Total_Price>334.80</Total_Price></Receipt></xfa:data></xfa:datasets>';expect(n).toEqual(o)}))}));