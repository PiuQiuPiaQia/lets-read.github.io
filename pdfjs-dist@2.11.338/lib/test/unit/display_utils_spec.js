"use strict";var _display_utils=require("../../display/display_utils.js"),_util=require("../../shared/util.js"),_is_node=require("../../shared/is_node.js");describe("display_utils",(function(){describe("DOMCanvasFactory",(function(){let e;beforeAll((function(){e=new _display_utils.DOMCanvasFactory})),afterAll((function(){e=null})),it("`create` should throw an error if the dimensions are invalid",(function(){expect((function(){return e.create(-1,1)})).toThrow(new Error("Invalid canvas size")),expect((function(){return e.create(1,-1)})).toThrow(new Error("Invalid canvas size"))})),it("`create` should return a canvas if the dimensions are valid",(function(){_is_node.isNodeJS&&pending("Document is not supported in Node.js.");const{canvas:t,context:i}=e.create(20,40);expect(t instanceof HTMLCanvasElement).toBe(!0),expect(i instanceof CanvasRenderingContext2D).toBe(!0),expect(t.width).toBe(20),expect(t.height).toBe(40)})),it("`reset` should throw an error if no canvas is provided",(function(){const t={canvas:null,context:null};expect((function(){return e.reset(t,20,40)})).toThrow(new Error("Canvas is not specified"))})),it("`reset` should throw an error if the dimensions are invalid",(function(){const t={canvas:"foo",context:"bar"};expect((function(){return e.reset(t,-1,1)})).toThrow(new Error("Invalid canvas size")),expect((function(){return e.reset(t,1,-1)})).toThrow(new Error("Invalid canvas size"))})),it("`reset` should alter the canvas/context if the dimensions are valid",(function(){_is_node.isNodeJS&&pending("Document is not supported in Node.js.");const t=e.create(20,40);e.reset(t,60,80);const{canvas:i,context:n}=t;expect(i instanceof HTMLCanvasElement).toBe(!0),expect(n instanceof CanvasRenderingContext2D).toBe(!0),expect(i.width).toBe(60),expect(i.height).toBe(80)})),it("`destroy` should throw an error if no canvas is provided",(function(){expect((function(){return e.destroy({})})).toThrow(new Error("Canvas is not specified"))})),it("`destroy` should clear the canvas/context",(function(){_is_node.isNodeJS&&pending("Document is not supported in Node.js.");const t=e.create(20,40);e.destroy(t);const{canvas:i,context:n}=t;expect(i).toBe(null),expect(n).toBe(null)}))})),describe("DOMSVGFactory",(function(){let e;beforeAll((function(){e=new _display_utils.DOMSVGFactory})),afterAll((function(){e=null})),it("`create` should throw an error if the dimensions are invalid",(function(){expect((function(){return e.create(-1,0)})).toThrow(new Error("Invalid SVG dimensions")),expect((function(){return e.create(0,-1)})).toThrow(new Error("Invalid SVG dimensions"))})),it("`create` should return an SVG element if the dimensions are valid",(function(){_is_node.isNodeJS&&pending("Document is not supported in Node.js.");const t=e.create(20,40);expect(t instanceof SVGSVGElement).toBe(!0),expect(t.getAttribute("version")).toBe("1.1"),expect(t.getAttribute("width")).toBe("20px"),expect(t.getAttribute("height")).toBe("40px"),expect(t.getAttribute("preserveAspectRatio")).toBe("none"),expect(t.getAttribute("viewBox")).toBe("0 0 20 40")})),it("`createElement` should throw an error if the type is not a string",(function(){expect((function(){return e.createElement(!0)})).toThrow(new Error("Invalid SVG element type"))})),it("`createElement` should return an SVG element if the type is valid",(function(){_is_node.isNodeJS&&pending("Document is not supported in Node.js.");const t=e.createElement("svg:rect");expect(t instanceof SVGRectElement).toBe(!0)}))})),describe("getFilenameFromUrl",(function(){it("should get the filename from an absolute URL",(function(){const e="https://server.org/filename.pdf";expect((0,_display_utils.getFilenameFromUrl)(e)).toEqual("filename.pdf")})),it("should get the filename from a relative URL",(function(){const e="../../filename.pdf";expect((0,_display_utils.getFilenameFromUrl)(e)).toEqual("filename.pdf")})),it("should get the filename from a URL with an anchor",(function(){const e="https://server.org/filename.pdf#foo";expect((0,_display_utils.getFilenameFromUrl)(e)).toEqual("filename.pdf")})),it("should get the filename from a URL with query parameters",(function(){const e="https://server.org/filename.pdf?foo=bar";expect((0,_display_utils.getFilenameFromUrl)(e)).toEqual("filename.pdf")}))})),describe("getPdfFilenameFromUrl",(function(){it("gets PDF filename",(function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/file1.pdf")).toEqual("file1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/pdfs/file2.pdf")).toEqual("file2.pdf")})),it("gets fallback filename",(function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/file1.txt")).toEqual("document.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/pdfs/file2.txt")).toEqual("document.pdf")})),it("gets custom fallback filename",(function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/file1.txt","qwerty1.pdf")).toEqual("qwerty1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/pdfs/file2.txt","qwerty2.pdf")).toEqual("qwerty2.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/file3.txt","")).toEqual("")})),it("gets fallback filename when url is not a string",(function(){expect((0,_display_utils.getPdfFilenameFromUrl)(null)).toEqual("document.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)(null,"file.pdf")).toEqual("file.pdf")})),it("gets PDF filename from URL containing leading/trailing whitespace",(function(){expect((0,_display_utils.getPdfFilenameFromUrl)("   /pdfs/file1.pdf   ")).toEqual("file1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("   http://www.example.com/pdfs/file2.pdf   ")).toEqual("file2.pdf")})),it("gets PDF filename from query string",(function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/pdfs.html?name=file1.pdf")).toEqual("file1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/pdfs/pdf.html?file2.pdf")).toEqual("file2.pdf")})),it("gets PDF filename from hash string",(function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/pdfs.html#name=file1.pdf")).toEqual("file1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/pdfs/pdf.html#file2.pdf")).toEqual("file2.pdf")})),it("gets correct PDF filename when multiple ones are present",(function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/file1.pdf?name=file.pdf")).toEqual("file1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/pdfs/file2.pdf#file.pdf")).toEqual("file2.pdf")})),it("gets PDF filename from URI-encoded data",(function(){const e=encodeURIComponent("http://www.example.com/pdfs/file1.pdf");expect((0,_display_utils.getPdfFilenameFromUrl)(e)).toEqual("file1.pdf");const t=encodeURIComponent("http://www.example.com/pdfs/file.txt?file2.pdf");expect((0,_display_utils.getPdfFilenameFromUrl)(t)).toEqual("file2.pdf")})),it("gets PDF filename from data mistaken for URI-encoded",(function(){expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/%AA.pdf")).toEqual("%AA.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("/pdfs/%2F.pdf")).toEqual("%2F.pdf")})),it("gets PDF filename from (some) standard protocols",(function(){expect((0,_display_utils.getPdfFilenameFromUrl)("http://www.example.com/file1.pdf")).toEqual("file1.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("https://www.example.com/file2.pdf")).toEqual("file2.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("file:///path/to/files/file3.pdf")).toEqual("file3.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("ftp://www.example.com/file4.pdf")).toEqual("file4.pdf")})),it('gets PDF filename from query string appended to "blob:" URL',(function(){_is_node.isNodeJS&&pending("Blob in not supported in Node.js.");const e=new Uint8Array([1,2,3,4,5]),t=(0,_util.createObjectURL)(e,"application/pdf");expect(t.startsWith("blob:")).toEqual(!0),expect((0,_display_utils.getPdfFilenameFromUrl)(t+"?file.pdf")).toEqual("file.pdf")})),it('gets fallback filename from query string appended to "data:" URL',(function(){const e=new Uint8Array([1,2,3,4,5]),t=(0,_util.createObjectURL)(e,"application/pdf",!0);expect(t.startsWith("data:")).toEqual(!0),expect((0,_display_utils.getPdfFilenameFromUrl)(t+"?file1.pdf")).toEqual("document.pdf"),expect((0,_display_utils.getPdfFilenameFromUrl)("     "+t+"?file2.pdf")).toEqual("document.pdf")}))})),describe("isValidFetchUrl",(function(){it("handles invalid Fetch URLs",(function(){expect((0,_display_utils.isValidFetchUrl)(null)).toEqual(!1),expect((0,_display_utils.isValidFetchUrl)(100)).toEqual(!1),expect((0,_display_utils.isValidFetchUrl)("foo")).toEqual(!1),expect((0,_display_utils.isValidFetchUrl)("/foo",100)).toEqual(!1)})),it("handles relative Fetch URLs",(function(){expect((0,_display_utils.isValidFetchUrl)("/foo","file://www.example.com")).toEqual(!1),expect((0,_display_utils.isValidFetchUrl)("/foo","http://www.example.com")).toEqual(!0)})),it("handles unsupported Fetch protocols",(function(){expect((0,_display_utils.isValidFetchUrl)("file://www.example.com")).toEqual(!1),expect((0,_display_utils.isValidFetchUrl)("ftp://www.example.com")).toEqual(!1)})),it("handles supported Fetch protocols",(function(){expect((0,_display_utils.isValidFetchUrl)("http://www.example.com")).toEqual(!0),expect((0,_display_utils.isValidFetchUrl)("https://www.example.com")).toEqual(!0)}))})),describe("PDFDateString",(function(){describe("toDateObject",(function(){it("converts PDF date strings to JavaScript `Date` objects",(function(){const e={undefined:null,null:null,42:null,2019:null,D2019:null,"D:":null,"D:201":null,"D:2019":new Date(Date.UTC(2019,0,1,0,0,0)),"D:20190":new Date(Date.UTC(2019,0,1,0,0,0)),"D:201900":new Date(Date.UTC(2019,0,1,0,0,0)),"D:201913":new Date(Date.UTC(2019,0,1,0,0,0)),"D:201902":new Date(Date.UTC(2019,1,1,0,0,0)),"D:2019020":new Date(Date.UTC(2019,1,1,0,0,0)),"D:20190200":new Date(Date.UTC(2019,1,1,0,0,0)),"D:20190232":new Date(Date.UTC(2019,1,1,0,0,0)),"D:20190203":new Date(Date.UTC(2019,1,3,0,0,0)),"D:20190431":new Date(Date.UTC(2019,4,1,0,0,0)),"D:201902030":new Date(Date.UTC(2019,1,3,0,0,0)),"D:2019020300":new Date(Date.UTC(2019,1,3,0,0,0)),"D:2019020324":new Date(Date.UTC(2019,1,3,0,0,0)),"D:2019020304":new Date(Date.UTC(2019,1,3,4,0,0)),"D:20190203040":new Date(Date.UTC(2019,1,3,4,0,0)),"D:201902030400":new Date(Date.UTC(2019,1,3,4,0,0)),"D:201902030460":new Date(Date.UTC(2019,1,3,4,0,0)),"D:201902030405":new Date(Date.UTC(2019,1,3,4,5,0)),"D:2019020304050":new Date(Date.UTC(2019,1,3,4,5,0)),"D:20190203040500":new Date(Date.UTC(2019,1,3,4,5,0)),"D:20190203040560":new Date(Date.UTC(2019,1,3,4,5,0)),"D:20190203040506":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506F":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506Z":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506-":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506+":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506+'":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506+0":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506+01":new Date(Date.UTC(2019,1,3,3,5,6)),"D:20190203040506+00'":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506+24'":new Date(Date.UTC(2019,1,3,4,5,6)),"D:20190203040506+01'":new Date(Date.UTC(2019,1,3,3,5,6)),"D:20190203040506+01'0":new Date(Date.UTC(2019,1,3,3,5,6)),"D:20190203040506+01'00":new Date(Date.UTC(2019,1,3,3,5,6)),"D:20190203040506+01'60":new Date(Date.UTC(2019,1,3,3,5,6)),"D:20190203040506+0102":new Date(Date.UTC(2019,1,3,3,3,6)),"D:20190203040506+01'02":new Date(Date.UTC(2019,1,3,3,3,6)),"D:20190203040506+01'02'":new Date(Date.UTC(2019,1,3,3,3,6)),"D:20190203040506+05'07":new Date(Date.UTC(2019,1,2,22,58,6))};for(const[t,i]of Object.entries(e)){const e=_display_utils.PDFDateString.toDateObject(t);e?expect(e.getTime()).toEqual(i.getTime()):expect(e).toEqual(i)}}))}))}))}));