"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.buildGetDocumentParams=buildGetDocumentParams,exports.createIdFactory=createIdFactory,exports.isEmptyObj=isEmptyObj,exports.XRefMock=exports.TEST_PDFS_PATH=exports.STANDARD_FONT_DATA_URL=exports.DefaultFileReaderFactory=exports.CMAP_PARAMS=void 0;var _primitives=require("../../core/primitives.js"),_document=require("../../core/document.js"),_util=require("../../shared/util.js"),_is_node=require("../../shared/is_node.js"),_stream=require("../../core/stream.js");const TEST_PDFS_PATH=_is_node.isNodeJS?"./test/pdfs/":"../pdfs/";exports.TEST_PDFS_PATH=TEST_PDFS_PATH;const CMAP_PARAMS={cMapUrl:_is_node.isNodeJS?"./external/bcmaps/":"../../external/bcmaps/",cMapPacked:!0};exports.CMAP_PARAMS=CMAP_PARAMS;const STANDARD_FONT_DATA_URL=_is_node.isNodeJS?"./external/standard_fonts/":"../../external/standard_fonts/";exports.STANDARD_FONT_DATA_URL=STANDARD_FONT_DATA_URL;class DOMFileReaderFactory{static async fetch(e){const t=await fetch(e.path);if(!t.ok)throw new Error(t.statusText);return new Uint8Array(await t.arrayBuffer())}}class NodeFileReaderFactory{static async fetch(e){const t=require("fs");return new Promise(((r,s)=>{t.readFile(e.path,((t,a)=>{!t&&a?r(new Uint8Array(a)):s(t||new Error(`Empty file for: ${e.path}`))}))}))}}const DefaultFileReaderFactory=_is_node.isNodeJS?NodeFileReaderFactory:DOMFileReaderFactory;function buildGetDocumentParams(e,t){const r=Object.create(null);r.url=_is_node.isNodeJS?TEST_PDFS_PATH+e:new URL(TEST_PDFS_PATH+e,window.location).href,r.standardFontDataUrl=STANDARD_FONT_DATA_URL;for(const s in t)r[s]=t[s];return r}exports.DefaultFileReaderFactory=DefaultFileReaderFactory;class XRefMock{constructor(e){this._map=Object.create(null),this.stats={streamTypes:Object.create(null),fontTypes:Object.create(null)},this._newRefNum=null;for(const t in e){const r=e[t];this._map[r.ref.toString()]=r.data}}getNewRef(){return null===this._newRefNum&&(this._newRefNum=Object.keys(this._map).length),_primitives.Ref.get(this._newRefNum++,0)}resetNewRef(){this.newRef=null}fetch(e){return this._map[e.toString()]}async fetchAsync(e){return this.fetch(e)}fetchIfRef(e){return(0,_primitives.isRef)(e)?this.fetch(e):e}async fetchIfRefAsync(e){return this.fetchIfRef(e)}}function createIdFactory(e){const t={get docId(){return"d0"}},r=new _stream.StringStream("Dummy_PDF_data"),s=new _document.PDFDocument(t,r),a=new _document.Page({pdfManager:s.pdfManager,xref:s.xref,pageIndex:e,globalIdFactory:s._globalIdFactory});return a._localIdFactory}function isEmptyObj(e){return(0,_util.assert)("object"===typeof e&&null!==e,"isEmptyObj - invalid argument."),0===Object.keys(e).length}exports.XRefMock=XRefMock;