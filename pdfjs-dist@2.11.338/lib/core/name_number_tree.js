"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.NumberTree=exports.NameTree=void 0;var _util=require("../shared/util.js"),_primitives=require("./primitives.js");class NameOrNumberTree{constructor(e,t,r){this.constructor===NameOrNumberTree&&(0,_util.unreachable)("Cannot initialize NameOrNumberTree."),this.root=e,this.xref=t,this._type=r}getAll(){const e=new Map;if(!this.root)return e;const t=this.xref,r=new _primitives.RefSet;r.put(this.root);const i=[this.root];while(i.length>0){const s=t.fetchIfRef(i.shift());if(!(0,_primitives.isDict)(s))continue;if(s.has("Kids")){const e=s.get("Kids");for(let t=0,s=e.length;t<s;t++){const s=e[t];if(r.has(s))throw new _util.FormatError(`Duplicate entry in "${this._type}" tree.`);i.push(s),r.put(s)}continue}const f=s.get(this._type);if(Array.isArray(f))for(let r=0,i=f.length;r<i;r+=2)e.set(t.fetchIfRef(f[r]),t.fetchIfRef(f[r+1]))}return e}get(e){if(!this.root)return null;const t=this.xref;let r=t.fetchIfRef(this.root),i=0;const s=10;while(r.has("Kids")){if(++i>s)return(0,_util.warn)(`Search depth limit reached for "${this._type}" tree.`),null;const f=r.get("Kids");if(!Array.isArray(f))return null;let n=0,o=f.length-1;while(n<=o){const i=n+o>>1,s=t.fetchIfRef(f[i]),u=s.get("Limits");if(e<t.fetchIfRef(u[0]))o=i-1;else{if(!(e>t.fetchIfRef(u[1]))){r=t.fetchIfRef(f[i]);break}n=i+1}}if(n>o)return null}const f=r.get(this._type);if(Array.isArray(f)){let r=0,i=f.length-2;while(r<=i){const s=r+i>>1,n=s+(1&s),o=t.fetchIfRef(f[n]);if(e<o)i=n-2;else{if(!(e>o))return t.fetchIfRef(f[n+1]);r=n+2}}}return null}}class NameTree extends NameOrNumberTree{constructor(e,t){super(e,t,"Names")}}exports.NameTree=NameTree;class NumberTree extends NameOrNumberTree{constructor(e,t){super(e,t,"Nums")}}exports.NumberTree=NumberTree;