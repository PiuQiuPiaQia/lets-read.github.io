"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MetadataParser=void 0;var _xml_parser=require("./xml_parser.js");class MetadataParser{constructor(e){e=this._repair(e);const t=new _xml_parser.SimpleXMLParser({lowerCaseName:!0}),r=t.parseFromString(e);this._metadataMap=new Map,this._data=e,r&&this._parse(r)}_repair(e){return e.replace(/^[^<]+/,"").replace(/>\\376\\377([^<]+)/g,(function(e,t){const r=t.replace(/\\([0-3])([0-7])([0-7])/g,(function(e,t,r,a){return String.fromCharCode(64*t+8*r+1*a)})).replace(/&(amp|apos|gt|lt|quot);/g,(function(e,t){switch(t){case"amp":return"&";case"apos":return"'";case"gt":return">";case"lt":return"<";case"quot":return'"'}throw new Error(`_repair: ${t} isn't defined.`)})),a=[];for(let s=0,n=r.length;s<n;s+=2){const e=256*r.charCodeAt(s)+r.charCodeAt(s+1);e>=32&&e<127&&60!==e&&62!==e&&38!==e?a.push(String.fromCharCode(e)):a.push("&#x"+(65536+e).toString(16).substring(1)+";")}return">"+a.join("")}))}_getSequence(e){const t=e.nodeName;return"rdf:bag"!==t&&"rdf:seq"!==t&&"rdf:alt"!==t?null:e.childNodes.filter((e=>"rdf:li"===e.nodeName))}_parseArray(e){if(!e.hasChildNodes())return;const[t]=e.childNodes,r=this._getSequence(t)||[];this._metadataMap.set(e.nodeName,r.map((e=>e.textContent.trim())))}_parse(e){let t=e.documentElement;if("rdf:rdf"!==t.nodeName){t=t.firstChild;while(t&&"rdf:rdf"!==t.nodeName)t=t.nextSibling}if(t&&"rdf:rdf"===t.nodeName&&t.hasChildNodes())for(const r of t.childNodes)if("rdf:description"===r.nodeName)for(const e of r.childNodes){const t=e.nodeName;switch(t){case"#text":continue;case"dc:creator":case"dc:subject":this._parseArray(e);continue}this._metadataMap.set(t,e.textContent.trim())}}get serializable(){return{parsedData:this._metadataMap,rawData:this._data}}}exports.MetadataParser=MetadataParser;