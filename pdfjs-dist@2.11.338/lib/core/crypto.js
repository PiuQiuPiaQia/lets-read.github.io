"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.calculateSHA384=calculateSHA384,exports.PDF20=exports.PDF17=exports.CipherTransformFactory=exports.calculateSHA512=exports.calculateSHA256=exports.calculateMD5=exports.ARCFourCipher=exports.AES256Cipher=exports.AES128Cipher=void 0;var _util=require("../shared/util.js"),_primitives=require("./primitives.js"),_decrypt_stream=require("./decrypt_stream.js");class ARCFourCipher{constructor(t){this.a=0,this.b=0;const e=new Uint8Array(256),r=t.length;for(let n=0;n<256;++n)e[n]=n;for(let n=0,o=0;n<256;++n){const i=e[n];o=o+i+t[n%r]&255,e[n]=e[o],e[o]=i}this.s=e}encryptBlock(t){let e=this.a,r=this.b;const n=this.s,o=t.length,i=new Uint8Array(o);for(let s=0;s<o;++s){e=e+1&255;const o=n[e];r=r+o&255;const h=n[r];n[e]=h,n[r]=o,i[s]=t[s]^n[o+h&255]}return this.a=e,this.b=r,i}decryptBlock(t){return this.encryptBlock(t)}encrypt(t){return this.encryptBlock(t)}}exports.ARCFourCipher=ARCFourCipher;const calculateMD5=function(){const t=new Uint8Array([7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21]),e=new Int32Array([-680876936,-389564586,606105819,-1044525330,-176418897,1200080426,-1473231341,-45705983,1770035416,-1958414417,-42063,-1990404162,1804603682,-40341101,-1502002290,1236535329,-165796510,-1069501632,643717713,-373897302,-701558691,38016083,-660478335,-405537848,568446438,-1019803690,-187363961,1163531501,-1444681467,-51403784,1735328473,-1926607734,-378558,-2022574463,1839030562,-35309556,-1530992060,1272893353,-155497632,-1094730640,681279174,-358537222,-722521979,76029189,-640364487,-421815835,530742520,-995338651,-198630844,1126891415,-1416354905,-57434055,1700485571,-1894986606,-1051523,-2054922799,1873313359,-30611744,-1560198380,1309151649,-145523070,-1120210379,718787259,-343485551]);function r(r,n,o){let i=1732584193,s=-271733879,h=-1732584194,l=271733878;const c=o+72&-64,a=new Uint8Array(c);let w,u;for(w=0;w<o;++w)a[w]=r[n++];a[w++]=128;const d=c-8;while(w<d)a[w++]=0;a[w++]=o<<3&255,a[w++]=o>>5&255,a[w++]=o>>13&255,a[w++]=o>>21&255,a[w++]=o>>>29&255,a[w++]=0,a[w++]=0,a[w++]=0;const g=new Int32Array(16);for(w=0;w<c;){for(u=0;u<16;++u,w+=4)g[u]=a[w]|a[w+1]<<8|a[w+2]<<16|a[w+3]<<24;let r,n,o=i,c=s,d=h,f=l;for(u=0;u<64;++u){u<16?(r=c&d|~c&f,n=u):u<32?(r=f&c|~f&d,n=5*u+1&15):u<48?(r=c^d^f,n=3*u+5&15):(r=d^(c|~f),n=7*u&15);const i=f,s=o+r+e[u]+g[n]|0,h=t[u];f=d,d=c,c=c+(s<<h|s>>>32-h)|0,o=i}i=i+o|0,s=s+c|0,h=h+d|0,l=l+f|0}return new Uint8Array([255&i,i>>8&255,i>>16&255,i>>>24&255,255&s,s>>8&255,s>>16&255,s>>>24&255,255&h,h>>8&255,h>>16&255,h>>>24&255,255&l,l>>8&255,l>>16&255,l>>>24&255])}return r}();exports.calculateMD5=calculateMD5;class Word64{constructor(t,e){this.high=0|t,this.low=0|e}and(t){this.high&=t.high,this.low&=t.low}xor(t){this.high^=t.high,this.low^=t.low}or(t){this.high|=t.high,this.low|=t.low}shiftRight(t){t>=32?(this.low=this.high>>>t-32|0,this.high=0):(this.low=this.low>>>t|this.high<<32-t,this.high=this.high>>>t|0)}shiftLeft(t){t>=32?(this.high=this.low<<t-32,this.low=0):(this.high=this.high<<t|this.low>>>32-t,this.low<<=t)}rotateRight(t){let e,r;32&t?(r=this.low,e=this.high):(e=this.low,r=this.high),t&=31,this.low=e>>>t|r<<32-t,this.high=r>>>t|e<<32-t}not(){this.high=~this.high,this.low=~this.low}add(t){const e=(this.low>>>0)+(t.low>>>0);let r=(this.high>>>0)+(t.high>>>0);e>4294967295&&(r+=1),this.low=0|e,this.high=0|r}copyTo(t,e){t[e]=this.high>>>24&255,t[e+1]=this.high>>16&255,t[e+2]=this.high>>8&255,t[e+3]=255&this.high,t[e+4]=this.low>>>24&255,t[e+5]=this.low>>16&255,t[e+6]=this.low>>8&255,t[e+7]=255&this.low}assign(t){this.high=t.high,this.low=t.low}}const calculateSHA256=function(){function t(t,e){return t>>>e|t<<32-e}function e(t,e,r){return t&e^~t&r}function r(t,e,r){return t&e^t&r^e&r}function n(e){return t(e,2)^t(e,13)^t(e,22)}function o(e){return t(e,6)^t(e,11)^t(e,25)}function i(e){return t(e,7)^t(e,18)^e>>>3}function s(e){return t(e,17)^t(e,19)^e>>>10}const h=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function l(t,l,c){let a=1779033703,w=3144134277,u=1013904242,d=2773480762,g=1359893119,f=2600822924,y=528734635,p=1541459225;const A=64*Math.ceil((c+9)/64),W=new Uint8Array(A);let _,C;for(_=0;_<c;++_)W[_]=t[l++];W[_++]=128;const m=A-8;while(_<m)W[_++]=0;W[_++]=0,W[_++]=0,W[_++]=0,W[_++]=c>>>29&255,W[_++]=c>>21&255,W[_++]=c>>13&255,W[_++]=c>>5&255,W[_++]=c<<3&255;const S=new Uint32Array(64);for(_=0;_<A;){for(C=0;C<16;++C)S[C]=W[_]<<24|W[_+1]<<16|W[_+2]<<8|W[_+3],_+=4;for(C=16;C<64;++C)S[C]=s(S[C-2])+S[C-7]+i(S[C-15])+S[C-16]|0;let t,l,c=a,A=w,m=u,U=d,x=g,b=f,T=y,E=p;for(C=0;C<64;++C)t=E+o(x)+e(x,b,T)+h[C]+S[C],l=n(c)+r(c,A,m),E=T,T=b,b=x,x=U+t|0,U=m,m=A,A=c,c=t+l|0;a=a+c|0,w=w+A|0,u=u+m|0,d=d+U|0,g=g+x|0,f=f+b|0,y=y+T|0,p=p+E|0}return new Uint8Array([a>>24&255,a>>16&255,a>>8&255,255&a,w>>24&255,w>>16&255,w>>8&255,255&w,u>>24&255,u>>16&255,u>>8&255,255&u,d>>24&255,d>>16&255,d>>8&255,255&d,g>>24&255,g>>16&255,g>>8&255,255&g,f>>24&255,f>>16&255,f>>8&255,255&f,y>>24&255,y>>16&255,y>>8&255,255&y,p>>24&255,p>>16&255,p>>8&255,255&p])}return l}();exports.calculateSHA256=calculateSHA256;const calculateSHA512=function(){function t(t,e,r,n,o){t.assign(e),t.and(r),o.assign(e),o.not(),o.and(n),t.xor(o)}function e(t,e,r,n,o){t.assign(e),t.and(r),o.assign(e),o.and(n),t.xor(o),o.assign(r),o.and(n),t.xor(o)}function r(t,e,r){t.assign(e),t.rotateRight(28),r.assign(e),r.rotateRight(34),t.xor(r),r.assign(e),r.rotateRight(39),t.xor(r)}function n(t,e,r){t.assign(e),t.rotateRight(14),r.assign(e),r.rotateRight(18),t.xor(r),r.assign(e),r.rotateRight(41),t.xor(r)}function o(t,e,r){t.assign(e),t.rotateRight(1),r.assign(e),r.rotateRight(8),t.xor(r),r.assign(e),r.shiftRight(7),t.xor(r)}function i(t,e,r){t.assign(e),t.rotateRight(19),r.assign(e),r.rotateRight(61),t.xor(r),r.assign(e),r.shiftRight(6),t.xor(r)}const s=[new Word64(1116352408,3609767458),new Word64(1899447441,602891725),new Word64(3049323471,3964484399),new Word64(3921009573,2173295548),new Word64(961987163,4081628472),new Word64(1508970993,3053834265),new Word64(2453635748,2937671579),new Word64(2870763221,3664609560),new Word64(3624381080,2734883394),new Word64(310598401,1164996542),new Word64(607225278,1323610764),new Word64(1426881987,3590304994),new Word64(1925078388,4068182383),new Word64(2162078206,991336113),new Word64(2614888103,633803317),new Word64(3248222580,3479774868),new Word64(3835390401,2666613458),new Word64(4022224774,944711139),new Word64(264347078,2341262773),new Word64(604807628,2007800933),new Word64(770255983,1495990901),new Word64(1249150122,1856431235),new Word64(1555081692,3175218132),new Word64(1996064986,2198950837),new Word64(2554220882,3999719339),new Word64(2821834349,766784016),new Word64(2952996808,2566594879),new Word64(3210313671,3203337956),new Word64(3336571891,1034457026),new Word64(3584528711,2466948901),new Word64(113926993,3758326383),new Word64(338241895,168717936),new Word64(666307205,1188179964),new Word64(773529912,1546045734),new Word64(1294757372,1522805485),new Word64(1396182291,2643833823),new Word64(1695183700,2343527390),new Word64(1986661051,1014477480),new Word64(2177026350,1206759142),new Word64(2456956037,344077627),new Word64(2730485921,1290863460),new Word64(2820302411,3158454273),new Word64(3259730800,3505952657),new Word64(3345764771,106217008),new Word64(3516065817,3606008344),new Word64(3600352804,1432725776),new Word64(4094571909,1467031594),new Word64(275423344,851169720),new Word64(430227734,3100823752),new Word64(506948616,1363258195),new Word64(659060556,3750685593),new Word64(883997877,3785050280),new Word64(958139571,3318307427),new Word64(1322822218,3812723403),new Word64(1537002063,2003034995),new Word64(1747873779,3602036899),new Word64(1955562222,1575990012),new Word64(2024104815,1125592928),new Word64(2227730452,2716904306),new Word64(2361852424,442776044),new Word64(2428436474,593698344),new Word64(2756734187,3733110249),new Word64(3204031479,2999351573),new Word64(3329325298,3815920427),new Word64(3391569614,3928383900),new Word64(3515267271,566280711),new Word64(3940187606,3454069534),new Word64(4118630271,4000239992),new Word64(116418474,1914138554),new Word64(174292421,2731055270),new Word64(289380356,3203993006),new Word64(460393269,320620315),new Word64(685471733,587496836),new Word64(852142971,1086792851),new Word64(1017036298,365543100),new Word64(1126000580,2618297676),new Word64(1288033470,3409855158),new Word64(1501505948,4234509866),new Word64(1607167915,987167468),new Word64(1816402316,1246189591)];function h(h,l,c,a=!1){let w,u,d,g,f,y,p,A;a?(w=new Word64(3418070365,3238371032),u=new Word64(1654270250,914150663),d=new Word64(2438529370,812702999),g=new Word64(355462360,4144912697),f=new Word64(1731405415,4290775857),y=new Word64(2394180231,1750603025),p=new Word64(3675008525,1694076839),A=new Word64(1203062813,3204075428)):(w=new Word64(1779033703,4089235720),u=new Word64(3144134277,2227873595),d=new Word64(1013904242,4271175723),g=new Word64(2773480762,1595750129),f=new Word64(1359893119,2917565137),y=new Word64(2600822924,725511199),p=new Word64(528734635,4215389547),A=new Word64(1541459225,327033209));const W=128*Math.ceil((c+17)/128),_=new Uint8Array(W);let C,m;for(C=0;C<c;++C)_[C]=h[l++];_[C++]=128;const S=W-16;while(C<S)_[C++]=0;_[C++]=0,_[C++]=0,_[C++]=0,_[C++]=0,_[C++]=0,_[C++]=0,_[C++]=0,_[C++]=0,_[C++]=0,_[C++]=0,_[C++]=0,_[C++]=c>>>29&255,_[C++]=c>>21&255,_[C++]=c>>13&255,_[C++]=c>>5&255,_[C++]=c<<3&255;const U=new Array(80);for(C=0;C<80;C++)U[C]=new Word64(0,0);let x=new Word64(0,0),b=new Word64(0,0),T=new Word64(0,0),E=new Word64(0,0),B=new Word64(0,0),F=new Word64(0,0),k=new Word64(0,0),R=new Word64(0,0);const P=new Word64(0,0),D=new Word64(0,0),v=new Word64(0,0),M=new Word64(0,0);let H,O;for(C=0;C<W;){for(m=0;m<16;++m)U[m].high=_[C]<<24|_[C+1]<<16|_[C+2]<<8|_[C+3],U[m].low=_[C+4]<<24|_[C+5]<<16|_[C+6]<<8|_[C+7],C+=8;for(m=16;m<80;++m)H=U[m],i(H,U[m-2],M),H.add(U[m-7]),o(v,U[m-15],M),H.add(v),H.add(U[m-16]);for(x.assign(w),b.assign(u),T.assign(d),E.assign(g),B.assign(f),F.assign(y),k.assign(p),R.assign(A),m=0;m<80;++m)P.assign(R),n(v,B,M),P.add(v),t(v,B,F,k,M),P.add(v),P.add(s[m]),P.add(U[m]),r(D,x,M),e(v,x,b,T,M),D.add(v),H=R,R=k,k=F,F=B,E.add(P),B=E,E=T,T=b,b=x,H.assign(P),H.add(D),x=H;w.add(x),u.add(b),d.add(T),g.add(E),f.add(B),y.add(F),p.add(k),A.add(R)}return a?(O=new Uint8Array(48),w.copyTo(O,0),u.copyTo(O,8),d.copyTo(O,16),g.copyTo(O,24),f.copyTo(O,32),y.copyTo(O,40)):(O=new Uint8Array(64),w.copyTo(O,0),u.copyTo(O,8),d.copyTo(O,16),g.copyTo(O,24),f.copyTo(O,32),y.copyTo(O,40),p.copyTo(O,48),A.copyTo(O,56)),O}return h}();function calculateSHA384(t,e,r){return calculateSHA512(t,e,r,!0)}exports.calculateSHA512=calculateSHA512;class NullCipher{decryptBlock(t){return t}encrypt(t){return t}}class AESBaseCipher{constructor(){this.constructor===AESBaseCipher&&(0,_util.unreachable)("Cannot initialize AESBaseCipher."),this._s=new Uint8Array([99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]),this._inv_s=new Uint8Array([82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125]),this._mix=new Uint32Array([0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795]),this._mixCol=new Uint8Array(256);for(let t=0;t<256;t++)this._mixCol[t]=t<128?t<<1:t<<1^27;this.buffer=new Uint8Array(16),this.bufferPosition=0}_expandKey(t){(0,_util.unreachable)("Cannot call `_expandKey` on the base class")}_decrypt(t,e){let r,n,o;const i=new Uint8Array(16);i.set(t);for(let s=0,h=this._keySize;s<16;++s,++h)i[s]^=e[h];for(let s=this._cyclesOfRepetition-1;s>=1;--s){r=i[13],i[13]=i[9],i[9]=i[5],i[5]=i[1],i[1]=r,r=i[14],n=i[10],i[14]=i[6],i[10]=i[2],i[6]=r,i[2]=n,r=i[15],n=i[11],o=i[7],i[15]=i[3],i[11]=r,i[7]=n,i[3]=o;for(let t=0;t<16;++t)i[t]=this._inv_s[i[t]];for(let t=0,r=16*s;t<16;++t,++r)i[t]^=e[r];for(let t=0;t<16;t+=4){const e=this._mix[i[t]],n=this._mix[i[t+1]],o=this._mix[i[t+2]],s=this._mix[i[t+3]];r=e^n>>>8^n<<24^o>>>16^o<<16^s>>>24^s<<8,i[t]=r>>>24&255,i[t+1]=r>>16&255,i[t+2]=r>>8&255,i[t+3]=255&r}}r=i[13],i[13]=i[9],i[9]=i[5],i[5]=i[1],i[1]=r,r=i[14],n=i[10],i[14]=i[6],i[10]=i[2],i[6]=r,i[2]=n,r=i[15],n=i[11],o=i[7],i[15]=i[3],i[11]=r,i[7]=n,i[3]=o;for(let s=0;s<16;++s)i[s]=this._inv_s[i[s]],i[s]^=e[s];return i}_encrypt(t,e){const r=this._s;let n,o,i;const s=new Uint8Array(16);s.set(t);for(let h=0;h<16;++h)s[h]^=e[h];for(let h=1;h<this._cyclesOfRepetition;h++){for(let t=0;t<16;++t)s[t]=r[s[t]];i=s[1],s[1]=s[5],s[5]=s[9],s[9]=s[13],s[13]=i,i=s[2],o=s[6],s[2]=s[10],s[6]=s[14],s[10]=i,s[14]=o,i=s[3],o=s[7],n=s[11],s[3]=s[15],s[7]=i,s[11]=o,s[15]=n;for(let t=0;t<16;t+=4){const e=s[t+0],r=s[t+1],o=s[t+2],i=s[t+3];n=e^r^o^i,s[t+0]^=n^this._mixCol[e^r],s[t+1]^=n^this._mixCol[r^o],s[t+2]^=n^this._mixCol[o^i],s[t+3]^=n^this._mixCol[i^e]}for(let t=0,r=16*h;t<16;++t,++r)s[t]^=e[r]}for(let h=0;h<16;++h)s[h]=r[s[h]];i=s[1],s[1]=s[5],s[5]=s[9],s[9]=s[13],s[13]=i,i=s[2],o=s[6],s[2]=s[10],s[6]=s[14],s[10]=i,s[14]=o,i=s[3],o=s[7],n=s[11],s[3]=s[15],s[7]=i,s[11]=o,s[15]=n;for(let h=0,l=this._keySize;h<16;++h,++l)s[h]^=e[l];return s}_decryptBlock2(t,e){const r=t.length;let n=this.buffer,o=this.bufferPosition;const i=[];let s=this.iv;for(let c=0;c<r;++c){if(n[o]=t[c],++o,o<16)continue;const e=this._decrypt(n,this._key);for(let t=0;t<16;++t)e[t]^=s[t];s=n,i.push(e),n=new Uint8Array(16),o=0}if(this.buffer=n,this.bufferLength=o,this.iv=s,0===i.length)return new Uint8Array(0);let h=16*i.length;if(e){const t=i[i.length-1];let e=t[15];if(e<=16){for(let r=15,n=16-e;r>=n;--r)if(t[r]!==e){e=0;break}h-=e,i[i.length-1]=t.subarray(0,16-e)}}const l=new Uint8Array(h);for(let c=0,a=0,w=i.length;c<w;++c,a+=16)l.set(i[c],a);return l}decryptBlock(t,e,r=null){const n=t.length,o=this.buffer;let i=this.bufferPosition;if(r)this.iv=r;else{for(let e=0;i<16&&e<n;++e,++i)o[i]=t[e];if(i<16)return this.bufferLength=i,new Uint8Array(0);this.iv=o,t=t.subarray(16)}return this.buffer=new Uint8Array(16),this.bufferLength=0,this.decryptBlock=this._decryptBlock2,this.decryptBlock(t,e)}encrypt(t,e){const r=t.length;let n=this.buffer,o=this.bufferPosition;const i=[];e||(e=new Uint8Array(16));for(let l=0;l<r;++l){if(n[o]=t[l],++o,o<16)continue;for(let t=0;t<16;++t)n[t]^=e[t];const r=this._encrypt(n,this._key);e=r,i.push(r),n=new Uint8Array(16),o=0}if(this.buffer=n,this.bufferLength=o,this.iv=e,0===i.length)return new Uint8Array(0);const s=16*i.length,h=new Uint8Array(s);for(let l=0,c=0,a=i.length;l<a;++l,c+=16)h.set(i[l],c);return h}}class AES128Cipher extends AESBaseCipher{constructor(t){super(),this._cyclesOfRepetition=10,this._keySize=160,this._rcon=new Uint8Array([141,1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145,57,114,228,211,189,97,194,159,37,74,148,51,102,204,131,29,58,116,232,203,141,1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145,57,114,228,211,189,97,194,159,37,74,148,51,102,204,131,29,58,116,232,203,141,1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145,57,114,228,211,189,97,194,159,37,74,148,51,102,204,131,29,58,116,232,203,141,1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145,57,114,228,211,189,97,194,159,37,74,148,51,102,204,131,29,58,116,232,203,141,1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145,57,114,228,211,189,97,194,159,37,74,148,51,102,204,131,29,58,116,232,203,141]),this._key=this._expandKey(t)}_expandKey(t){const e=176,r=this._s,n=this._rcon,o=new Uint8Array(e);o.set(t);for(let i=16,s=1;i<e;++s){let t=o[i-3],e=o[i-2],h=o[i-1],l=o[i-4];t=r[t],e=r[e],h=r[h],l=r[l],t^=n[s];for(let r=0;r<4;++r)o[i]=t^=o[i-16],i++,o[i]=e^=o[i-16],i++,o[i]=h^=o[i-16],i++,o[i]=l^=o[i-16],i++}return o}}exports.AES128Cipher=AES128Cipher;class AES256Cipher extends AESBaseCipher{constructor(t){super(),this._cyclesOfRepetition=14,this._keySize=224,this._key=this._expandKey(t)}_expandKey(t){const e=240,r=this._s,n=new Uint8Array(e);n.set(t);let o,i,s,h,l=1;for(let c=32,a=1;c<e;++a){c%32===16?(o=r[o],i=r[i],s=r[s],h=r[h]):c%32===0&&(o=n[c-3],i=n[c-2],s=n[c-1],h=n[c-4],o=r[o],i=r[i],s=r[s],h=r[h],o^=l,(l<<=1)>=256&&(l=255&(27^l)));for(let t=0;t<4;++t)n[c]=o^=n[c-32],c++,n[c]=i^=n[c-32],c++,n[c]=s^=n[c-32],c++,n[c]=h^=n[c-32],c++}return n}}exports.AES256Cipher=AES256Cipher;class PDF17{checkOwnerPassword(t,e,r,n){const o=new Uint8Array(t.length+56);o.set(t,0),o.set(e,t.length),o.set(r,t.length+e.length);const i=calculateSHA256(o,0,o.length);return(0,_util.isArrayEqual)(i,n)}checkUserPassword(t,e,r){const n=new Uint8Array(t.length+8);n.set(t,0),n.set(e,t.length);const o=calculateSHA256(n,0,n.length);return(0,_util.isArrayEqual)(o,r)}getOwnerKey(t,e,r,n){const o=new Uint8Array(t.length+56);o.set(t,0),o.set(e,t.length),o.set(r,t.length+e.length);const i=calculateSHA256(o,0,o.length),s=new AES256Cipher(i);return s.decryptBlock(n,!1,new Uint8Array(16))}getUserKey(t,e,r){const n=new Uint8Array(t.length+8);n.set(t,0),n.set(e,t.length);const o=calculateSHA256(n,0,n.length),i=new AES256Cipher(o);return i.decryptBlock(r,!1,new Uint8Array(16))}}exports.PDF17=PDF17;const PDF20=function(){function t(t,e,r){let n=calculateSHA256(e,0,e.length).subarray(0,32),o=[0],i=0;while(i<64||o[o.length-1]>i-32){const e=t.length+n.length+r.length,s=new Uint8Array(e);let h=0;s.set(t,h),h+=t.length,s.set(n,h),h+=n.length,s.set(r,h);const l=new Uint8Array(64*e);for(let t=0,r=0;t<64;t++,r+=e)l.set(s,r);const c=new AES128Cipher(n.subarray(0,16));o=c.encrypt(l,n.subarray(16,32));let a=0;for(let t=0;t<16;t++)a*=1,a%=3,a+=(o[t]>>>0)%3,a%=3;0===a?n=calculateSHA256(o,0,o.length):1===a?n=calculateSHA384(o,0,o.length):2===a&&(n=calculateSHA512(o,0,o.length)),i++}return n.subarray(0,32)}class e{hash(e,r,n){return t(e,r,n)}checkOwnerPassword(e,r,n,o){const i=new Uint8Array(e.length+56);i.set(e,0),i.set(r,e.length),i.set(n,e.length+r.length);const s=t(e,i,n);return(0,_util.isArrayEqual)(s,o)}checkUserPassword(e,r,n){const o=new Uint8Array(e.length+8);o.set(e,0),o.set(r,e.length);const i=t(e,o,[]);return(0,_util.isArrayEqual)(i,n)}getOwnerKey(e,r,n,o){const i=new Uint8Array(e.length+56);i.set(e,0),i.set(r,e.length),i.set(n,e.length+r.length);const s=t(e,i,n),h=new AES256Cipher(s);return h.decryptBlock(o,!1,new Uint8Array(16))}getUserKey(e,r,n){const o=new Uint8Array(e.length+8);o.set(e,0),o.set(r,e.length);const i=t(e,o,[]),s=new AES256Cipher(i);return s.decryptBlock(n,!1,new Uint8Array(16))}}return e}();exports.PDF20=PDF20;class CipherTransform{constructor(t,e){this.StringCipherConstructor=t,this.StreamCipherConstructor=e}createStream(t,e){const r=new this.StreamCipherConstructor;return new _decrypt_stream.DecryptStream(t,e,(function(t,e){return r.decryptBlock(t,e)}))}decryptString(t){const e=new this.StringCipherConstructor;let r=(0,_util.stringToBytes)(t);return r=e.decryptBlock(r,!0),(0,_util.bytesToString)(r)}encryptString(t){const e=new this.StringCipherConstructor;if(e instanceof AESBaseCipher){const r=t.length,n=16-r%16;t+=String.fromCharCode(n).repeat(n);const o=new Uint8Array(16);if("undefined"!==typeof crypto)crypto.getRandomValues(o);else for(let t=0;t<16;t++)o[t]=Math.floor(256*Math.random());let i=(0,_util.stringToBytes)(t);i=e.encrypt(i,o);const s=new Uint8Array(16+i.length);return s.set(o),s.set(i,16),(0,_util.bytesToString)(s)}let r=(0,_util.stringToBytes)(t);return r=e.encrypt(r),(0,_util.bytesToString)(r)}}const CipherTransformFactory=function(){const t=new Uint8Array([40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8,46,46,0,182,208,104,62,128,47,12,169,254,100,83,105,122]);function e(t,e,r,n,o,i,s,h,l,c,a,w){if(e){const t=Math.min(127,e.length);e=e.subarray(0,t)}else e=[];let u;return u=6===t?new PDF20:new PDF17,u.checkUserPassword(e,h,s)?u.getUserKey(e,l,a):e.length&&u.checkOwnerPassword(e,n,i,r)?u.getOwnerKey(e,o,i,c):null}function r(e,r,n,o,i,s,h,l){const c=40+n.length+e.length,a=new Uint8Array(c);let w,u,d=0;if(r)for(u=Math.min(32,r.length);d<u;++d)a[d]=r[d];w=0;while(d<32)a[d++]=t[w++];for(w=0,u=n.length;w<u;++w)a[d++]=n[w];for(a[d++]=255&i,a[d++]=i>>8&255,a[d++]=i>>16&255,a[d++]=i>>>24&255,w=0,u=e.length;w<u;++w)a[d++]=e[w];s>=4&&!l&&(a[d++]=255,a[d++]=255,a[d++]=255,a[d++]=255);let g=calculateMD5(a,0,d);const f=h>>3;if(s>=3)for(w=0;w<50;++w)g=calculateMD5(g,0,f);const y=g.subarray(0,f);let p,A;if(s>=3){for(d=0;d<32;++d)a[d]=t[d];for(w=0,u=e.length;w<u;++w)a[d++]=e[w];p=new ARCFourCipher(y),A=p.encryptBlock(calculateMD5(a,0,d)),u=y.length;const r=new Uint8Array(u);for(w=1;w<=19;++w){for(let t=0;t<u;++t)r[t]=y[t]^w;p=new ARCFourCipher(r),A=p.encryptBlock(A)}for(w=0,u=A.length;w<u;++w)if(o[w]!==A[w])return null}else for(p=new ARCFourCipher(y),A=p.encryptBlock(t),w=0,u=A.length;w<u;++w)if(o[w]!==A[w])return null;return y}function n(e,r,n,o){const i=new Uint8Array(32);let s=0;const h=Math.min(32,e.length);for(;s<h;++s)i[s]=e[s];let l=0;while(s<32)i[s++]=t[l++];let c=calculateMD5(i,0,s);const a=o>>3;if(n>=3)for(l=0;l<50;++l)c=calculateMD5(c,0,c.length);let w,u;if(n>=3){u=r;const t=new Uint8Array(a);for(l=19;l>=0;l--){for(let e=0;e<a;++e)t[e]=c[e]^l;w=new ARCFourCipher(t),u=w.encryptBlock(u)}}else w=new ARCFourCipher(c.subarray(0,a)),u=w.encryptBlock(r);return u}const o=_primitives.Name.get("Identity");function i(t,e,r,n=!1){const o=new Uint8Array(r.length+9),i=r.length;let s;for(s=0;s<i;++s)o[s]=r[s];o[s++]=255&t,o[s++]=t>>8&255,o[s++]=t>>16&255,o[s++]=255&e,o[s++]=e>>8&255,n&&(o[s++]=115,o[s++]=65,o[s++]=108,o[s++]=84);const h=calculateMD5(o,0,s);return h.subarray(0,Math.min(r.length+5,16))}function s(t,e,r,n,o){if(!(0,_primitives.isName)(e))throw new _util.FormatError("Invalid crypt filter name.");const s=t.get(e.name);let h;if(null!==s&&void 0!==s&&(h=s.get("CFM")),!h||"None"===h.name)return function(){return new NullCipher};if("V2"===h.name)return function(){return new ARCFourCipher(i(r,n,o,!1))};if("AESV2"===h.name)return function(){return new AES128Cipher(i(r,n,o,!0))};if("AESV3"===h.name)return function(){return new AES256Cipher(o)};throw new _util.FormatError("Unknown crypto method")}class h{constructor(t,i,s){const h=t.get("Filter");if(!(0,_primitives.isName)(h,"Standard"))throw new _util.FormatError("unknown encryption method");this.dict=t;const l=t.get("V");if(!Number.isInteger(l)||1!==l&&2!==l&&4!==l&&5!==l)throw new _util.FormatError("unsupported encryption algorithm");this.algorithm=l;let c=t.get("Length");if(!c)if(l<=3)c=40;else{const e=t.get("CF"),r=t.get("StmF");if((0,_primitives.isDict)(e)&&(0,_primitives.isName)(r)){e.suppressEncryption=!0;const t=e.get(r.name);c=t&&t.get("Length")||128,c<40&&(c<<=3)}}if(!Number.isInteger(c)||c<40||c%8!==0)throw new _util.FormatError("invalid key length");const a=(0,_util.stringToBytes)(t.get("O")).subarray(0,32),w=(0,_util.stringToBytes)(t.get("U")).subarray(0,32),u=t.get("P"),d=t.get("R"),g=(4===l||5===l)&&!1!==t.get("EncryptMetadata");this.encryptMetadata=g;const f=(0,_util.stringToBytes)(i);let y,p;if(s){if(6===d)try{s=(0,_util.utf8StringToString)(s)}catch(A){(0,_util.warn)("CipherTransformFactory: Unable to convert UTF8 encoded password.")}y=(0,_util.stringToBytes)(s)}if(5!==l)p=r(f,y,a,w,u,d,c,g);else{const r=(0,_util.stringToBytes)(t.get("O")).subarray(32,40),n=(0,_util.stringToBytes)(t.get("O")).subarray(40,48),o=(0,_util.stringToBytes)(t.get("U")).subarray(0,48),i=(0,_util.stringToBytes)(t.get("U")).subarray(32,40),s=(0,_util.stringToBytes)(t.get("U")).subarray(40,48),h=(0,_util.stringToBytes)(t.get("OE")),l=(0,_util.stringToBytes)(t.get("UE")),c=(0,_util.stringToBytes)(t.get("Perms"));p=e(d,y,a,r,n,o,w,i,s,h,l,c)}if(!p&&!s)throw new _util.PasswordException("No password given",_util.PasswordResponses.NEED_PASSWORD);if(!p&&s){const t=n(y,a,d,c);p=r(f,t,a,w,u,d,c,g)}if(!p)throw new _util.PasswordException("Incorrect Password",_util.PasswordResponses.INCORRECT_PASSWORD);if(this.encryptionKey=p,l>=4){const e=t.get("CF");(0,_primitives.isDict)(e)&&(e.suppressEncryption=!0),this.cf=e,this.stmf=t.get("StmF")||o,this.strf=t.get("StrF")||o,this.eff=t.get("EFF")||this.stmf}}createCipherTransform(t,e){if(4===this.algorithm||5===this.algorithm)return new CipherTransform(s(this.cf,this.stmf,t,e,this.encryptionKey),s(this.cf,this.strf,t,e,this.encryptionKey));const r=i(t,e,this.encryptionKey,!1),n=function(){return new ARCFourCipher(r)};return new CipherTransform(n,n)}}return h}();exports.CipherTransformFactory=CipherTransformFactory;