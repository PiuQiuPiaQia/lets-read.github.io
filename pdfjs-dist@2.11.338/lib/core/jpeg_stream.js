"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.JpegStream=void 0;var _decode_stream=require("./decode_stream.js"),_primitives=require("./primitives.js"),_jpg=require("./jpg.js"),_util=require("../shared/util.js");class JpegStream extends _decode_stream.DecodeStream{constructor(e,t,r){let s;while(-1!==(s=e.getByte()))if(255===s){e.skip(-1);break}super(t),this.stream=e,this.dict=e.dict,this.maybeLength=t,this.params=r}get bytes(){return(0,_util.shadow)(this,"bytes",this.stream.getBytes(this.maybeLength))}ensureBuffer(e){}readBlock(){if(this.eof)return;const e={decodeTransform:void 0,colorTransform:void 0},t=this.dict.getArray("Decode","D");if(this.forceRGB&&Array.isArray(t)){const r=this.dict.get("BitsPerComponent")||8,s=t.length,i=new Int32Array(s);let o=!1;const a=(1<<r)-1;for(let e=0;e<s;e+=2)i[e]=256*(t[e+1]-t[e])|0,i[e+1]=t[e]*a|0,256===i[e]&&0===i[e+1]||(o=!0);o&&(e.decodeTransform=i)}if((0,_primitives.isDict)(this.params)){const t=this.params.get("ColorTransform");Number.isInteger(t)&&(e.colorTransform=t)}const r=new _jpg.JpegImage(e);r.parse(this.bytes);const s=r.getData({width:this.drawWidth,height:this.drawHeight,forceRGB:this.forceRGB,isSourcePDF:!0});this.buffer=s,this.bufferLength=s.length,this.eof=!0}}exports.JpegStream=JpegStream;