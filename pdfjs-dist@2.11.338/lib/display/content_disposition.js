"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getFilenameFromContentDispositionHeader=getFilenameFromContentDispositionHeader;var _util=require("../shared/util.js");function getFilenameFromContentDispositionHeader(e){let t=!0,n=r("filename\\*","i").exec(e);if(n){n=n[1];let e=c(n);return e=unescape(e),e=f(e),e=u(e),s(e)}if(n=o(e),n){const e=u(n);return s(e)}if(n=r("filename","i").exec(e),n){n=n[1];let e=c(n);return e=u(e),s(e)}function r(e,t){return new RegExp("(?:^|;)\\s*"+e+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',t)}function i(e,n){if(e){if(!/^[\x00-\xFF]+$/.test(n))return n;try{const r=new TextDecoder(e,{fatal:!0}),i=(0,_util.stringToBytes)(n);n=r.decode(i),t=!1}catch(r){if(/^utf-?8$/i.test(e))try{n=decodeURIComponent(escape(n)),t=!1}catch(i){}}}return n}function s(e){return t&&/[\x80-\xff]/.test(e)&&(e=i("utf-8",e),t&&(e=i("iso-8859-1",e))),e}function o(e){const t=[];let n;const i=r("filename\\*((?!0\\d)\\d+)(\\*?)","ig");while(null!==(n=i.exec(e))){let[,e,r,i]=n;if(e=parseInt(e,10),e in t){if(0===e)break}else t[e]=[r,i]}const s=[];for(let r=0;r<t.length;++r){if(!(r in t))break;let[e,n]=t[r];n=c(n),e&&(n=unescape(n),0===r&&(n=f(n))),s.push(n)}return s.join("")}function c(e){if(e.startsWith('"')){const t=e.slice(1).split('\\"');for(let e=0;e<t.length;++e){const n=t[e].indexOf('"');-1!==n&&(t[e]=t[e].slice(0,n),t.length=e+1),t[e]=t[e].replace(/\\(.)/g,"$1")}e=t.join('"')}return e}function f(e){const t=e.indexOf("'");if(-1===t)return e;const n=e.slice(0,t),r=e.slice(t+1),s=r.replace(/^[^']*'/,"");return i(n,s)}function u(e){return!e.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(e)?e:e.replace(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,(function(e,t,n,r){if("q"===n||"Q"===n)return r=r.replace(/_/g," "),r=r.replace(/=([0-9a-fA-F]{2})/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})),i(t,r);try{r=atob(r)}catch(s){}return i(t,r)}))}return""}