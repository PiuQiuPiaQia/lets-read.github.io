"use strict";var _network_utils=require("../../display/network_utils"),_util=require("../../shared/util");describe("network_utils",(function(){describe("validateRangeRequestCapabilities",(function(){it("rejects range chunk sizes that are not larger than zero",(function(){expect((function(){(0,_network_utils.validateRangeRequestCapabilities)({rangeChunkSize:0})})).toThrow(new Error("Range chunk size must be larger than zero"))})),it("rejects disabled or non-HTTP range requests",(function(){expect((0,_network_utils.validateRangeRequestCapabilities)({disableRange:!0,isHttp:!0,getResponseHeader:function(e){if("Content-Length"===e)return 8},rangeChunkSize:64})).toEqual({allowRangeRequests:!1,suggestedLength:8}),expect((0,_network_utils.validateRangeRequestCapabilities)({disableRange:!1,isHttp:!1,getResponseHeader:function(e){if("Content-Length"===e)return 8},rangeChunkSize:64})).toEqual({allowRangeRequests:!1,suggestedLength:8})})),it("rejects invalid Accept-Ranges header values",(function(){expect((0,_network_utils.validateRangeRequestCapabilities)({disableRange:!1,isHttp:!0,getResponseHeader:function(e){return"Accept-Ranges"===e?"none":"Content-Length"===e?8:void 0},rangeChunkSize:64})).toEqual({allowRangeRequests:!1,suggestedLength:8})})),it("rejects invalid Content-Encoding header values",(function(){expect((0,_network_utils.validateRangeRequestCapabilities)({disableRange:!1,isHttp:!0,getResponseHeader:function(e){return"Accept-Ranges"===e?"bytes":"Content-Encoding"===e?"gzip":"Content-Length"===e?8:void 0},rangeChunkSize:64})).toEqual({allowRangeRequests:!1,suggestedLength:8})})),it("rejects invalid Content-Length header values",(function(){expect((0,_network_utils.validateRangeRequestCapabilities)({disableRange:!1,isHttp:!0,getResponseHeader:function(e){return"Accept-Ranges"===e?"bytes":"Content-Encoding"===e?null:"Content-Length"===e?"eight":void 0},rangeChunkSize:64})).toEqual({allowRangeRequests:!1,suggestedLength:void 0})})),it("rejects file sizes that are too small for range requests",(function(){expect((0,_network_utils.validateRangeRequestCapabilities)({disableRange:!1,isHttp:!0,getResponseHeader:function(e){return"Accept-Ranges"===e?"bytes":"Content-Encoding"===e?null:"Content-Length"===e?8:void 0},rangeChunkSize:64})).toEqual({allowRangeRequests:!1,suggestedLength:8})})),it("accepts file sizes large enough for range requests",(function(){expect((0,_network_utils.validateRangeRequestCapabilities)({disableRange:!1,isHttp:!0,getResponseHeader:function(e){return"Accept-Ranges"===e?"bytes":"Content-Encoding"===e?null:"Content-Length"===e?8192:void 0},rangeChunkSize:64})).toEqual({allowRangeRequests:!0,suggestedLength:8192})}))})),describe("extractFilenameFromHeader",(function(){it("returns null when content disposition header is blank",(function(){expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return null}))).toBeNull(),expect((0,_network_utils.extractFilenameFromHeader)((function(e){}))).toBeNull(),expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return""}))).toBeNull()})),it("gets the filename from the response header",(function(){expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return"inline"}))).toBeNull(),expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return"attachment"}))).toBeNull(),expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return'attachment; filename="filename.pdf"'}))).toEqual("filename.pdf"),expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return'attachment; filename="filename.pdf and spaces.pdf"'}))).toEqual("filename.pdf and spaces.pdf"),expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return'attachment; filename="tl;dr.pdf"'}))).toEqual("tl;dr.pdf"),expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return"attachment; filename=filename.pdf"}))).toEqual("filename.pdf"),expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return"attachment; filename=filename.pdf someotherparam"}))).toEqual("filename.pdf")})),it("gets the filename from the response header (RFC 6266)",(function(){expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return"attachment; filename*=filename.pdf"}))).toEqual("filename.pdf"),expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return"attachment; filename*=''filename.pdf"}))).toEqual("filename.pdf"),expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return"attachment; filename*=utf-8''filename.pdf"}))).toEqual("filename.pdf"),expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return"attachment; filename=no.pdf; filename*=utf-8''filename.pdf"}))).toEqual("filename.pdf"),expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return"attachment; filename*=utf-8''filename.pdf; filename=no.pdf"}))).toEqual("filename.pdf")})),it("gets the filename from the response header (RFC 2231)",(function(){expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return"attachment; filename*0=filename; filename*1=.pdf"}))).toEqual("filename.pdf")})),it("only extracts filename with pdf extension",(function(){expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return'attachment; filename="filename.png"'}))).toBeNull()})),it("extension validation is case insensitive",(function(){expect((0,_network_utils.extractFilenameFromHeader)((function(e){if("Content-Disposition"===e)return'form-data; name="fieldName"; filename="file.PdF"'}))).toEqual("file.PdF")}))})),describe("createResponseStatusError",(function(){it("handles missing PDF file responses",(function(){expect((0,_network_utils.createResponseStatusError)(404,"https://foo.com/bar.pdf")).toEqual(new _util.MissingPDFException('Missing PDF "https://foo.com/bar.pdf".')),expect((0,_network_utils.createResponseStatusError)(0,"file://foo.pdf")).toEqual(new _util.MissingPDFException('Missing PDF "file://foo.pdf".'))})),it("handles unexpected responses",(function(){expect((0,_network_utils.createResponseStatusError)(302,"https://foo.com/bar.pdf")).toEqual(new _util.UnexpectedResponseException('Unexpected server response (302) while retrieving PDF "https://foo.com/bar.pdf".')),expect((0,_network_utils.createResponseStatusError)(0,"https://foo.com/bar.pdf")).toEqual(new _util.UnexpectedResponseException('Unexpected server response (0) while retrieving PDF "https://foo.com/bar.pdf".'))}))})),describe("validateResponseStatus",(function(){it("accepts valid response statuses",(function(){expect((0,_network_utils.validateResponseStatus)(200)).toEqual(!0),expect((0,_network_utils.validateResponseStatus)(206)).toEqual(!0)})),it("rejects invalid response statuses",(function(){expect((0,_network_utils.validateResponseStatus)(302)).toEqual(!1),expect((0,_network_utils.validateResponseStatus)(404)).toEqual(!1),expect((0,_network_utils.validateResponseStatus)(null)).toEqual(!1),expect((0,_network_utils.validateResponseStatus)(void 0)).toEqual(!1)}))}))}));