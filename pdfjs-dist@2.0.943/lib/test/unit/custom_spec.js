"use strict";var _test_utils=require("./test_utils"),_dom_utils=require("../../display/dom_utils"),_api=require("../../display/api"),_is_node=require("../../shared/is_node"),_is_node2=_interopRequireDefault(_is_node);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function getTopLeftPixel(t){var e=t.getImageData(0,0,1,1);return{r:e.data[0],g:e.data[1],b:e.data[2],a:e.data[3]}}describe("custom canvas rendering",(function(){var t=(0,_test_utils.buildGetDocumentParams)("transparent.pdf"),e=void 0,n=void 0,a=void 0;beforeAll((function(i){(0,_is_node2.default)()||(e=new _dom_utils.DOMCanvasFactory),n=(0,_api.getDocument)(t),n.promise.then((function(t){return t.getPage(1)})).then((function(t){a=t,i()})).catch((function(t){i.fail(t)}))})),afterAll((function(t){e=null,a=null,n.destroy().then(t)})),it("renders to canvas with a default white background",(function(t){(0,_is_node2.default)()&&pending("TODO: Support Canvas testing in Node.js.");var n=a.getViewport(1),i=e.create(n.width,n.height);a.render({canvasContext:i.context,viewport:n}).then((function(){var n=getTopLeftPixel(i.context),a=n.r,o=n.g,r=n.b,u=n.a;e.destroy(i),expect(a).toEqual(255),expect(o).toEqual(255),expect(r).toEqual(255),expect(u).toEqual(255),t()})).catch((function(e){t(e)}))})),it("renders to canvas with a custom background",(function(t){(0,_is_node2.default)()&&pending("TODO: Support Canvas testing in Node.js.");var n=a.getViewport(1),i=e.create(n.width,n.height);a.render({canvasContext:i.context,viewport:n,background:"rgba(255,0,0,1.0)"}).then((function(){var n=getTopLeftPixel(i.context),a=n.r,o=n.g,r=n.b,u=n.a;e.destroy(i),expect(a).toEqual(255),expect(o).toEqual(0),expect(r).toEqual(0),expect(u).toEqual(255),t()})).catch((function(e){t(e)}))}))}));