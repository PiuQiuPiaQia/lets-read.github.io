"use strict";var _network=require("../../display/network");describe("network",(function(){var e=new URL("../pdfs/tracemonkey.pdf",window.location).href,t=1016315,n=new URL("../pdfs/pdf.pdf",window.location).href,a=32472771;it("read without stream and range",(function(n){var a,r,o=new _network.PDFNetworkStream({url:e,rangeChunkSize:65536,disableStream:!0,disableRange:!0}),u=o.getFullReader(),i=u.headersReady.then((function(){a=u.isStreamingSupported,r=u.isRangeSupported})),l=0,c=0,d=function e(){return u.read().then((function(t){if(!t.done)return c++,l+=t.value.byteLength,e()}))},f=Promise.all([d(),i]);f.then((function(e){expect(l).toEqual(t),expect(c).toEqual(1),expect(a).toEqual(!1),expect(r).toEqual(!1),n()})).catch((function(e){n.fail(e)}))})),it("read with streaming",(function(e){var t=window.navigator.userAgent,r=/Mozilla\/5.0.*?rv:(\d+).*? Gecko/.exec(t);if(!r||r[1]<9)return expect(!0).toEqual(!0),void e();var o,u,i=new _network.PDFNetworkStream({url:n,rangeChunkSize:65536,disableStream:!1,disableRange:!1}),l=i.getFullReader(),c=l.headersReady.then((function(){o=l.isStreamingSupported,u=l.isRangeSupported})),d=0,f=0,p=function e(){return l.read().then((function(t){if(!t.done)return f++,d+=t.value.byteLength,e()}))},s=Promise.all([p(),c]);s.then((function(){expect(d).toEqual(a),expect(f).toBeGreaterThan(1),expect(o).toEqual(!0),expect(u).toEqual(!0),e()})).catch((function(t){e.fail(t)}))})),it("read custom ranges",(function(n){var a,r,o,u=32768,i=new _network.PDFNetworkStream({url:e,length:t,rangeChunkSize:u,disableStream:!0,disableRange:!1}),l=i.getFullReader(),c=l.headersReady.then((function(){a=l.isStreamingSupported,r=l.isRangeSupported,l.cancel("Don't need full reader"),o=!0})),d=t%u||u,f=i.getRangeReader(t-d-u,t-d),p=i.getRangeReader(t-d,t),s={value:0},g={value:0},h=function e(t,n){return t.read().then((function(a){if(!a.done)return n.value+=a.value.byteLength,e(t,n)}))},w=Promise.all([h(f,s),h(p,g),c]);w.then((function(){expect(s.value).toEqual(u),expect(g.value).toEqual(d),expect(a).toEqual(!1),expect(r).toEqual(!0),expect(o).toEqual(!0),n()})).catch((function(e){n.fail(e)}))}))}));