"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PDFOutlineViewer=void 0;var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),_pdf=require("../pdf");function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var DEFAULT_TITLE="\u2013",PDFOutlineViewer=function(){function e(t){var i=t.container,n=t.linkService,l=t.eventBus;_classCallCheck(this,e),this.container=i,this.linkService=n,this.eventBus=l,this.reset(),l.on("toggleoutlinetree",this.toggleOutlineTree.bind(this))}return _createClass(e,[{key:"reset",value:function(){this.outline=null,this.lastToggleIsShow=!0,this.container.textContent="",this.container.classList.remove("outlineWithDeepNesting")}},{key:"_dispatchEvent",value:function(e){this.eventBus.dispatch("outlineloaded",{source:this,outlineCount:e})}},{key:"_bindLink",value:function(e,t){var i=t.url,n=t.newWindow,l=t.dest,s=this.linkService;i?(0,_pdf.addLinkAttributes)(e,{url:i,target:n?_pdf.LinkTarget.BLANK:s.externalLinkTarget,rel:s.externalLinkRel}):(e.href=s.getDestinationHash(l),e.onclick=function(){return l&&s.navigateTo(l),!1})}},{key:"_setStyles",value:function(e,t){var i=t.bold,n=t.italic,l="";i&&(l+="font-weight: bold;"),n&&(l+="font-style: italic;"),l&&e.setAttribute("style",l)}},{key:"_addToggleButton",value:function(e){var t=this,i=document.createElement("div");i.className="outlineItemToggler",i.onclick=function(n){if(n.stopPropagation(),i.classList.toggle("outlineItemsHidden"),n.shiftKey){var l=!i.classList.contains("outlineItemsHidden");t._toggleOutlineItem(e,l)}},e.insertBefore(i,e.firstChild)}},{key:"_toggleOutlineItem",value:function(e,t){this.lastToggleIsShow=t;for(var i=e.querySelectorAll(".outlineItemToggler"),n=0,l=i.length;n<l;++n)i[n].classList[t?"remove":"add"]("outlineItemsHidden")}},{key:"toggleOutlineTree",value:function(){this.outline&&this._toggleOutlineItem(this.container,!this.lastToggleIsShow)}},{key:"render",value:function(e){var t=e.outline,i=0;if(this.outline&&this.reset(),this.outline=t||null,t){var n=document.createDocumentFragment(),l=[{parent:n,items:this.outline}],s=!1;while(l.length>0)for(var o=l.shift(),a=0,r=o.items.length;a<r;a++){var u=o.items[a],c=document.createElement("div");c.className="outlineItem";var h=document.createElement("a");if(this._bindLink(h,u),this._setStyles(h,u),h.textContent=(0,_pdf.removeNullCharacters)(u.title)||DEFAULT_TITLE,c.appendChild(h),u.items.length>0){s=!0,this._addToggleButton(c);var d=document.createElement("div");d.className="outlineItems",c.appendChild(d),l.push({parent:d,items:u.items})}o.parent.appendChild(c),i++}s&&this.container.classList.add("outlineWithDeepNesting"),this.container.appendChild(n),this._dispatchEvent(i)}else this._dispatchEvent(i)}}]),e}();exports.PDFOutlineViewer=PDFOutlineViewer;