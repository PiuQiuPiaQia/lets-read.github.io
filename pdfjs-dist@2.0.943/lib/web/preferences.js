"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.BasePreferences=void 0;var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_typeof="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise((function(e,t){function n(a,o){try{var i=r[a](o),s=i.value}catch(u){return void t(u)}if(!i.done)return Promise.resolve(s).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(s)}return n("next")}))}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var defaultPreferences=null;function getDefaultPreferences(){return defaultPreferences||(defaultPreferences=Promise.resolve({showPreviousViewOnLoad:!0,defaultZoomValue:"",sidebarViewOnLoad:0,cursorToolOnLoad:0,enableWebGL:!1,eventBusDispatchToDOM:!1,pdfBugEnabled:!1,disableRange:!1,disableStream:!1,disableAutoFetch:!1,disableFontFace:!1,textLayerMode:1,useOnlyCssZoom:!1,externalLinkTarget:0,renderer:"canvas",renderInteractiveForms:!1,enablePrintAutoRotate:!1,disablePageMode:!1,disablePageLabels:!1,scrollModeOnLoad:0,spreadModeOnLoad:0})),defaultPreferences}var BasePreferences=function(){function e(){var r=this;if(_classCallCheck(this,e),this.constructor===e)throw new Error("Cannot initialize BasePreferences.");this.prefs=null,this._initializedPromise=getDefaultPreferences().then((function(e){return Object.defineProperty(r,"defaults",{value:Object.freeze(e),writable:!1,enumerable:!0,configurable:!1}),r.prefs=Object.assign(Object.create(null),e),r._readFromStorage(e)})).then((function(e){if(e)for(var t in e){var n=r.defaults[t],a=e[t];void 0!==n&&("undefined"===typeof a?"undefined":_typeof(a))===("undefined"===typeof n?"undefined":_typeof(n))&&(r.prefs[t]=a)}}))}return _createClass(e,[{key:"_writeToStorage",value:function(){var e=_asyncToGenerator(_regenerator2.default.mark((function e(r){return _regenerator2.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw new Error("Not implemented: _writeToStorage");case 1:case"end":return e.stop()}}),e,this)})));function r(r){return e.apply(this,arguments)}return r}()},{key:"_readFromStorage",value:function(){var e=_asyncToGenerator(_regenerator2.default.mark((function e(r){return _regenerator2.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:throw new Error("Not implemented: _readFromStorage");case 1:case"end":return e.stop()}}),e,this)})));function r(r){return e.apply(this,arguments)}return r}()},{key:"reset",value:function(){var e=_asyncToGenerator(_regenerator2.default.mark((function e(){return _regenerator2.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._initializedPromise;case 2:return this.prefs=Object.assign(Object.create(null),this.defaults),e.abrupt("return",this._writeToStorage(this.defaults));case 4:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"set",value:function(){var e=_asyncToGenerator(_regenerator2.default.mark((function e(r,t){var n,a,o;return _regenerator2.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._initializedPromise;case 2:if(n=this.defaults[r],void 0!==n){e.next=7;break}throw new Error('Set preference: "'+r+'" is undefined.');case 7:if(void 0!==t){e.next=9;break}throw new Error("Set preference: no value is specified.");case 9:if(a="undefined"===typeof t?"undefined":_typeof(t),o="undefined"===typeof n?"undefined":_typeof(n),a===o){e.next=19;break}if("number"!==a||"string"!==o){e.next=16;break}t=t.toString(),e.next=17;break;case 16:throw new Error('Set preference: "'+t+'" is a '+a+", expected a "+o+".");case 17:e.next=21;break;case 19:if("number"!==a||Number.isInteger(t)){e.next=21;break}throw new Error('Set preference: "'+t+'" must be an integer.');case 21:return this.prefs[r]=t,e.abrupt("return",this._writeToStorage(this.prefs));case 23:case"end":return e.stop()}}),e,this)})));function r(r,t){return e.apply(this,arguments)}return r}()},{key:"get",value:function(){var e=_asyncToGenerator(_regenerator2.default.mark((function e(r){var t,n;return _regenerator2.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._initializedPromise;case 2:if(t=this.defaults[r],void 0!==t){e.next=7;break}throw new Error('Get preference: "'+r+'" is undefined.');case 7:if(n=this.prefs[r],void 0===n){e.next=10;break}return e.abrupt("return",n);case 10:return e.abrupt("return",t);case 11:case"end":return e.stop()}}),e,this)})));function r(r){return e.apply(this,arguments)}return r}()},{key:"getAll",value:function(){var e=_asyncToGenerator(_regenerator2.default.mark((function e(){return _regenerator2.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._initializedPromise;case 2:return e.abrupt("return",Object.assign(Object.create(null),this.defaults,this.prefs));case 3:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()}]),e}();exports.BasePreferences=BasePreferences;