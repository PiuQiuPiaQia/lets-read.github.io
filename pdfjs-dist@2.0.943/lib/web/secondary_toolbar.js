"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SecondaryToolbar=void 0;var _createClass=function(){function e(e,t){for(var o=0;o<t.length;o++){var s=t[o];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}return function(t,o,s){return o&&e(t.prototype,o),s&&e(t,s),t}}(),_base_viewer=require("./base_viewer"),_pdf_cursor_tools=require("./pdf_cursor_tools"),_pdf_single_page_viewer=require("./pdf_single_page_viewer"),_ui_utils=require("./ui_utils");function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var SecondaryToolbar=function(){function e(t,o,s){var n=this;_classCallCheck(this,e),this.toolbar=t.toolbar,this.toggleButton=t.toggleButton,this.toolbarButtonContainer=t.toolbarButtonContainer,this.buttons=[{element:t.presentationModeButton,eventName:"presentationmode",close:!0},{element:t.openFileButton,eventName:"openfile",close:!0},{element:t.printButton,eventName:"print",close:!0},{element:t.downloadButton,eventName:"download",close:!0},{element:t.viewBookmarkButton,eventName:null,close:!0},{element:t.firstPageButton,eventName:"firstpage",close:!0},{element:t.lastPageButton,eventName:"lastpage",close:!0},{element:t.pageRotateCwButton,eventName:"rotatecw",close:!1},{element:t.pageRotateCcwButton,eventName:"rotateccw",close:!1},{element:t.cursorSelectToolButton,eventName:"switchcursortool",eventDetails:{tool:_pdf_cursor_tools.CursorTool.SELECT},close:!0},{element:t.cursorHandToolButton,eventName:"switchcursortool",eventDetails:{tool:_pdf_cursor_tools.CursorTool.HAND},close:!0},{element:t.scrollVerticalButton,eventName:"switchscrollmode",eventDetails:{mode:_base_viewer.ScrollMode.VERTICAL},close:!0},{element:t.scrollHorizontalButton,eventName:"switchscrollmode",eventDetails:{mode:_base_viewer.ScrollMode.HORIZONTAL},close:!0},{element:t.scrollWrappedButton,eventName:"switchscrollmode",eventDetails:{mode:_base_viewer.ScrollMode.WRAPPED},close:!0},{element:t.spreadNoneButton,eventName:"switchspreadmode",eventDetails:{mode:_base_viewer.SpreadMode.NONE},close:!0},{element:t.spreadOddButton,eventName:"switchspreadmode",eventDetails:{mode:_base_viewer.SpreadMode.ODD},close:!0},{element:t.spreadEvenButton,eventName:"switchspreadmode",eventDetails:{mode:_base_viewer.SpreadMode.EVEN},close:!0},{element:t.documentPropertiesButton,eventName:"documentproperties",close:!0}],this.items={firstPage:t.firstPageButton,lastPage:t.lastPageButton,pageRotateCw:t.pageRotateCwButton,pageRotateCcw:t.pageRotateCcwButton},this.mainContainer=o,this.eventBus=s,this.opened=!1,this.containerHeight=null,this.previousContainerHeight=null,this.reset(),this._bindClickListeners(),this._bindCursorToolsListener(t),this._bindScrollModeListener(t),this._bindSpreadModeListener(t),this.eventBus.on("resize",this._setMaxHeight.bind(this)),this.eventBus.on("baseviewerinit",(function(e){e.source instanceof _pdf_single_page_viewer.PDFSinglePageViewer?n.toolbarButtonContainer.classList.add("hiddenScrollModeButtons","hiddenSpreadModeButtons"):n.toolbarButtonContainer.classList.remove("hiddenScrollModeButtons","hiddenSpreadModeButtons")}))}return _createClass(e,[{key:"setPageNumber",value:function(e){this.pageNumber=e,this._updateUIState()}},{key:"setPagesCount",value:function(e){this.pagesCount=e,this._updateUIState()}},{key:"reset",value:function(){this.pageNumber=0,this.pagesCount=0,this._updateUIState(),this.eventBus.dispatch("secondarytoolbarreset",{source:this})}},{key:"_updateUIState",value:function(){this.items.firstPage.disabled=this.pageNumber<=1,this.items.lastPage.disabled=this.pageNumber>=this.pagesCount,this.items.pageRotateCw.disabled=0===this.pagesCount,this.items.pageRotateCcw.disabled=0===this.pagesCount}},{key:"_bindClickListeners",value:function(){var e=this;this.toggleButton.addEventListener("click",this.toggle.bind(this));var t=function(t){var o=e.buttons[t],s=o.element,n=o.eventName,a=o.close,i=o.eventDetails;s.addEventListener("click",(function(t){if(null!==n){var o={source:e};for(var s in i)o[s]=i[s];e.eventBus.dispatch(n,o)}a&&e.close()}))};for(var o in this.buttons)t(o)}},{key:"_bindCursorToolsListener",value:function(e){this.eventBus.on("cursortoolchanged",(function(t){switch(e.cursorSelectToolButton.classList.remove("toggled"),e.cursorHandToolButton.classList.remove("toggled"),t.tool){case _pdf_cursor_tools.CursorTool.SELECT:e.cursorSelectToolButton.classList.add("toggled");break;case _pdf_cursor_tools.CursorTool.HAND:e.cursorHandToolButton.classList.add("toggled");break}}))}},{key:"_bindScrollModeListener",value:function(e){var t=this;function o(t){switch(e.scrollVerticalButton.classList.remove("toggled"),e.scrollHorizontalButton.classList.remove("toggled"),e.scrollWrappedButton.classList.remove("toggled"),t.mode){case _base_viewer.ScrollMode.VERTICAL:e.scrollVerticalButton.classList.add("toggled");break;case _base_viewer.ScrollMode.HORIZONTAL:e.scrollHorizontalButton.classList.add("toggled");break;case _base_viewer.ScrollMode.WRAPPED:e.scrollWrappedButton.classList.add("toggled");break}var o=t.mode===_base_viewer.ScrollMode.HORIZONTAL;e.spreadNoneButton.disabled=o,e.spreadOddButton.disabled=o,e.spreadEvenButton.disabled=o}this.eventBus.on("scrollmodechanged",o),this.eventBus.on("secondarytoolbarreset",(function(e){e.source===t&&o({mode:_base_viewer.ScrollMode.VERTICAL})}))}},{key:"_bindSpreadModeListener",value:function(e){var t=this;function o(t){switch(e.spreadNoneButton.classList.remove("toggled"),e.spreadOddButton.classList.remove("toggled"),e.spreadEvenButton.classList.remove("toggled"),t.mode){case _base_viewer.SpreadMode.NONE:e.spreadNoneButton.classList.add("toggled");break;case _base_viewer.SpreadMode.ODD:e.spreadOddButton.classList.add("toggled");break;case _base_viewer.SpreadMode.EVEN:e.spreadEvenButton.classList.add("toggled");break}}this.eventBus.on("spreadmodechanged",o),this.eventBus.on("secondarytoolbarreset",(function(e){e.source===t&&o({mode:_base_viewer.SpreadMode.NONE})}))}},{key:"open",value:function(){this.opened||(this.opened=!0,this._setMaxHeight(),this.toggleButton.classList.add("toggled"),this.toolbar.classList.remove("hidden"))}},{key:"close",value:function(){this.opened&&(this.opened=!1,this.toolbar.classList.add("hidden"),this.toggleButton.classList.remove("toggled"))}},{key:"toggle",value:function(){this.opened?this.close():this.open()}},{key:"_setMaxHeight",value:function(){this.opened&&(this.containerHeight=this.mainContainer.clientHeight,this.containerHeight!==this.previousContainerHeight&&(this.toolbarButtonContainer.setAttribute("style","max-height: "+(this.containerHeight-_ui_utils.SCROLLBAR_PADDING)+"px;"),this.previousContainerHeight=this.containerHeight))}},{key:"isOpen",get:function(){return this.opened}}]),e}();exports.SecondaryToolbar=SecondaryToolbar;