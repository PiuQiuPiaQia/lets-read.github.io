"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PDFAttachmentViewer=void 0;var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),_pdf=require("../pdf");function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var PDFAttachmentViewer=function(){function e(t){var n=t.container,a=t.eventBus,i=t.downloadManager;_classCallCheck(this,e),this.container=n,this.eventBus=a,this.downloadManager=i,this.reset(),this.eventBus.on("fileattachmentannotation",this._appendAttachment.bind(this))}return _createClass(e,[{key:"reset",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.attachments=null,this.container.textContent="",e||(this._renderedCapability=(0,_pdf.createPromiseCapability)())}},{key:"_dispatchEvent",value:function(e){this._renderedCapability.resolve(),this.eventBus.dispatch("attachmentsloaded",{source:this,attachmentsCount:e})}},{key:"_bindPdfLink",value:function(e,t,n){if(this.downloadManager.disableCreateObjectURL)throw new Error('bindPdfLink: Unsupported "disableCreateObjectURL" value.');var a=void 0;e.onclick=function(){a||(a=(0,_pdf.createObjectURL)(t,"application/pdf"));var e=void 0;return e="?file="+encodeURIComponent(a+"#"+n),window.open(e),!1}}},{key:"_bindLink",value:function(e,t,n){var a=this;e.onclick=function(){return a.downloadManager.downloadData(t,n,""),!1}}},{key:"render",value:function(e){var t=e.attachments,n=e.keepRenderedCapability,a=void 0!==n&&n,i=0;if(this.attachments&&this.reset(!0===a),this.attachments=t||null,t){var r=Object.keys(t).sort((function(e,t){return e.toLowerCase().localeCompare(t.toLowerCase())}));i=r.length;for(var o=0;o<i;o++){var s=t[r[o]],c=(0,_pdf.removeNullCharacters)((0,_pdf.getFilenameFromUrl)(s.filename)),l=document.createElement("div");l.className="attachmentsItem";var d=document.createElement("button");d.textContent=c,/\.pdf$/i.test(c)&&!this.downloadManager.disableCreateObjectURL?this._bindPdfLink(d,s.content,c):this._bindLink(d,s.content,c),l.appendChild(d),this.container.appendChild(l)}this._dispatchEvent(i)}else this._dispatchEvent(i)}},{key:"_appendAttachment",value:function(e){var t=this,n=e.id,a=e.filename,i=e.content;this._renderedCapability.promise.then((function(){var e=t.attachments;if(e){for(var r in e)if(n===r)return}else e=Object.create(null);e[n]={filename:a,content:i},t.render({attachments:e,keepRenderedCapability:!0})}))}}]),e}();exports.PDFAttachmentViewer=PDFAttachmentViewer;