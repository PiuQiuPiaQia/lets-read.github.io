"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ViewHistory=void 0;var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _asyncToGenerator(e){return function(){var r=e.apply(this,arguments);return new Promise((function(e,t){function n(i,a){try{var o=r[i](a),u=o.value}catch(s){return void t(s)}if(!o.done)return Promise.resolve(u).then((function(e){n("next",e)}),(function(e){n("throw",e)}));e(u)}return n("next")}))}}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var DEFAULT_VIEW_HISTORY_CACHE_SIZE=20,ViewHistory=function(){function e(r){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:DEFAULT_VIEW_HISTORY_CACHE_SIZE;_classCallCheck(this,e),this.fingerprint=r,this.cacheSize=n,this._initializedPromise=this._readFromStorage().then((function(e){var r=JSON.parse(e||"{}");if("files"in r)while(r.files.length>=t.cacheSize)r.files.shift();else r.files=[];for(var n=-1,i=0,a=r.files.length;i<a;i++){var o=r.files[i];if(o.fingerprint===t.fingerprint){n=i;break}}-1===n&&(n=r.files.push({fingerprint:t.fingerprint})-1),t.file=r.files[n],t.database=r}))}return _createClass(e,[{key:"_writeToStorage",value:function(){var e=_asyncToGenerator(_regenerator2.default.mark((function e(){var r;return _regenerator2.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=JSON.stringify(this.database),localStorage.setItem("pdfjs.history",r);case 2:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"_readFromStorage",value:function(){var e=_asyncToGenerator(_regenerator2.default.mark((function e(){return _regenerator2.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",localStorage.getItem("pdfjs.history"));case 1:case"end":return e.stop()}}),e,this)})));function r(){return e.apply(this,arguments)}return r}()},{key:"set",value:function(){var e=_asyncToGenerator(_regenerator2.default.mark((function e(r,t){return _regenerator2.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._initializedPromise;case 2:return this.file[r]=t,e.abrupt("return",this._writeToStorage());case 4:case"end":return e.stop()}}),e,this)})));function r(r,t){return e.apply(this,arguments)}return r}()},{key:"setMultiple",value:function(){var e=_asyncToGenerator(_regenerator2.default.mark((function e(r){var t;return _regenerator2.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._initializedPromise;case 2:for(t in r)this.file[t]=r[t];return e.abrupt("return",this._writeToStorage());case 4:case"end":return e.stop()}}),e,this)})));function r(r){return e.apply(this,arguments)}return r}()},{key:"get",value:function(){var e=_asyncToGenerator(_regenerator2.default.mark((function e(r,t){var n;return _regenerator2.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._initializedPromise;case 2:return n=this.file[r],e.abrupt("return",void 0!==n?n:t);case 4:case"end":return e.stop()}}),e,this)})));function r(r,t){return e.apply(this,arguments)}return r}()},{key:"getMultiple",value:function(){var e=_asyncToGenerator(_regenerator2.default.mark((function e(r){var t,n,i;return _regenerator2.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this._initializedPromise;case 2:for(n in t=Object.create(null),r)i=this.file[n],t[n]=void 0!==i?i:r[n];return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));function r(r){return e.apply(this,arguments)}return r}()}]),e}();exports.ViewHistory=ViewHistory;