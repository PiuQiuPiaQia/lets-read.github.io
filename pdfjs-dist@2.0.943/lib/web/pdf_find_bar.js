"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PDFFindBar=void 0;var _createClass=function(){function t(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,i,n){return i&&t(e.prototype,i),n&&t(e,n),e}}(),_ui_utils=require("./ui_utils"),_pdf_find_controller=require("./pdf_find_controller");function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var MATCHES_COUNT_LIMIT=1e3,PDFFindBar=function(){function t(e){var i=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(0,_ui_utils.getGlobalEventBus)(),s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_ui_utils.NullL10n;_classCallCheck(this,t),this.opened=!1,this.bar=e.bar||null,this.toggleButton=e.toggleButton||null,this.findField=e.findField||null,this.highlightAll=e.highlightAllCheckbox||null,this.caseSensitive=e.caseSensitiveCheckbox||null,this.entireWord=e.entireWordCheckbox||null,this.findMsg=e.findMsg||null,this.findResultsCount=e.findResultsCount||null,this.findPreviousButton=e.findPreviousButton||null,this.findNextButton=e.findNextButton||null,this.eventBus=n,this.l10n=s,this.toggleButton.addEventListener("click",(function(){i.toggle()})),this.findField.addEventListener("input",(function(){i.dispatchEvent("")})),this.bar.addEventListener("keydown",(function(t){switch(t.keyCode){case 13:t.target===i.findField&&i.dispatchEvent("again",t.shiftKey);break;case 27:i.close();break}})),this.findPreviousButton.addEventListener("click",(function(){i.dispatchEvent("again",!0)})),this.findNextButton.addEventListener("click",(function(){i.dispatchEvent("again",!1)})),this.highlightAll.addEventListener("click",(function(){i.dispatchEvent("highlightallchange")})),this.caseSensitive.addEventListener("click",(function(){i.dispatchEvent("casesensitivitychange")})),this.entireWord.addEventListener("click",(function(){i.dispatchEvent("entirewordchange")})),this.eventBus.on("resize",this._adjustWidth.bind(this))}return _createClass(t,[{key:"reset",value:function(){this.updateUIState()}},{key:"dispatchEvent",value:function(t,e){this.eventBus.dispatch("find",{source:this,type:t,query:this.findField.value,phraseSearch:!0,caseSensitive:this.caseSensitive.checked,entireWord:this.entireWord.checked,highlightAll:this.highlightAll.checked,findPrevious:e})}},{key:"updateUIState",value:function(t,e,i){var n=this,s=!1,d="",l="";switch(t){case _pdf_find_controller.FindState.FOUND:break;case _pdf_find_controller.FindState.PENDING:l="pending";break;case _pdf_find_controller.FindState.NOT_FOUND:d=this.l10n.get("find_not_found",null,"Phrase not found"),s=!0;break;case _pdf_find_controller.FindState.WRAPPED:d=e?this.l10n.get("find_reached_top",null,"Reached top of document, continued from bottom"):this.l10n.get("find_reached_bottom",null,"Reached end of document, continued from top");break}this.findField.classList.toggle("notFound",s),this.findField.setAttribute("data-status",l),Promise.resolve(d).then((function(t){n.findMsg.textContent=t,n._adjustWidth()})),this.updateResultsCount(i)}},{key:"updateResultsCount",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=e.current,n=void 0===i?0:i,s=e.total,d=void 0===s?0:s;if(this.findResultsCount){var l="",o=MATCHES_COUNT_LIMIT;d>0&&(l=d>o?this.l10n.get("find_match_count_limit",{limit:o},"More than {{limit}} match"+(1!==o?"es":"")):this.l10n.get("find_match_count",{current:n,total:d},"{{current}} of {{total}} match"+(1!==d?"es":""))),Promise.resolve(l).then((function(e){t.findResultsCount.textContent=e,t.findResultsCount.classList[d?"remove":"add"]("hidden"),t._adjustWidth()}))}}},{key:"open",value:function(){this.opened||(this.opened=!0,this.toggleButton.classList.add("toggled"),this.bar.classList.remove("hidden")),this.findField.select(),this.findField.focus(),this._adjustWidth()}},{key:"close",value:function(){this.opened&&(this.opened=!1,this.toggleButton.classList.remove("toggled"),this.bar.classList.add("hidden"),this.eventBus.dispatch("findbarclose",{source:this}))}},{key:"toggle",value:function(){this.opened?this.close():this.open()}},{key:"_adjustWidth",value:function(){if(this.opened){this.bar.classList.remove("wrapContainers");var t=this.bar.clientHeight,e=this.bar.firstElementChild.clientHeight;t>e&&this.bar.classList.add("wrapContainers")}}}]),t}();exports.PDFFindBar=PDFFindBar;