"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.PDFSidebar=exports.SidebarView=void 0;var _createClass=function(){function i(i,t){for(var e=0;e<t.length;e++){var s=t[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(i,s.key,s)}}return function(t,e,s){return e&&i(t.prototype,e),s&&i(t,s),t}}(),_ui_utils=require("./ui_utils"),_pdf_rendering_queue=require("./pdf_rendering_queue");function _classCallCheck(i,t){if(!(i instanceof t))throw new TypeError("Cannot call a class as a function")}var UI_NOTIFICATION_CLASS="pdfSidebarNotification",SidebarView={NONE:0,THUMBS:1,OUTLINE:2,ATTACHMENTS:3},PDFSidebar=function(){function i(t,e){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:_ui_utils.NullL10n;_classCallCheck(this,i),this.isOpen=!1,this.active=SidebarView.THUMBS,this.isInitialViewSet=!1,this.onToggled=null,this.pdfViewer=t.pdfViewer,this.pdfThumbnailViewer=t.pdfThumbnailViewer,this.outerContainer=t.outerContainer,this.viewerContainer=t.viewerContainer,this.toggleButton=t.toggleButton,this.thumbnailButton=t.thumbnailButton,this.outlineButton=t.outlineButton,this.attachmentsButton=t.attachmentsButton,this.thumbnailView=t.thumbnailView,this.outlineView=t.outlineView,this.attachmentsView=t.attachmentsView,this.disableNotification=t.disableNotification||!1,this.eventBus=e,this.l10n=s,this._addEventListeners()}return _createClass(i,[{key:"reset",value:function(){this.isInitialViewSet=!1,this._hideUINotification(null),this.switchView(SidebarView.THUMBS),this.outlineButton.disabled=!1,this.attachmentsButton.disabled=!1}},{key:"setInitialView",value:function(){var i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:SidebarView.NONE;if(!this.isInitialViewSet)if(this.isInitialViewSet=!0,this.isOpen&&i===SidebarView.NONE)this._dispatchEvent();else{var t=i===this.visibleView;this.switchView(i,!0),t&&this._dispatchEvent()}}},{key:"switchView",value:function(i){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(i!==SidebarView.NONE){var e=i!==this.active,s=!1;switch(i){case SidebarView.THUMBS:this.thumbnailButton.classList.add("toggled"),this.outlineButton.classList.remove("toggled"),this.attachmentsButton.classList.remove("toggled"),this.thumbnailView.classList.remove("hidden"),this.outlineView.classList.add("hidden"),this.attachmentsView.classList.add("hidden"),this.isOpen&&e&&(this._updateThumbnailViewer(),s=!0);break;case SidebarView.OUTLINE:if(this.outlineButton.disabled)return;this.thumbnailButton.classList.remove("toggled"),this.outlineButton.classList.add("toggled"),this.attachmentsButton.classList.remove("toggled"),this.thumbnailView.classList.add("hidden"),this.outlineView.classList.remove("hidden"),this.attachmentsView.classList.add("hidden");break;case SidebarView.ATTACHMENTS:if(this.attachmentsButton.disabled)return;this.thumbnailButton.classList.remove("toggled"),this.outlineButton.classList.remove("toggled"),this.attachmentsButton.classList.add("toggled"),this.thumbnailView.classList.add("hidden"),this.outlineView.classList.add("hidden"),this.attachmentsView.classList.remove("hidden");break;default:return void console.error('PDFSidebar_switchView: "'+i+'" is an unsupported value.')}this.active=0|i,!t||this.isOpen?(s&&this._forceRendering(),e&&this._dispatchEvent(),this._hideUINotification(this.active)):this.open()}else this.close()}},{key:"open",value:function(){this.isOpen||(this.isOpen=!0,this.toggleButton.classList.add("toggled"),this.outerContainer.classList.add("sidebarMoving"),this.outerContainer.classList.add("sidebarOpen"),this.active===SidebarView.THUMBS&&this._updateThumbnailViewer(),this._forceRendering(),this._dispatchEvent(),this._hideUINotification(this.active))}},{key:"close",value:function(){this.isOpen&&(this.isOpen=!1,this.toggleButton.classList.remove("toggled"),this.outerContainer.classList.add("sidebarMoving"),this.outerContainer.classList.remove("sidebarOpen"),this._forceRendering(),this._dispatchEvent())}},{key:"toggle",value:function(){this.isOpen?this.close():this.open()}},{key:"_dispatchEvent",value:function(){this.eventBus.dispatch("sidebarviewchanged",{source:this,view:this.visibleView})}},{key:"_forceRendering",value:function(){this.onToggled?this.onToggled():(this.pdfViewer.forceRendering(),this.pdfThumbnailViewer.forceRendering())}},{key:"_updateThumbnailViewer",value:function(){for(var i=this.pdfViewer,t=this.pdfThumbnailViewer,e=i.pagesCount,s=0;s<e;s++){var n=i.getPageView(s);if(n&&n.renderingState===_pdf_rendering_queue.RenderingStates.FINISHED){var a=t.getThumbnail(s);a.setImage(n)}}t.scrollThumbnailIntoView(i.currentPageNumber)}},{key:"_showUINotification",value:function(i){var t=this;if(!this.disableNotification){if(this.l10n.get("toggle_sidebar_notification.title",null,"Toggle Sidebar (document contains outline/attachments)").then((function(i){t.toggleButton.title=i})),this.isOpen){if(i===this.active)return}else this.toggleButton.classList.add(UI_NOTIFICATION_CLASS);switch(i){case SidebarView.OUTLINE:this.outlineButton.classList.add(UI_NOTIFICATION_CLASS);break;case SidebarView.ATTACHMENTS:this.attachmentsButton.classList.add(UI_NOTIFICATION_CLASS);break}}}},{key:"_hideUINotification",value:function(i){var t=this;if(!this.disableNotification){var e=function(i){switch(i){case SidebarView.OUTLINE:t.outlineButton.classList.remove(UI_NOTIFICATION_CLASS);break;case SidebarView.ATTACHMENTS:t.attachmentsButton.classList.remove(UI_NOTIFICATION_CLASS);break}};if(this.isOpen||null===i)if(this.toggleButton.classList.remove(UI_NOTIFICATION_CLASS),null===i){for(i in SidebarView)e(SidebarView[i]);this.l10n.get("toggle_sidebar.title",null,"Toggle Sidebar").then((function(i){t.toggleButton.title=i}))}else e(i)}}},{key:"_addEventListeners",value:function(){var i=this;this.viewerContainer.addEventListener("transitionend",(function(t){t.target===i.viewerContainer&&i.outerContainer.classList.remove("sidebarMoving")})),this.thumbnailButton.addEventListener("click",(function(){i.switchView(SidebarView.THUMBS)})),this.outlineButton.addEventListener("click",(function(){i.switchView(SidebarView.OUTLINE)})),this.outlineButton.addEventListener("dblclick",(function(){i.eventBus.dispatch("toggleoutlinetree",{source:i})})),this.attachmentsButton.addEventListener("click",(function(){i.switchView(SidebarView.ATTACHMENTS)})),this.eventBus.on("outlineloaded",(function(t){var e=t.outlineCount;i.outlineButton.disabled=!e,e?i._showUINotification(SidebarView.OUTLINE):i.active===SidebarView.OUTLINE&&i.switchView(SidebarView.THUMBS)})),this.eventBus.on("attachmentsloaded",(function(t){if(t.attachmentsCount)return i.attachmentsButton.disabled=!1,void i._showUINotification(SidebarView.ATTACHMENTS);Promise.resolve().then((function(){i.attachmentsView.hasChildNodes()||(i.attachmentsButton.disabled=!0,i.active===SidebarView.ATTACHMENTS&&i.switchView(SidebarView.THUMBS))}))})),this.eventBus.on("presentationmodechanged",(function(t){t.active||t.switchInProgress||!i.isThumbnailViewVisible||i._updateThumbnailViewer()}))}},{key:"visibleView",get:function(){return this.isOpen?this.active:SidebarView.NONE}},{key:"isThumbnailViewVisible",get:function(){return this.isOpen&&this.active===SidebarView.THUMBS}},{key:"isOutlineViewVisible",get:function(){return this.isOpen&&this.active===SidebarView.OUTLINE}},{key:"isAttachmentsViewVisible",get:function(){return this.isOpen&&this.active===SidebarView.ATTACHMENTS}}]),i}();exports.SidebarView=SidebarView,exports.PDFSidebar=PDFSidebar;