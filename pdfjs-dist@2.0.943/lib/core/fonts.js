"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getFontType=exports.IdentityToUnicodeMap=exports.ToUnicodeMap=exports.FontFlags=exports.Font=exports.ErrorFont=exports.SEAC_ANALYSIS_ENABLED=void 0;var _slicedToArray=function(){function t(t,e){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(r=(o=s.next()).done);r=!0)if(n.push(o.value),e&&n.length===e)break}catch(l){a=!0,i=l}finally{try{!r&&s["return"]&&s["return"]()}finally{if(a)throw i}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_util=require("../shared/util"),_cff_parser=require("./cff_parser"),_glyphlist=require("./glyphlist"),_encodings=require("./encodings"),_standard_fonts=require("./standard_fonts"),_unicode=require("./unicode"),_font_renderer=require("./font_renderer"),_cmap=require("./cmap"),_stream=require("./stream"),_type1_parser=require("./type1_parser"),PRIVATE_USE_AREAS=[[57344,63743],[1048576,1114109]],PDF_GLYPH_SPACE_UNITS=1e3,SEAC_ANALYSIS_ENABLED=!0,FontFlags={FixedPitch:1,Serif:2,Symbolic:4,Script:8,Nonsymbolic:32,Italic:64,AllCap:65536,SmallCap:131072,ForceBold:262144},MacStandardGlyphOrdering=[".notdef",".null","nonmarkingreturn","space","exclam","quotedbl","numbersign","dollar","percent","ampersand","quotesingle","parenleft","parenright","asterisk","plus","comma","hyphen","period","slash","zero","one","two","three","four","five","six","seven","eight","nine","colon","semicolon","less","equal","greater","question","at","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","bracketleft","backslash","bracketright","asciicircum","underscore","grave","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","braceleft","bar","braceright","asciitilde","Adieresis","Aring","Ccedilla","Eacute","Ntilde","Odieresis","Udieresis","aacute","agrave","acircumflex","adieresis","atilde","aring","ccedilla","eacute","egrave","ecircumflex","edieresis","iacute","igrave","icircumflex","idieresis","ntilde","oacute","ograve","ocircumflex","odieresis","otilde","uacute","ugrave","ucircumflex","udieresis","dagger","degree","cent","sterling","section","bullet","paragraph","germandbls","registered","copyright","trademark","acute","dieresis","notequal","AE","Oslash","infinity","plusminus","lessequal","greaterequal","yen","mu","partialdiff","summation","product","pi","integral","ordfeminine","ordmasculine","Omega","ae","oslash","questiondown","exclamdown","logicalnot","radical","florin","approxequal","Delta","guillemotleft","guillemotright","ellipsis","nonbreakingspace","Agrave","Atilde","Otilde","OE","oe","endash","emdash","quotedblleft","quotedblright","quoteleft","quoteright","divide","lozenge","ydieresis","Ydieresis","fraction","currency","guilsinglleft","guilsinglright","fi","fl","daggerdbl","periodcentered","quotesinglbase","quotedblbase","perthousand","Acircumflex","Ecircumflex","Aacute","Edieresis","Egrave","Iacute","Icircumflex","Idieresis","Igrave","Oacute","Ocircumflex","apple","Ograve","Uacute","Ucircumflex","Ugrave","dotlessi","circumflex","tilde","macron","breve","dotaccent","ring","cedilla","hungarumlaut","ogonek","caron","Lslash","lslash","Scaron","scaron","Zcaron","zcaron","brokenbar","Eth","eth","Yacute","yacute","Thorn","thorn","minus","multiply","onesuperior","twosuperior","threesuperior","onehalf","onequarter","threequarters","franc","Gbreve","gbreve","Idotaccent","Scedilla","scedilla","Cacute","cacute","Ccaron","ccaron","dcroat"];function adjustWidths(t){if(t.fontMatrix&&t.fontMatrix[0]!==_util.FONT_IDENTITY_MATRIX[0]){var e=.001/t.fontMatrix[0],n=t.widths;for(var r in n)n[r]*=e;t.defaultWidth*=e}}function adjustToUnicode(t,e){if(!t.hasIncludedToUnicodeMap&&!t.hasEncoding&&e!==t.defaultEncoding&&!(t.toUnicode instanceof IdentityToUnicodeMap)){var n=[],r=(0,_glyphlist.getGlyphsUnicode)();for(var a in e){var i=e[a],o=(0,_unicode.getUnicodeForGlyph)(i,r);-1!==o&&(n[a]=String.fromCharCode(o))}t.toUnicode.amend(n)}}function getFontType(t,e){switch(t){case"Type1":return"Type1C"===e?_util.FontType.TYPE1C:_util.FontType.TYPE1;case"CIDFontType0":return"CIDFontType0C"===e?_util.FontType.CIDFONTTYPE0C:_util.FontType.CIDFONTTYPE0;case"OpenType":return _util.FontType.OPENTYPE;case"TrueType":return _util.FontType.TRUETYPE;case"CIDFontType2":return _util.FontType.CIDFONTTYPE2;case"MMType1":return _util.FontType.MMTYPE1;case"Type0":return _util.FontType.TYPE0;default:return _util.FontType.UNKNOWN}}function recoverGlyphName(t,e){if(void 0!==e[t])return t;var n=(0,_unicode.getUnicodeForGlyph)(t,e);if(-1!==n)for(var r in e)if(e[r]===n)return r;return(0,_util.info)("Unable to recover a standard glyph name for: "+t),t}var Glyph=function(){function t(t,e,n,r,a,i,o,s){this.fontChar=t,this.unicode=e,this.accent=n,this.width=r,this.vmetric=a,this.operatorListId=i,this.isSpace=o,this.isInFont=s}return t.prototype.matchesForCache=function(t,e,n,r,a,i,o,s){return this.fontChar===t&&this.unicode===e&&this.accent===n&&this.width===r&&this.vmetric===a&&this.operatorListId===i&&this.isSpace===o&&this.isInFont===s},t}(),ToUnicodeMap=function(){function t(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._map=t}return t.prototype={get length(){return this._map.length},forEach:function(t){for(var e in this._map)t(e,this._map[e].charCodeAt(0))},has:function(t){return void 0!==this._map[t]},get:function(t){return this._map[t]},charCodeOf:function(t){var e=this._map;if(e.length<=65536)return e.indexOf(t);for(var n in e)if(e[n]===t)return 0|n;return-1},amend:function(t){for(var e in t)this._map[e]=t[e]}},t}(),IdentityToUnicodeMap=function(){function t(t,e){this.firstChar=t,this.lastChar=e}return t.prototype={get length(){return this.lastChar+1-this.firstChar},forEach:function(t){for(var e=this.firstChar,n=this.lastChar;e<=n;e++)t(e,e)},has:function(t){return this.firstChar<=t&&t<=this.lastChar},get:function(t){if(this.firstChar<=t&&t<=this.lastChar)return String.fromCharCode(t)},charCodeOf:function(t){return Number.isInteger(t)&&t>=this.firstChar&&t<=this.lastChar?t:-1},amend:function(t){(0,_util.unreachable)("Should not call amend()")}},t}(),OpenTypeFileBuilder=function(){function t(t,e,n){t[e]=n>>8&255,t[e+1]=255&n}function e(t,e,n){t[e]=n>>24&255,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n}function n(t,e,n){var r,a;if(n instanceof Uint8Array)t.set(n,e);else if("string"===typeof n)for(r=0,a=n.length;r<a;r++)t[e++]=255&n.charCodeAt(r);else for(r=0,a=n.length;r<a;r++)t[e++]=255&n[r]}function r(t){this.sfnt=t,this.tables=Object.create(null)}r.getSearchParams=function(t,e){var n=1,r=0;while((n^t)>n)n<<=1,r++;var a=n*e;return{range:a,entry:r,rangeShift:e*t-a}};var a=12,i=16;return r.prototype={toArray:function(){var o=this.sfnt,s=this.tables,l=Object.keys(s);l.sort();var h,c,f,d,u,p=l.length,g=a+p*i,v=[g];for(h=0;h<p;h++){d=s[l[h]];var y=(d.length+3&-4)>>>0;g+=y,v.push(g)}var m=new Uint8Array(g);for(h=0;h<p;h++)d=s[l[h]],n(m,v[h],d);"true"===o&&(o=(0,_util.string32)(65536)),m[0]=255&o.charCodeAt(0),m[1]=255&o.charCodeAt(1),m[2]=255&o.charCodeAt(2),m[3]=255&o.charCodeAt(3),t(m,4,p);var _=r.getSearchParams(p,16);for(t(m,6,_.range),t(m,8,_.entry),t(m,10,_.rangeShift),g=a,h=0;h<p;h++){u=l[h],m[g]=255&u.charCodeAt(0),m[g+1]=255&u.charCodeAt(1),m[g+2]=255&u.charCodeAt(2),m[g+3]=255&u.charCodeAt(3);var T=0;for(c=v[h],f=v[h+1];c<f;c+=4){var F=(0,_util.readUint32)(m,c);T=T+F>>>0}e(m,g+4,T),e(m,g+8,v[h]),e(m,g+12,s[u].length),g+=i}return m},addTable:function(t,e){if(t in this.tables)throw new Error("Table "+t+" already exists");this.tables[t]=e}},r}(),Font=function(){function t(t,e,n){var r;this.name=t,this.loadedName=n.loadedName,this.isType3Font=n.isType3Font,this.sizes=[],this.missingFile=!1,this.glyphCache=Object.create(null),this.isSerifFont=!!(n.flags&FontFlags.Serif),this.isSymbolicFont=!!(n.flags&FontFlags.Symbolic),this.isMonospace=!!(n.flags&FontFlags.FixedPitch);var a=n.type,i=n.subtype;if(this.type=a,this.subtype=i,this.fallbackName=this.isMonospace?"monospace":this.isSerifFont?"serif":"sans-serif",this.differences=n.differences,this.widths=n.widths,this.defaultWidth=n.defaultWidth,this.composite=n.composite,this.wideChars=n.wideChars,this.cMap=n.cMap,this.ascent=n.ascent/PDF_GLYPH_SPACE_UNITS,this.descent=n.descent/PDF_GLYPH_SPACE_UNITS,this.fontMatrix=n.fontMatrix,this.bbox=n.bbox,this.defaultEncoding=n.defaultEncoding,this.toUnicode=n.toUnicode,this.fallbackToUnicode=n.fallbackToUnicode||new ToUnicodeMap,this.toFontChar=[],"Type3"!==n.type){if(this.cidEncoding=n.cidEncoding,this.vertical=n.vertical,this.vertical&&(this.vmetrics=n.vmetrics,this.defaultVMetrics=n.defaultVMetrics),!e||e.isEmpty)return e&&(0,_util.warn)('Font file is empty in "'+t+'" ('+this.loadedName+")"),void this.fallbackToSystemFont();var o=d(e,n),s=_slicedToArray(o,2);a=s[0],i=s[1],a===this.type&&i===this.subtype||(0,_util.info)("Inconsistent font file Type/SubType, expected: "+this.type+"/"+this.subtype+" but found: "+a+"/"+i+".");try{var l;switch(a){case"MMType1":(0,_util.info)("MMType1 font ("+t+"), falling back to Type1.");case"Type1":case"CIDFontType0":this.mimetype="font/opentype";var h="Type1C"===i||"CIDFontType0C"===i?new CFFFont(e,n):new Type1Font(t,e,n);adjustWidths(n),l=this.convert(t,h,n);break;case"OpenType":case"TrueType":case"CIDFontType2":this.mimetype="font/opentype",l=this.checkAndRepair(t,e,n),this.isOpenType&&(adjustWidths(n),a="OpenType");break;default:throw new _util.FormatError("Font "+a+" is not supported")}}catch(c){return(0,_util.warn)(c),void this.fallbackToSystemFont()}this.data=l,this.fontType=getFontType(a,i),this.fontMatrix=n.fontMatrix,this.widths=n.widths,this.defaultWidth=n.defaultWidth,this.toUnicode=n.toUnicode,this.encoding=n.baseEncoding,this.seacMap=n.seacMap}else{for(r=0;r<256;r++)this.toFontChar[r]=this.differences[r]||n.defaultEncoding[r];this.fontType=_util.FontType.TYPE3}}function e(t,e){return(t<<8)+e}function n(t,e,n){t[e+1]=n,t[e]=n>>>8}function r(t,e){var n=(t<<8)+e;return 32768&n?n-65536:n}function a(t,e,n,r){return(t<<24)+(e<<16)+(n<<8)+r}function i(t){return String.fromCharCode(t>>8&255,255&t)}function o(t){return t=t>32767?32767:t<-32768?-32768:t,String.fromCharCode(t>>8&255,255&t)}function s(t){var e=t.peekBytes(4);return 65536===(0,_util.readUint32)(e,0)||"true"===(0,_util.bytesToString)(e)}function l(t){var e=t.peekBytes(4);return"ttcf"===(0,_util.bytesToString)(e)}function h(t){var e=t.peekBytes(4);return"OTTO"===(0,_util.bytesToString)(e)}function c(t){var e=t.peekBytes(2);return 37===e[0]&&33===e[1]||128===e[0]&&1===e[1]}function f(t){var e=t.peekBytes(4);return e[0]>=1&&e[3]>=1&&e[3]<=4}function d(t,e){var n=e.type,r=e.subtype,a=e.composite,i=void 0,o=void 0;return s(t)||l(t)?i=a?"CIDFontType2":"TrueType":h(t)?i=a?"CIDFontType2":"OpenType":c(t)?i=a?"CIDFontType0":"MMType1"===n?"MMType1":"Type1":f(t)?a?(i="CIDFontType0",o="CIDFontType0C"):(i="MMType1"===n?"MMType1":"Type1",o="Type1C"):((0,_util.warn)("getFontFileType: Unable to detect correct font file Type/Subtype."),i=n,o=r),[i,o]}function u(t,e,n){for(var r,a=[],i=0,o=t.length;i<o;i++)r=(0,_unicode.getUnicodeForGlyph)(t[i],e),-1!==r&&(a[i]=r);for(var s in n)r=(0,_unicode.getUnicodeForGlyph)(n[s],e),-1!==r&&(a[+s]=r);return a}function p(t,e,n){var r=Object.create(null),a=[],i=0,o=PRIVATE_USE_AREAS[i][0],s=PRIVATE_USE_AREAS[i][1];for(var l in t){l|=0;var h=t[l];if(e(h)){if(o>s){if(i++,i>=PRIVATE_USE_AREAS.length){(0,_util.warn)("Ran out of space in font private use area.");break}o=PRIVATE_USE_AREAS[i][0],s=PRIVATE_USE_AREAS[i][1]}var c=o++;0===h&&(h=n),r[c]=h,a[l]=c}}return{toFontChar:a,charCodeToGlyphId:r,nextAvailableFontCharCode:o}}function g(t,e){var n=[];for(var r in t)t[r]>=e||n.push({fontCharCode:0|r,glyphId:t[r]});0===n.length&&n.push({fontCharCode:0,glyphId:0}),n.sort((function(t,e){return t.fontCharCode-e.fontCharCode}));for(var a=[],i=n.length,o=0;o<i;){var s=n[o].fontCharCode,l=[n[o].glyphId];++o;var h=s;while(o<i&&h+1===n[o].fontCharCode)if(l.push(n[o].glyphId),++h,++o,65535===h)break;a.push([s,h,l])}return a}function v(t,e){var n,r,a,o,s=g(t,e),l=s[s.length-1][1]>65535?2:1,h="\0\0"+i(l)+"\0\x03\0\x01"+(0,_util.string32)(4+8*l);for(n=s.length-1;n>=0;--n)if(s[n][0]<=65535)break;var c=n+1;s[n][0]<65535&&65535===s[n][1]&&(s[n][1]=65534);var f,d,u,p,v=s[n][1]<65535?1:0,y=c+v,m=OpenTypeFileBuilder.getSearchParams(y,2),_="",T="",F="",C="",b="",S=0;for(n=0,r=c;n<r;n++){f=s[n],d=f[0],u=f[1],_+=i(d),T+=i(u),p=f[2];var w=!0;for(a=1,o=p.length;a<o;++a)if(p[a]!==p[a-1]+1){w=!1;break}if(w){var E=p[0];F+=i(E-d&65535),C+=i(0)}else{var I=2*(y-n)+2*S;for(S+=u-d+1,F+=i(0),C+=i(I),a=0,o=p.length;a<o;++a)b+=i(p[a])}}v>0&&(T+="\xff\xff",_+="\xff\xff",F+="\0\x01",C+="\0\0");var U="\0\0"+i(2*y)+i(m.range)+i(m.entry)+i(m.rangeShift)+T+"\0\0"+_+F+C+b,x="",A="";if(l>1){for(h+="\0\x03\0\n"+(0,_util.string32)(4+8*l+4+U.length),x="",n=0,r=s.length;n<r;n++){f=s[n],d=f[0],p=f[2];var M=p[0];for(a=1,o=p.length;a<o;++a)p[a]!==p[a-1]+1&&(u=f[0]+a-1,x+=(0,_util.string32)(d)+(0,_util.string32)(u)+(0,_util.string32)(M),d=u+1,M=p[a]);x+=(0,_util.string32)(d)+(0,_util.string32)(f[1])+(0,_util.string32)(M)}A="\0\f\0\0"+(0,_util.string32)(x.length+16)+"\0\0\0\0"+(0,_util.string32)(x.length/12)}return h+"\0\x04"+i(U.length+4)+U+A+x}function y(t){var e=new _stream.Stream(t.data),n=e.getUint16();e.getBytes(60);var r=e.getUint16();if(n<4&&768&r)return!1;var a=e.getUint16(),i=e.getUint16();if(a>i)return!1;e.getBytes(6);var o=e.getUint16();return 0!==o&&(t.data[8]=t.data[9]=0,!0)}function m(t,e,n){n=n||{unitsPerEm:0,yMax:0,yMin:0,ascent:0,descent:0};var r=0,a=0,o=0,s=0,l=null,h=0;if(e){for(var c in e){c|=0,(l>c||!l)&&(l=c),h<c&&(h=c);var f=(0,_unicode.getUnicodeRangeFor)(c);if(f<32)r|=1<<f;else if(f<64)a|=1<<f-32;else if(f<96)o|=1<<f-64;else{if(!(f<123))throw new _util.FormatError("Unicode ranges Bits > 123 are reserved for internal usage");s|=1<<f-96}}h>65535&&(h=65535)}else l=0,h=255;var d=t.bbox||[0,0,0,0],u=n.unitsPerEm||1/(t.fontMatrix||_util.FONT_IDENTITY_MATRIX)[0],p=t.ascentScaled?1:u/PDF_GLYPH_SPACE_UNITS,g=n.ascent||Math.round(p*(t.ascent||d[3])),v=n.descent||Math.round(p*(t.descent||d[1]));v>0&&t.descent>0&&d[1]<0&&(v=-v);var y=n.yMax||g,m=-n.yMin||-v;return"\0\x03\x02$\x01\xf4\0\x05\0\0\x02\x8a\x02\xbb\0\0\0\x8c\x02\x8a\x02\xbb\0\0\x01\xdf\x001\x01\x02\0\0\0\0\x06"+String.fromCharCode(t.fixedPitch?9:0)+"\0\0\0\0\0\0"+(0,_util.string32)(r)+(0,_util.string32)(a)+(0,_util.string32)(o)+(0,_util.string32)(s)+"*21*"+i(t.italicAngle?1:0)+i(l||t.firstChar)+i(h||t.lastChar)+i(g)+i(v)+"\0d"+i(y)+i(m)+"\0\0\0\0\0\0\0\0"+i(t.xHeight)+i(t.capHeight)+i(0)+i(l||t.firstChar)+"\0\x03"}function _(t){var e=Math.floor(t.italicAngle*Math.pow(2,16));return"\0\x03\0\0"+(0,_util.string32)(e)+"\0\0\0\0"+(0,_util.string32)(t.fixedPitch)+"\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0\0"}function T(t,e){e||(e=[[],[]]);var n,r,a,o,s,l=[e[0][0]||"Original licence",e[0][1]||t,e[0][2]||"Unknown",e[0][3]||"uniqueID",e[0][4]||t,e[0][5]||"Version 0.11",e[0][6]||"",e[0][7]||"Unknown",e[0][8]||"Unknown",e[0][9]||"Unknown"],h=[];for(n=0,r=l.length;n<r;n++){s=e[1][n]||l[n];var c=[];for(a=0,o=s.length;a<o;a++)c.push(i(s.charCodeAt(a)));h.push(c.join(""))}var f=[l,h],d=["\0\x01","\0\x03"],u=["\0\0","\0\x01"],p=["\0\0","\x04\t"],g=l.length*d.length,v="\0\0"+i(g)+i(12*g+6),y=0;for(n=0,r=d.length;n<r;n++){var m=f[n];for(a=0,o=m.length;a<o;a++){s=m[a];var _=d[n]+u[n]+p[n]+i(a)+i(s.length)+i(y);v+=_,y+=s.length}}return v+=l.join("")+h.join(""),v}return t.getFontID=function(){var t=1;return function(){return String(t++)}}(),t.prototype={name:null,font:null,mimetype:null,encoding:null,get renderer(){var t=_font_renderer.FontRendererFactory.create(this,SEAC_ANALYSIS_ENABLED);return(0,_util.shadow)(this,"renderer",t)},exportData:function(){var t={};for(var e in this)this.hasOwnProperty(e)&&(t[e]=this[e]);return t},fallbackToSystemFont:function(){var t,e,n=this;this.missingFile=!0;var r=this.name,a=this.type,i=this.subtype,o=r.replace(/[,_]/g,"-"),s=(0,_standard_fonts.getStdFontMap)(),l=(0,_standard_fonts.getNonStdFontMap)(),h=!!s[o]||!(!l[o]||!s[l[o]]);if(o=s[o]||l[o]||o,this.bold=-1!==o.search(/bold/gi),this.italic=-1!==o.search(/oblique/gi)||-1!==o.search(/italic/gi),this.black=-1!==r.search(/Black/g),this.remeasure=Object.keys(this.widths).length>0,h&&"CIDFontType2"===a&&0===this.cidEncoding.indexOf("Identity-")){var c=(0,_standard_fonts.getGlyphMapForStandardFonts)(),f=[];for(t in c)f[+t]=c[t];if(/Arial-?Black/i.test(r)){var d=(0,_standard_fonts.getSupplementalGlyphMapForArialBlack)();for(t in d)f[+t]=d[t]}else if(/Calibri/i.test(r)){var p=(0,_standard_fonts.getSupplementalGlyphMapForCalibri)();for(t in p)f[+t]=p[t]}var g=this.toUnicode instanceof IdentityToUnicodeMap;g||this.toUnicode.forEach((function(t,e){f[+t]=e})),this.toFontChar=f,this.toUnicode=new ToUnicodeMap(f)}else if(/Symbol/i.test(o))this.toFontChar=u(_encodings.SymbolSetEncoding,(0,_glyphlist.getGlyphsUnicode)(),this.differences);else if(/Dingbats/i.test(o))/Wingdings/i.test(r)&&(0,_util.warn)("Non-embedded Wingdings font, falling back to ZapfDingbats."),this.toFontChar=u(_encodings.ZapfDingbatsEncoding,(0,_glyphlist.getDingbatsGlyphsUnicode)(),this.differences);else if(h)this.toFontChar=u(this.defaultEncoding,(0,_glyphlist.getGlyphsUnicode)(),this.differences);else{var v=(0,_glyphlist.getGlyphsUnicode)();this.toUnicode.forEach((function(t,r){if(!n.composite){var a=n.differences[t]||n.defaultEncoding[t];e=(0,_unicode.getUnicodeForGlyph)(a,v),-1!==e&&(r=e)}n.toFontChar[t]=r}))}this.loadedName=o.split("-")[0],this.fontType=getFontType(a,i)},checkAndRepair:function(t,i,o){var s=["OS/2","cmap","head","hhea","hmtx","maxp","name","post","loca","glyf","fpgm","prep","cvt ","CFF "];function h(t,e){var n=Object.create(null);n["OS/2"]=null,n["cmap"]=null,n["head"]=null,n["hhea"]=null,n["hmtx"]=null,n["maxp"]=null,n["name"]=null,n["post"]=null;for(var r=0;r<e;r++){var a=c(i);s.includes(a.tag)&&(0!==a.length&&(n[a.tag]=a))}return n}function c(t){var e=(0,_util.bytesToString)(t.getBytes(4)),n=t.getInt32()>>>0,r=t.getInt32()>>>0,a=t.getInt32()>>>0,i=t.pos;t.pos=t.start?t.start:0,t.skip(r);var o=t.getBytes(a);return t.pos=i,"head"===e&&(o[8]=o[9]=o[10]=o[11]=0,o[17]|=32),{tag:e,checksum:n,length:a,offset:r,data:o}}function f(t){return{version:(0,_util.bytesToString)(t.getBytes(4)),numTables:t.getUint16(),searchRange:t.getUint16(),entrySelector:t.getUint16(),rangeShift:t.getUint16()}}function d(t){var e=(0,_util.bytesToString)(t.getBytes(4));(0,_util.assert)("ttcf"===e,"Must be a TrueType Collection font.");for(var n=t.getUint16(),r=t.getUint16(),a=t.getInt32()>>>0,i=[],o=0;o<a;o++)i.push(t.getInt32()>>>0);var s={ttcTag:e,majorVersion:n,minorVersion:r,numFonts:a,offsetTable:i};switch(n){case 1:return s;case 2:return s.dsigTag=t.getInt32()>>>0,s.dsigLength=t.getInt32()>>>0,s.dsigOffset=t.getInt32()>>>0,s}throw new _util.FormatError("Invalid TrueType Collection majorVersion: "+n+".")}function u(t,e){for(var n=d(t),r=n.numFonts,a=n.offsetTable,i=0;i<r;i++){t.pos=(t.start||0)+a[i];var o=f(t),s=h(t,o.numTables);if(!s["name"])throw new _util.FormatError('TrueType Collection font must contain a "name" table.');for(var l=E(s["name"]),c=0,u=l.length;c<u;c++)for(var p=0,g=l[c].length;p<g;p++){var v=l[c][p];if(v&&v.replace(/\s/g,"")===e)return{header:o,tables:s}}}throw new _util.FormatError('TrueType Collection does not contain "'+e+'" font.')}function g(t,e,n,r){if(!t)return(0,_util.warn)("No cmap table available."),{platformId:-1,encodingId:-1,mappings:[],hasShortCmap:!1};var a,i=(e.start?e.start:0)+t.offset;e.pos=i,e.getUint16();for(var o,s=e.getUint16(),l=!1,h=0;h<s;h++){var c=e.getUint16(),f=e.getUint16(),d=e.getInt32()>>>0,u=!1;if((!o||o.platformId!==c||o.encodingId!==f)&&(0===c&&0===f||1===c&&0===f?u=!0:3!==c||1!==f||!r&&o?n&&3===c&&0===f&&(u=!0,l=!0):(u=!0,n||(l=!0)),u&&(o={platformId:c,encodingId:f,offset:d}),l))break}if(o&&(e.pos=i+o.offset),!o||-1===e.peekByte())return(0,_util.warn)("Could not find a preferred cmap table."),{platformId:-1,encodingId:-1,mappings:[],hasShortCmap:!1};var p=e.getUint16();e.getUint16(),e.getUint16();var g,v,y=!1,m=[];if(0===p){for(g=0;g<256;g++){var _=e.getByte();_&&m.push({charCode:g,glyphId:_})}y=!0}else if(4===p){var T=e.getUint16()>>1;e.getBytes(6);var F,C=[];for(F=0;F<T;F++)C.push({end:e.getUint16()});for(e.getUint16(),F=0;F<T;F++)C[F].start=e.getUint16();for(F=0;F<T;F++)C[F].delta=e.getUint16();var b=0;for(F=0;F<T;F++){a=C[F];var S=e.getUint16();if(S){var w=(S>>1)-(T-F);a.offsetIndex=w,b=Math.max(b,w+a.end-a.start+1)}else a.offsetIndex=-1}var E=[];for(g=0;g<b;g++)E.push(e.getUint16());for(F=0;F<T;F++){a=C[F],i=a.start;var I=a.end,U=a.delta;for(w=a.offsetIndex,g=i;g<=I;g++)65535!==g&&(v=w<0?g:E[w+g-i],v=v+U&65535,m.push({charCode:g,glyphId:v}))}}else{if(6!==p)return(0,_util.warn)("cmap table has unsupported format: "+p),{platformId:-1,encodingId:-1,mappings:[],hasShortCmap:!1};var x=e.getUint16(),A=e.getUint16();for(g=0;g<A;g++){v=e.getUint16();var M=x+g;m.push({charCode:M,glyphId:v})}}for(m.sort((function(t,e){return t.charCode-e.charCode})),h=1;h<m.length;h++)m[h-1].charCode===m[h].charCode&&(m.splice(h,1),h--);return{platformId:o.platformId,encodingId:o.encodingId,mappings:m,hasShortCmap:y}}function F(t,e,n,r){if(e){t.pos=(t.start?t.start:0)+e.offset,t.pos+=e.length-2;var a=t.getUint16();a>r&&((0,_util.info)("The numOfMetrics ("+a+") should not be greater than the numGlyphs ("+r+")"),a=r,e.data[34]=(65280&a)>>8,e.data[35]=255&a);var i=r-a,o=i-(n.length-4*a>>1);if(o>0){var s=new Uint8Array(n.length+2*o);s.set(n.data),n.data=s}}else n&&(n.data=null)}function C(t,e,a,i,o,s){var l={length:0,sizeOfInstructions:0};if(a-e<=12)return l;var h=t.subarray(e,a),c=r(h[0],h[1]);if(c<0)return c=-1,n(h,0,c),i.set(h,o),l.length=h.length,l;var f,d=10,u=0;for(f=0;f<c;f++){var p=h[d]<<8|h[d+1];u=p+1,d+=2}var g=d,v=h[d]<<8|h[d+1];l.sizeOfInstructions=v,d+=2+v;var y=d,m=0;for(f=0;f<u;f++){var _=h[d++];192&_&&(h[d-1]=63&_);var T=(2&_?1:16&_?0:2)+(4&_?1:32&_?0:2);if(m+=T,8&_){var F=h[d++];f+=F,m+=F*T}}if(0===m)return l;var C=d+m;return C>h.length?l:!s&&v>0?(i.set(h.subarray(0,g),o),i.set([0,0],o+g),i.set(h.subarray(y,C),o+g+2),C-=v,h.length-C>3&&(C=C+3&-4),l.length=C,l):h.length-C>3?(C=C+3&-4,i.set(h.subarray(0,C),o),l.length=C,l):(i.set(h,o),l.length=h.length,l)}function b(t,n,r){var i=t.data,o=a(i[0],i[1],i[2],i[3]);o>>16!==1&&((0,_util.info)("Attempting to fix invalid version in head table: "+o),i[0]=0,i[1]=1,i[2]=0,i[3]=0);var s=e(i[50],i[51]);if(s<0||s>1){(0,_util.info)("Attempting to fix invalid indexToLocFormat in head table: "+s);var l=n+1;if(r===l<<1)i[50]=0,i[51]=0;else{if(r!==l<<2)throw new _util.FormatError("Could not fix indexToLocFormat: "+s);i[50]=0,i[51]=1}}}function S(t,e,n,r,a,i,o){var s,l,h;r?(s=4,l=function(t,e){return t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]},h=function(t,e,n){t[e]=n>>>24&255,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n}):(s=2,l=function(t,e){return t[e]<<9|t[e+1]<<1},h=function(t,e,n){t[e]=n>>9&255,t[e+1]=n>>1&255});var c=i?n+1:n,f=t.data,d=s*(1+c);f=new Uint8Array(d),f.set(t.data.subarray(0,d)),t.data=f;var u,p,g=e.data,v=g.length,y=new Uint8Array(v),m=l(f,0),_=0,T=Object.create(null);for(h(f,0,_),u=0,p=s;u<n;u++,p+=s){var F=l(f,p);0===F&&(F=m),F>v&&(v+3&-4)===F&&(F=v),F>v&&(m=F);var b=C(g,m,F,y,_,a),S=b.length;0===S&&(T[u]=!0),b.sizeOfInstructions>o&&(o=b.sizeOfInstructions),_+=S,h(f,p,_),m=F}if(0===_){var w=new Uint8Array([0,1,0,0,0,0,0,0,0,0,0,0,0,0,49,0]);for(u=0,p=s;u<c;u++,p+=s)h(f,p,w.length);e.data=w}else if(i){var E=l(f,s);y.length>E+_?e.data=y.subarray(0,E+_):(e.data=new Uint8Array(E+_),e.data.set(y.subarray(0,_))),e.data.set(y.subarray(0,E),_),h(t.data,f.length-s,_+E)}else e.data=y.subarray(0,_);return{missingGlyphs:T,maxSizeOfInstructions:o}}function w(t,e,n){var r=(i.start?i.start:0)+t.offset;i.pos=r;var a,o=t.length,s=r+o,l=i.getInt32();i.getBytes(28);var h,c=!0;switch(l){case 65536:a=MacStandardGlyphOrdering;break;case 131072:var f=i.getUint16();if(f!==n){c=!1;break}var d=[];for(h=0;h<f;++h){var u=i.getUint16();if(u>=32768){c=!1;break}d.push(u)}if(!c)break;var p=[],g=[];while(i.pos<s){var v=i.getByte();for(g.length=v,h=0;h<v;++h)g[h]=String.fromCharCode(i.getByte());p.push(g.join(""))}for(a=[],h=0;h<f;++h){var y=d[h];y<258?a.push(MacStandardGlyphOrdering[y]):a.push(p[y-258])}break;case 196608:break;default:(0,_util.warn)("Unknown/unsupported post table version "+l),c=!1,e.defaultEncoding&&(a=e.defaultEncoding);break}return e.glyphNames=a,c}function E(t){var e=(i.start?i.start:0)+t.offset;i.pos=e;var n=[[],[]],r=t.length,a=e+r,o=i.getUint16(),s=6;if(0!==o||r<s)return n;var l,h,c=i.getUint16(),f=i.getUint16(),d=[],u=12;for(l=0;l<c&&i.pos+u<=a;l++){var p={platform:i.getUint16(),encoding:i.getUint16(),language:i.getUint16(),name:i.getUint16(),length:i.getUint16(),offset:i.getUint16()};(1===p.platform&&0===p.encoding&&0===p.language||3===p.platform&&1===p.encoding&&1033===p.language)&&d.push(p)}for(l=0,h=d.length;l<h;l++){var g=d[l];if(!(g.length<=0)){var v=e+f+g.offset;if(!(v+g.length>a)){i.pos=v;var y=g.name;if(g.encoding){for(var m="",_=0,T=g.length;_<T;_+=2)m+=String.fromCharCode(i.getUint16());n[1][y]=m}else n[0][y]=(0,_util.bytesToString)(i.getBytes(g.length))}}}return n}var I=[0,0,0,0,0,0,0,0,-2,-2,-2,-2,0,0,-2,-5,-1,-1,-1,-1,-1,-1,-1,-1,0,0,-1,0,-1,-1,-1,-1,1,-1,-999,0,1,0,-1,-2,0,-1,-2,-1,-1,0,-1,-1,0,0,-999,-999,-1,-1,-1,-1,-2,-999,-2,-2,-999,0,-2,-2,0,0,-2,0,-2,0,0,0,-2,-1,-1,1,1,0,0,-1,-1,-1,-1,-1,-1,-1,0,0,-1,0,-1,-1,0,-999,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,0,0,0,0,0,-2,-999,-999,-999,-999,-999,-1,-1,-2,-2,0,0,0,0,-1,-1,-999,-2,-2,0,0,-1,-2,-2,0,0,0,-1,-1,-1,-2];function U(t,e){for(var n,r,a,i,o,s=t.data,l=0,h=0,c=0,f=[],d=[],u=[],p=e.tooComplexToFollowFunctions,g=!1,v=0,y=0,m=s.length;l<m;){var _=s[l++];if(64===_)if(r=s[l++],g||y)l+=r;else for(n=0;n<r;n++)f.push(s[l++]);else if(65===_)if(r=s[l++],g||y)l+=2*r;else for(n=0;n<r;n++)a=s[l++],f.push(a<<8|s[l++]);else if(176===(248&_))if(r=_-176+1,g||y)l+=r;else for(n=0;n<r;n++)f.push(s[l++]);else if(184===(248&_))if(r=_-184+1,g||y)l+=2*r;else for(n=0;n<r;n++)a=s[l++],f.push(a<<8|s[l++]);else if(43!==_||p)if(44!==_||p){if(45===_)if(g)g=!1,h=l;else{if(o=d.pop(),!o)return(0,_util.warn)("TT: ENDF bad stack"),void(e.hintsValid=!1);i=u.pop(),s=o.data,l=o.i,e.functionsStackDeltas[i]=f.length-o.stackTop}else if(137===_)(g||y)&&((0,_util.warn)("TT: nested IDEFs not allowed"),p=!0),g=!0,c=l;else if(88===_)++v;else if(27===_)y=v;else if(89===_)y===v&&(y=0),--v;else if(28===_&&!g&&!y){var T=f[f.length-1];T>0&&(l+=T-1)}}else(g||y)&&((0,_util.warn)("TT: nested FDEFs not allowed"),p=!0),g=!0,c=l,i=f.pop(),e.functionsDefined[i]={data:s,i:l};else if(!g&&!y)if(i=f[f.length-1],isNaN(i))(0,_util.info)("TT: CALL empty stack (or invalid entry).");else if(e.functionsUsed[i]=!0,i in e.functionsStackDeltas){var F=f.length+e.functionsStackDeltas[i];if(F<0)return(0,_util.warn)("TT: CALL invalid functions stack delta."),void(e.hintsValid=!1);f.length=F}else if(i in e.functionsDefined&&!u.includes(i)){if(d.push({data:s,i:l,stackTop:f.length-1}),u.push(i),o=e.functionsDefined[i],!o)return(0,_util.warn)("TT: CALL non-existent function"),void(e.hintsValid=!1);s=o.data,l=o.i}if(!g&&!y){var C=_<=142?I[_]:_>=192&&_<=223?-1:_>=224?-2:0;_>=113&&_<=117&&(r=f.pop(),isNaN(r)||(C=2*-r));while(C<0&&f.length>0)f.pop(),C++;while(C>0)f.push(NaN),C--}}e.tooComplexToFollowFunctions=p;var b=[s];l>s.length&&b.push(new Uint8Array(l-s.length)),c>h&&((0,_util.warn)("TT: complementing a missing function tail"),b.push(new Uint8Array([34,45]))),A(t,b)}function x(t,e){if(!t.tooComplexToFollowFunctions){if(t.functionsDefined.length>e)return(0,_util.warn)("TT: more functions defined than expected"),void(t.hintsValid=!1);for(var n=0,r=t.functionsUsed.length;n<r;n++){if(n>e)return(0,_util.warn)("TT: invalid function id: "+n),void(t.hintsValid=!1);if(t.functionsUsed[n]&&!t.functionsDefined[n])return(0,_util.warn)("TT: undefined function: "+n),void(t.hintsValid=!1)}}}function A(t,e){if(e.length>1){var n,r,a=0;for(n=0,r=e.length;n<r;n++)a+=e[n].length;a=a+3&-4;var i=new Uint8Array(a),o=0;for(n=0,r=e.length;n<r;n++)i.set(e[n],o),o+=e[n].length;t.data=i,t.length=a}}function M(t,e,n,r){var a={functionsDefined:[],functionsUsed:[],functionsStackDeltas:[],tooComplexToFollowFunctions:!1,hintsValid:!0};if(t&&U(t,a),e&&U(e,a),t&&x(a,r),n&&1&n.length){var i=new Uint8Array(n.length+1);i.set(n.data),n.data=i}return a.hintsValid}i=new _stream.Stream(new Uint8Array(i.getBytes()));var N=void 0,O=void 0;if(l(i)){var k=u(i,this.name);N=k.header,O=k.tables}else N=f(i),O=h(i,N.numTables);var B=void 0,D=void 0,G=!O["CFF "];if(G){if(!O["loca"])throw new _util.FormatError('Required "loca" table is not found');O["glyf"]||((0,_util.warn)('Required "glyf" table is not found -- trying to recover.'),O["glyf"]={tag:"glyf",data:new Uint8Array(0)}),this.isOpenType=!1}else{var P=o.composite&&((o.cidToGidMap||[]).length>0||!(o.cMap instanceof _cmap.IdentityCMap));if("OTTO"===N.version&&!P||!O["head"]||!O["hhea"]||!O["maxp"]||!O["post"])return D=new _stream.Stream(O["CFF "].data),B=new CFFFont(D,o),adjustWidths(o),this.convert(t,B,o);delete O["glyf"],delete O["loca"],delete O["fpgm"],delete O["prep"],delete O["cvt "],this.isOpenType=!0}if(!O["maxp"])throw new _util.FormatError('Required "maxp" table is not found');i.pos=(i.start||0)+O["maxp"].offset;var L=i.getInt32(),q=i.getUint16(),R=q+1,Y=!0;R>65535&&(Y=!1,R=q,(0,_util.warn)("Not enough space in glyfs to duplicate first glyph."));var j=0,V=0;if(L>=65536&&O["maxp"].length>=22){i.pos+=8;var W=i.getUint16();W>2&&(O["maxp"].data[14]=0,O["maxp"].data[15]=2),i.pos+=4,j=i.getUint16(),i.pos+=4,V=i.getUint16()}O["maxp"].data[4]=R>>8,O["maxp"].data[5]=255&R;var z=M(O["fpgm"],O["prep"],O["cvt "],j);if(z||(delete O["fpgm"],delete O["prep"],delete O["cvt "]),F(i,O["hhea"],O["hmtx"],R),!O["head"])throw new _util.FormatError('Required "head" table is not found');b(O["head"],q,G?O["loca"].length:0);var H=Object.create(null);if(G){var X=e(O["head"].data[50],O["head"].data[51]),Z=S(O["loca"],O["glyf"],q,X,z,Y,V);H=Z.missingGlyphs,L>=65536&&O["maxp"].length>=22&&(O["maxp"].data[26]=Z.maxSizeOfInstructions>>8,O["maxp"].data[27]=255&Z.maxSizeOfInstructions)}if(!O["hhea"])throw new _util.FormatError('Required "hhea" table is not found');0===O["hhea"].data[10]&&0===O["hhea"].data[11]&&(O["hhea"].data[10]=255,O["hhea"].data[11]=255);var K={unitsPerEm:e(O["head"].data[18],O["head"].data[19]),yMax:e(O["head"].data[42],O["head"].data[43]),yMin:r(O["head"].data[38],O["head"].data[39]),ascent:e(O["hhea"].data[4],O["hhea"].data[5]),descent:r(O["hhea"].data[6],O["hhea"].data[7])};this.ascent=K.ascent/K.unitsPerEm,this.descent=K.descent/K.unitsPerEm,O["post"]&&w(O["post"],o,q),O["post"]={tag:"post",data:_(o)};var J,Q=[];function $(t){return!H[t]}if(o.composite){var tt=o.cidToGidMap||[],et=0===tt.length;o.cMap.forEach((function(t,e){if(e>65535)throw new _util.FormatError("Max size of CID is 65,535");var n=-1;et?n=e:void 0!==tt[e]&&(n=tt[e]),n>=0&&n<q&&$(n)&&(Q[t]=n)}))}else{var nt=g(O["cmap"],i,this.isSymbolicFont,o.hasEncoding),rt=nt.platformId,at=nt.encodingId,it=nt.mappings,ot=it.length;if(o.hasEncoding&&(3===rt&&1===at||1===rt&&0===at)||-1===rt&&-1===at&&(0,_encodings.getEncoding)(o.baseEncodingName)){var st=[];"MacRomanEncoding"!==o.baseEncodingName&&"WinAnsiEncoding"!==o.baseEncodingName||(st=(0,_encodings.getEncoding)(o.baseEncodingName));var lt=(0,_glyphlist.getGlyphsUnicode)();for(J=0;J<256;J++){var ht,ct;if(ht=this.differences&&J in this.differences?this.differences[J]:J in st&&""!==st[J]?st[J]:_encodings.StandardEncoding[J],ht){var ft;ct=recoverGlyphName(ht,lt),3===rt&&1===at?ft=lt[ct]:1===rt&&0===at&&(ft=_encodings.MacRomanEncoding.indexOf(ct));for(var dt=!1,ut=0;ut<ot;++ut)if(it[ut].charCode===ft){Q[J]=it[ut].glyphId,dt=!0;break}if(!dt&&o.glyphNames){var pt=o.glyphNames.indexOf(ht);-1===pt&&ct!==ht&&(pt=o.glyphNames.indexOf(ct)),pt>0&&$(pt)&&(Q[J]=pt)}}}}else if(0===rt&&0===at)for(var gt=0;gt<ot;++gt)Q[it[gt].charCode]=it[gt].glyphId;else for(var vt=0;vt<ot;++vt)J=it[vt].charCode,3===rt&&J>=61440&&J<=61695&&(J&=255),Q[J]=it[vt].glyphId}0===Q.length&&(Q[0]=0);var yt=R-1;Y||(yt=0);var mt=p(Q,$,yt);if(this.toFontChar=mt.toFontChar,O["cmap"]={tag:"cmap",data:v(mt.charCodeToGlyphId,R)},O["OS/2"]&&y(O["OS/2"])||(O["OS/2"]={tag:"OS/2",data:m(o,mt.charCodeToGlyphId,K)}),!G)try{D=new _stream.Stream(O["CFF "].data);var _t=new _cff_parser.CFFParser(D,o,SEAC_ANALYSIS_ENABLED);B=_t.parse(),B.duplicateFirstGlyph();var Tt=new _cff_parser.CFFCompiler(B);O["CFF "].data=Tt.compile()}catch(St){(0,_util.warn)("Failed to compile font "+o.loadedName)}if(O["name"]){var Ft=E(O["name"]);O["name"].data=T(t,Ft)}else O["name"]={tag:"name",data:T(this.name)};var Ct=new OpenTypeFileBuilder(N.version);for(var bt in O)Ct.addTable(bt,O[bt].data);return Ct.toArray()},convert:function(t,e,n){n.fixedPitch=!1,n.builtInEncoding&&adjustToUnicode(n,n.builtInEncoding);var r=1;e instanceof CFFFont&&(r=e.numGlyphs-1);var a=e.getGlyphMapping(n),s=p(a,e.hasGlyphId.bind(e),r);this.toFontChar=s.toFontChar;var l=e.numGlyphs;function h(t,e){var n=null;for(var r in t)e===t[r]&&(n||(n=[]),n.push(0|r));return n}function c(t,e){for(var n in t)if(e===t[n])return 0|n;return s.charCodeToGlyphId[s.nextAvailableFontCharCode]=e,s.nextAvailableFontCharCode++}var f=e.seacs;if(SEAC_ANALYSIS_ENABLED&&f&&f.length){var d=n.fontMatrix||_util.FONT_IDENTITY_MATRIX,u=e.getCharset(),g=Object.create(null);for(var y in f){y|=0;var F=f[y],C=_encodings.StandardEncoding[F[2]],b=_encodings.StandardEncoding[F[3]],S=u.indexOf(C),w=u.indexOf(b);if(!(S<0||w<0)){var E={x:F[0]*d[0]+F[1]*d[2]+d[4],y:F[0]*d[1]+F[1]*d[3]+d[5]},I=h(a,y);if(I)for(var U=0,x=I.length;U<x;U++){var A=I[U],M=s.charCodeToGlyphId,N=c(M,S),O=c(M,w);g[A]={baseFontCharCode:N,accentFontCharCode:O,accentOffset:E}}}}n.seacMap=g}var k=1/(n.fontMatrix||_util.FONT_IDENTITY_MATRIX)[0],B=new OpenTypeFileBuilder("OTTO");return B.addTable("CFF ",e.data),B.addTable("OS/2",m(n,s.charCodeToGlyphId)),B.addTable("cmap",v(s.charCodeToGlyphId,l)),B.addTable("head","\0\x01\0\0\0\0\x10\0\0\0\0\0_\x0f<\xf5\0\0"+o(k)+"\0\0\0\0\x9e\v~'\0\0\0\0\x9e\v~'\0\0"+o(n.descent)+"\x0f\xff"+o(n.ascent)+i(n.italicAngle?2:0)+"\0\x11\0\0\0\0\0\0"),B.addTable("hhea","\0\x01\0\0"+o(n.ascent)+o(n.descent)+"\0\0\xff\xff\0\0\0\0\0\0"+o(n.capHeight)+o(Math.tan(n.italicAngle)*n.xHeight)+"\0\0\0\0\0\0\0\0\0\0\0\0"+i(l)),B.addTable("hmtx",function(){for(var t=e.charstrings,n=e.cff?e.cff.widths:null,r="\0\0\0\0",a=1,o=l;a<o;a++){var s=0;if(t){var h=t[a-1];s="width"in h?h.width:0}else n&&(s=Math.ceil(n[a]||0));r+=i(s)+i(0)}return r}()),B.addTable("maxp","\0\0P\0"+i(l)),B.addTable("name",T(t)),B.addTable("post",_(n)),B.toArray()},get spaceWidth(){if("_shadowWidth"in this)return this._shadowWidth;for(var t,e=["space","minus","one","i","I"],n=0,r=e.length;n<r;n++){var a=e[n];if(a in this.widths){t=this.widths[a];break}var i=(0,_glyphlist.getGlyphsUnicode)(),o=i[a],s=0;if(this.composite&&this.cMap.contains(o)&&(s=this.cMap.lookup(o)),!s&&this.toUnicode&&(s=this.toUnicode.charCodeOf(o)),s<=0&&(s=o),t=this.widths[s],t)break}return t=t||this.defaultWidth,this._shadowWidth=t,t},charToGlyph:function(t,e){var n,r,a,i=t;this.cMap&&this.cMap.contains(t)&&(i=this.cMap.lookup(t)),r=this.widths[i],r=(0,_util.isNum)(r)?r:this.defaultWidth;var o=this.vmetrics&&this.vmetrics[i],s=this.toUnicode.get(t)||this.fallbackToUnicode.get(t)||t;"number"===typeof s&&(s=String.fromCharCode(s));var l=t in this.toFontChar;n=this.toFontChar[t]||t,this.missingFile&&(n=(0,_unicode.mapSpecialUnicodeValues)(n)),this.isType3Font&&(a=n);var h=null;if(this.seacMap&&this.seacMap[t]){l=!0;var c=this.seacMap[t];n=c.baseFontCharCode,h={fontChar:String.fromCodePoint(c.accentFontCharCode),offset:c.accentOffset}}var f="number"===typeof n?String.fromCodePoint(n):"",d=this.glyphCache[t];return d&&d.matchesForCache(f,s,h,r,o,a,e,l)||(d=new Glyph(f,s,h,r,o,a,e,l),this.glyphCache[t]=d),d},charsToGlyphs:function(t){var e,n,r,a=this.charsCache;if(a&&(e=a[t],e))return e;a||(a=this.charsCache=Object.create(null)),e=[];var i,o=t,s=0;if(this.cMap){var l=Object.create(null);while(s<t.length){this.cMap.readCharCode(t,s,l),r=l.charcode;var h=l.length;s+=h;var c=1===h&&32===t.charCodeAt(s-1);n=this.charToGlyph(r,c),e.push(n)}}else for(s=0,i=t.length;s<i;++s)r=t.charCodeAt(s),n=this.charToGlyph(r,32===r),e.push(n);return a[o]=e}},t}(),ErrorFont=function(){function t(t){this.error=t,this.loadedName="g_font_error",this.missingFile=!0}return t.prototype={charsToGlyphs:function(){return[]},exportData:function(){return{error:this.error}}},t}();function type1FontGlyphMapping(t,e,n){var r,a,i,o=Object.create(null),s=!!(t.flags&FontFlags.Symbolic);if(t.baseEncodingName)for(i=(0,_encodings.getEncoding)(t.baseEncodingName),a=0;a<i.length;a++)r=n.indexOf(i[a]),o[a]=r>=0?r:0;else if(s)for(a in e)o[a]=e[a];else for(i=_encodings.StandardEncoding,a=0;a<i.length;a++)r=n.indexOf(i[a]),o[a]=r>=0?r:0;var l,h=t.differences;if(h)for(a in h){var c=h[a];if(r=n.indexOf(c),-1===r){l||(l=(0,_glyphlist.getGlyphsUnicode)());var f=recoverGlyphName(c,l);f!==c&&(r=n.indexOf(f))}o[a]=r>=0?r:0}return o}var Type1Font=function(){function t(t,e,n){var r,a=t.length,i=e.length,o=a-i,s=n,l=!1;while(s<o){r=0;while(r<i&&t[s+r]===e[r])r++;if(r>=i){s+=r;while(s<a&&(0,_util.isSpace)(t[s]))s++;l=!0;break}s++}return{found:l,length:s}}function e(e,n){var r,a,i,o=[101,101,120,101,99],s=e.pos;try{r=e.getBytes(n),a=r.length}catch(f){if(f instanceof _util.MissingDataException)throw f}if(a===n&&(i=t(r,o,n-2*o.length),i.found&&i.length===n))return{stream:new _stream.Stream(r),length:n};(0,_util.warn)('Invalid "Length1" property in Type1 font -- trying to recover.'),e.pos=s;var l,h=2048;while(1){var c=e.peekBytes(h);if(i=t(c,o,0),0===i.length)break;if(e.pos+=i.length,i.found){l=e.pos-s;break}}return e.pos=s,l?{stream:new _stream.Stream(e.getBytes(l)),length:l}:((0,_util.warn)('Unable to recover "Length1" property in Type1 font -- using as is.'),{stream:new _stream.Stream(e.getBytes(n)),length:n})}function n(t,e){var n=t.getBytes();return{stream:new _stream.Stream(n),length:n.length}}function r(t,r,a){var i=6,o=a.length1,s=a.length2,l=r.peekBytes(i),h=128===l[0]&&1===l[1];h&&(r.skip(i),o=l[5]<<24|l[4]<<16|l[3]<<8|l[2]);var c=e(r,o),f=new _type1_parser.Type1Parser(c.stream,!1,SEAC_ANALYSIS_ENABLED);f.extractFontHeader(a),h&&(l=r.getBytes(i),s=l[5]<<24|l[4]<<16|l[3]<<8|l[2]);var d=n(r,s),u=new _type1_parser.Type1Parser(d.stream,!0,SEAC_ANALYSIS_ENABLED),p=u.extractFontProgram();for(var g in p.properties)a[g]=p.properties[g];var v=p.charstrings,y=this.getType2Charstrings(v),m=this.getType2Subrs(p.subrs);this.charstrings=v,this.data=this.wrap(t,y,this.charstrings,m,a),this.seacs=this.getSeacs(p.charstrings)}return r.prototype={get numGlyphs(){return this.charstrings.length+1},getCharset:function(){for(var t=[".notdef"],e=this.charstrings,n=0;n<e.length;n++)t.push(e[n].glyphName);return t},getGlyphMapping:function(t){var e,n=this.charstrings,r=[".notdef"];for(e=0;e<n.length;e++)r.push(n[e].glyphName);var a=t.builtInEncoding;if(a){var i=Object.create(null);for(var o in a)e=r.indexOf(a[o]),e>=0&&(i[o]=e)}return type1FontGlyphMapping(t,i,r)},hasGlyphId:function(t){if(t<0||t>=this.numGlyphs)return!1;if(0===t)return!0;var e=this.charstrings[t-1];return e.charstring.length>0},getSeacs:function(t){var e,n,r=[];for(e=0,n=t.length;e<n;e++){var a=t[e];a.seac&&(r[e+1]=a.seac)}return r},getType2Charstrings:function(t){for(var e=[],n=0,r=t.length;n<r;n++)e.push(t[n].charstring);return e},getType2Subrs:function(t){var e=0,n=t.length;e=n<1133?107:n<33769?1131:32768;var r,a=[];for(r=0;r<e;r++)a.push([11]);for(r=0;r<n;r++)a.push(t[r]);return a},wrap:function(t,e,n,r,a){var i=new _cff_parser.CFF;i.header=new _cff_parser.CFFHeader(1,0,4,4),i.names=[t];var o=new _cff_parser.CFFTopDict;o.setByName("version",391),o.setByName("Notice",392),o.setByName("FullName",393),o.setByName("FamilyName",394),o.setByName("Weight",395),o.setByName("Encoding",null),o.setByName("FontMatrix",a.fontMatrix),o.setByName("FontBBox",a.bbox),o.setByName("charset",null),o.setByName("CharStrings",null),o.setByName("Private",null),i.topDict=o;var s=new _cff_parser.CFFStrings;s.add("Version 0.11"),s.add("See original notice"),s.add(t),s.add(t),s.add("Medium"),i.strings=s,i.globalSubrIndex=new _cff_parser.CFFIndex;var l,h,c=e.length,f=[0];for(l=0;l<c;l++){var d=_cff_parser.CFFStandardStrings.indexOf(n[l].glyphName);-1===d&&(d=0),f.push(d>>8&255,255&d)}i.charset=new _cff_parser.CFFCharset(!1,0,[],f);var u=new _cff_parser.CFFIndex;for(u.add([139,14]),l=0;l<c;l++)u.add(e[l]);i.charStrings=u;var p=new _cff_parser.CFFPrivateDict;p.setByName("Subrs",null);var g=["BlueValues","OtherBlues","FamilyBlues","FamilyOtherBlues","StemSnapH","StemSnapV","BlueShift","BlueFuzz","BlueScale","LanguageGroup","ExpansionFactor","ForceBold","StdHW","StdVW"];for(l=0,h=g.length;l<h;l++){var v=g[l];if(v in a.privateData){var y=a.privateData[v];if(Array.isArray(y))for(var m=y.length-1;m>0;m--)y[m]-=y[m-1];p.setByName(v,y)}}i.topDict.privateDict=p;var _=new _cff_parser.CFFIndex;for(l=0,h=r.length;l<h;l++)_.add(r[l]);p.subrsIndex=_;var T=new _cff_parser.CFFCompiler(i);return T.compile()}},r}(),CFFFont=function(){function t(t,e){this.properties=e;var n=new _cff_parser.CFFParser(t,e,SEAC_ANALYSIS_ENABLED);this.cff=n.parse(),this.cff.duplicateFirstGlyph();var r=new _cff_parser.CFFCompiler(this.cff);this.seacs=this.cff.seacs;try{this.data=r.compile()}catch(a){(0,_util.warn)("Failed to compile font "+e.loadedName),this.data=t}}return t.prototype={get numGlyphs(){return this.cff.charStrings.count},getCharset:function(){return this.cff.charset.charset},getGlyphMapping:function(){var t,e,n=this.cff,r=this.properties,a=n.charset.charset;if(r.composite){if(t=Object.create(null),n.isCIDFont)for(e=0;e<a.length;e++){var i=a[e],o=r.cMap.charCodeOf(i);t[o]=e}else for(e=0;e<n.charStrings.count;e++)t[e]=e;return t}var s=n.encoding?n.encoding.encoding:null;return t=type1FontGlyphMapping(r,s,a),t},hasGlyphId:function(t){return this.cff.hasGlyphId(t)}},t}();exports.SEAC_ANALYSIS_ENABLED=SEAC_ANALYSIS_ENABLED,exports.ErrorFont=ErrorFont,exports.Font=Font,exports.FontFlags=FontFlags,exports.ToUnicodeMap=ToUnicodeMap,exports.IdentityToUnicodeMap=IdentityToUnicodeMap,exports.getFontType=getFontType;