"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.ColorSpace=void 0;var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),_util=require("../shared/util"),_primitives=require("./primitives");function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function _inherits(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function resizeRgbImage(e,t,r,a,n,o,i){var u=3;i=1!==i?0:i;for(var s=r/n,l=a/o,c=0,f=void 0,h=new Uint16Array(n),v=r*u,g=0;g<n;g++)h[g]=Math.floor(g*s)*u;for(var C=0;C<o;C++)for(var p=Math.floor(C*l)*v,m=0;m<n;m++)f=p+h[m],t[c++]=e[f++],t[c++]=e[f++],t[c++]=e[f++],c+=i}var ColorSpace=function(){function e(t,r){_classCallCheck(this,e),this.constructor===e&&(0,_util.unreachable)("Cannot initialize ColorSpace."),this.name=t,this.numComps=r}return _createClass(e,[{key:"getRgb",value:function(e,t){var r=new Uint8ClampedArray(3);return this.getRgbItem(e,t,r,0),r}},{key:"getRgbItem",value:function(e,t,r,a){(0,_util.unreachable)("Should not call ColorSpace.getRgbItem")}},{key:"getRgbBuffer",value:function(e,t,r,a,n,o,i){(0,_util.unreachable)("Should not call ColorSpace.getRgbBuffer")}},{key:"getOutputLength",value:function(e,t){(0,_util.unreachable)("Should not call ColorSpace.getOutputLength")}},{key:"isPassthrough",value:function(e){return!1}},{key:"fillRgb",value:function(e,t,r,a,n,o,i,u,s){var l=t*r,c=null,f=1<<i,h=r!==n||t!==a;if(this.isPassthrough(i))c=u;else if(1===this.numComps&&l>f&&"DeviceGray"!==this.name&&"DeviceRGB"!==this.name){for(var v=i<=8?new Uint8Array(f):new Uint16Array(f),g=0;g<f;g++)v[g]=g;var C=new Uint8ClampedArray(3*f);if(this.getRgbBuffer(v,0,f,C,0,i,0),h){c=new Uint8Array(3*l);for(var p=0,m=0;m<l;++m){var y=3*u[m];c[p++]=C[y],c[p++]=C[y+1],c[p++]=C[y+2]}}else for(var b=0,_=0;_<l;++_){var d=3*u[_];e[b++]=C[d],e[b++]=C[d+1],e[b++]=C[d+2],b+=s}}else h?(c=new Uint8ClampedArray(3*l),this.getRgbBuffer(u,0,l,c,0,i,0)):this.getRgbBuffer(u,0,a*o,e,0,i,s);if(c)if(h)resizeRgbImage(c,e,t,r,a,n,s);else for(var R=0,k=0,w=0,B=a*o;w<B;w++)e[R++]=c[k++],e[R++]=c[k++],e[R++]=c[k++],R+=s}},{key:"usesZeroToOneRange",get:function(){return(0,_util.shadow)(this,"usesZeroToOneRange",!0)}}],[{key:"parse",value:function(e,t,r,a){var n=this.parseToIR(e,t,r,a);return this.fromIR(n)}},{key:"fromIR",value:function(e){var t=Array.isArray(e)?e[0]:e,r=void 0,a=void 0,n=void 0;switch(t){case"DeviceGrayCS":return this.singletons.gray;case"DeviceRgbCS":return this.singletons.rgb;case"DeviceCmykCS":return this.singletons.cmyk;case"CalGrayCS":return r=e[1],a=e[2],n=e[3],new CalGrayCS(r,a,n);case"CalRGBCS":r=e[1],a=e[2],n=e[3];var o=e[4];return new CalRGBCS(r,a,n,o);case"PatternCS":var i=e[1];return i&&(i=this.fromIR(i)),new PatternCS(i);case"IndexedCS":var u=e[1],s=e[2],l=e[3];return new IndexedCS(this.fromIR(u),s,l);case"AlternateCS":var c=e[1],f=e[2],h=e[3];return new AlternateCS(c,this.fromIR(f),h);case"LabCS":r=e[1],a=e[2];var v=e[3];return new LabCS(r,a,v);default:throw new _util.FormatError("Unknown colorspace name: "+t)}}},{key:"parseToIR",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments[3];if(e=t.fetchIfRef(e),(0,_primitives.isName)(e))switch(e.name){case"DeviceGray":case"G":return"DeviceGrayCS";case"DeviceRGB":case"RGB":return"DeviceRgbCS";case"DeviceCMYK":case"CMYK":return"DeviceCmykCS";case"Pattern":return["PatternCS",null];default:if((0,_primitives.isDict)(r)){var n=r.get("ColorSpace");if((0,_primitives.isDict)(n)){var o=n.get(e.name);if(o){if((0,_primitives.isName)(o))return this.parseToIR(o,t,r,a);e=o;break}}}throw new _util.FormatError("unrecognized colorspace "+e.name)}if(Array.isArray(e)){var i=t.fetchIfRef(e[0]).name,u=void 0,s=void 0,l=void 0,c=void 0,f=void 0,h=void 0;switch(i){case"DeviceGray":case"G":return"DeviceGrayCS";case"DeviceRGB":case"RGB":return"DeviceRgbCS";case"DeviceCMYK":case"CMYK":return"DeviceCmykCS";case"CalGray":return s=t.fetchIfRef(e[1]),c=s.getArray("WhitePoint"),f=s.getArray("BlackPoint"),h=s.get("Gamma"),["CalGrayCS",c,f,h];case"CalRGB":s=t.fetchIfRef(e[1]),c=s.getArray("WhitePoint"),f=s.getArray("BlackPoint"),h=s.getArray("Gamma");var v=s.getArray("Matrix");return["CalRGBCS",c,f,h,v];case"ICCBased":var g=t.fetchIfRef(e[1]),C=g.dict;if(u=C.get("N"),l=C.get("Alternate"),l){var p=this.parseToIR(l,t,r,a),m=this.fromIR(p,a);if(m.numComps===u)return p;(0,_util.warn)("ICCBased color space: Ignoring incorrect /Alternate entry.")}if(1===u)return"DeviceGrayCS";if(3===u)return"DeviceRgbCS";if(4===u)return"DeviceCmykCS";break;case"Pattern":var y=e[1]||null;return y&&(y=this.parseToIR(y,t,r,a)),["PatternCS",y];case"Indexed":case"I":var b=this.parseToIR(e[1],t,r,a),_=t.fetchIfRef(e[2])+1,d=t.fetchIfRef(e[3]);return(0,_primitives.isStream)(d)&&(d=d.getBytes()),["IndexedCS",b,_,d];case"Separation":case"DeviceN":var R=t.fetchIfRef(e[1]);u=Array.isArray(R)?R.length:1,l=this.parseToIR(e[2],t,r,a);var k=a.create(t.fetchIfRef(e[3]));return["AlternateCS",u,l,k];case"Lab":s=t.fetchIfRef(e[1]),c=s.getArray("WhitePoint"),f=s.getArray("BlackPoint");var w=s.getArray("Range");return["LabCS",c,f,w];default:throw new _util.FormatError('unimplemented color space object "'+i+'"')}}throw new _util.FormatError('unrecognized color space object: "'+e+'"')}},{key:"isDefaultDecode",value:function(e,t){if(!Array.isArray(e))return!0;if(2*t!==e.length)return(0,_util.warn)("The decode map is not the correct length"),!0;for(var r=0,a=e.length;r<a;r+=2)if(0!==e[r]||1!==e[r+1])return!1;return!0}},{key:"singletons",get:function(){return(0,_util.shadow)(this,"singletons",{get gray(){return(0,_util.shadow)(this,"gray",new DeviceGrayCS)},get rgb(){return(0,_util.shadow)(this,"rgb",new DeviceRgbCS)},get cmyk(){return(0,_util.shadow)(this,"cmyk",new DeviceCmykCS)}})}}]),e}(),AlternateCS=function(e){function t(e,r,a){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Alternate",e));return n.base=r,n.tintFn=a,n.tmpBuf=new Float32Array(r.numComps),n}return _inherits(t,e),_createClass(t,[{key:"getRgbItem",value:function(e,t,r,a){var n=this.tmpBuf;this.tintFn(e,t,n,0),this.base.getRgbItem(n,0,r,a)}},{key:"getRgbBuffer",value:function(e,t,r,a,n,o,i){var u=this.tintFn,s=this.base,l=1/((1<<o)-1),c=s.numComps,f=s.usesZeroToOneRange,h=(s.isPassthrough(8)||!f)&&0===i,v=h?n:0,g=h?a:new Uint8ClampedArray(c*r),C=this.numComps,p=new Float32Array(C),m=new Float32Array(c),y=void 0,b=void 0;for(y=0;y<r;y++){for(b=0;b<C;b++)p[b]=e[t++]*l;if(u(p,0,m,0),f)for(b=0;b<c;b++)g[v++]=255*m[b];else s.getRgbItem(m,0,g,v),v+=c}h||s.getRgbBuffer(g,0,r,a,n,8,i)}},{key:"getOutputLength",value:function(e,t){return this.base.getOutputLength(e*this.base.numComps/this.numComps,t)}},{key:"isDefaultDecode",value:function(e){return ColorSpace.isDefaultDecode(e,this.numComps)}}]),t}(ColorSpace),PatternCS=function(e){function t(e){_classCallCheck(this,t);var r=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Pattern",null));return r.base=e,r}return _inherits(t,e),t}(ColorSpace),IndexedCS=function(e){function t(e,r,a){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Indexed",1));n.base=e,n.highVal=r;var o=e.numComps,i=o*r;if((0,_primitives.isStream)(a)){n.lookup=new Uint8Array(i);var u=a.getBytes(i);n.lookup.set(u)}else if((0,_util.isString)(a)){n.lookup=new Uint8Array(i);for(var s=0;s<i;++s)n.lookup[s]=a.charCodeAt(s)}else{if(!(a instanceof Uint8Array))throw new _util.FormatError("Unrecognized lookup table: "+a);n.lookup=a}return n}return _inherits(t,e),_createClass(t,[{key:"getRgbItem",value:function(e,t,r,a){var n=this.base.numComps,o=e[t]*n;this.base.getRgbBuffer(this.lookup,o,1,r,a,8,0)}},{key:"getRgbBuffer",value:function(e,t,r,a,n,o,i){for(var u=this.base,s=u.numComps,l=u.getOutputLength(s,i),c=this.lookup,f=0;f<r;++f){var h=e[t++]*s;u.getRgbBuffer(c,h,1,a,n,8,i),n+=l}}},{key:"getOutputLength",value:function(e,t){return this.base.getOutputLength(e*this.base.numComps,t)}},{key:"isDefaultDecode",value:function(e){return!0}}]),t}(ColorSpace),DeviceGrayCS=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"DeviceGray",1))}return _inherits(t,e),_createClass(t,[{key:"getRgbItem",value:function(e,t,r,a){var n=255*e[t];r[a]=r[a+1]=r[a+2]=n}},{key:"getRgbBuffer",value:function(e,t,r,a,n,o,i){for(var u=255/((1<<o)-1),s=t,l=n,c=0;c<r;++c){var f=u*e[s++];a[l++]=f,a[l++]=f,a[l++]=f,l+=i}}},{key:"getOutputLength",value:function(e,t){return e*(3+t)}},{key:"isDefaultDecode",value:function(e){return ColorSpace.isDefaultDecode(e,this.numComps)}}]),t}(ColorSpace),DeviceRgbCS=function(e){function t(){return _classCallCheck(this,t),_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"DeviceRGB",3))}return _inherits(t,e),_createClass(t,[{key:"getRgbItem",value:function(e,t,r,a){r[a]=255*e[t],r[a+1]=255*e[t+1],r[a+2]=255*e[t+2]}},{key:"getRgbBuffer",value:function(e,t,r,a,n,o,i){if(8!==o||0!==i)for(var u=255/((1<<o)-1),s=t,l=n,c=0;c<r;++c)a[l++]=u*e[s++],a[l++]=u*e[s++],a[l++]=u*e[s++],l+=i;else a.set(e.subarray(t,t+3*r),n)}},{key:"getOutputLength",value:function(e,t){return e*(3+t)/3|0}},{key:"isPassthrough",value:function(e){return 8===e}},{key:"isDefaultDecode",value:function(e){return ColorSpace.isDefaultDecode(e,this.numComps)}}]),t}(ColorSpace),DeviceCmykCS=function(){function e(e,t,r,a,n){var o=e[t]*r,i=e[t+1]*r,u=e[t+2]*r,s=e[t+3]*r;a[n]=255+o*(-4.387332384609988*o+54.48615194189176*i+18.82290502165302*u+212.25662451639585*s-285.2331026137004)+i*(1.7149763477362134*i-5.6096736904047315*u+-17.873870861415444*s-5.497006427196366)+u*(-2.5217340131683033*u-21.248923337353073*s+17.5119270841813)+s*(-21.86122147463605*s-189.48180835922747),a[n+1]=255+o*(8.841041422036149*o+60.118027045597366*i+6.871425592049007*u+31.159100130055922*s-79.2970844816548)+i*(-15.310361306967817*i+17.575251261109482*u+131.35250912493976*s-190.9453302588951)+u*(4.444339102852739*u+9.8632861493405*s-24.86741582555878)+s*(-20.737325471181034*s-187.80453709719578),a[n+2]=255+o*(.8842522430003296*o+8.078677503112928*i+30.89978309703729*u-.23883238689178934*s-14.183576799673286)+i*(10.49593273432072*i+63.02378494754052*u+50.606957656360734*s-112.23884253719248)+u*(.03296041114873217*u+115.60384449646641*s-193.58209356861505)+s*(-22.33816807309886*s-180.12613974708367)}var t=function(t){function r(){return _classCallCheck(this,r),_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,"DeviceCMYK",4))}return _inherits(r,t),_createClass(r,[{key:"getRgbItem",value:function(t,r,a,n){e(t,r,1,a,n)}},{key:"getRgbBuffer",value:function(t,r,a,n,o,i,u){for(var s=1/((1<<i)-1),l=0;l<a;l++)e(t,r,s,n,o),r+=4,o+=3+u}},{key:"getOutputLength",value:function(e,t){return e/4*(3+t)|0}},{key:"isDefaultDecode",value:function(e){return ColorSpace.isDefaultDecode(e,this.numComps)}}]),r}(ColorSpace);return t}(),CalGrayCS=function(){function e(e,t,r,a,n,o){var i=t[r]*o,u=Math.pow(i,e.G),s=e.YW*u,l=Math.max(295.8*Math.pow(s,.3333333333333333)-40.8,0);a[n]=l,a[n+1]=l,a[n+2]=l}var t=function(t){function r(e,t,a){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,"CalGray",1));if(!e)throw new _util.FormatError("WhitePoint missing - required for color space CalGray");if(t=t||[0,0,0],a=a||1,n.XW=e[0],n.YW=e[1],n.ZW=e[2],n.XB=t[0],n.YB=t[1],n.ZB=t[2],n.G=a,n.XW<0||n.ZW<0||1!==n.YW)throw new _util.FormatError("Invalid WhitePoint components for "+n.name+", no fallback available");return(n.XB<0||n.YB<0||n.ZB<0)&&((0,_util.info)("Invalid BlackPoint for "+n.name+", falling back to default."),n.XB=n.YB=n.ZB=0),0===n.XB&&0===n.YB&&0===n.ZB||(0,_util.warn)(n.name+", BlackPoint: XB: "+n.XB+", YB: "+n.YB+", ZB: "+n.ZB+", only default values are supported."),n.G<1&&((0,_util.info)("Invalid Gamma: "+n.G+" for "+n.name+", falling back to default."),n.G=1),n}return _inherits(r,t),_createClass(r,[{key:"getRgbItem",value:function(t,r,a,n){e(this,t,r,a,n,1)}},{key:"getRgbBuffer",value:function(t,r,a,n,o,i,u){for(var s=1/((1<<i)-1),l=0;l<a;++l)e(this,t,r,n,o,s),r+=1,o+=3+u}},{key:"getOutputLength",value:function(e,t){return e*(3+t)}},{key:"isDefaultDecode",value:function(e){return ColorSpace.isDefaultDecode(e,this.numComps)}}]),r}(ColorSpace);return t}(),CalRGBCS=function(){var e=new Float32Array([.8951,.2664,-.1614,-.7502,1.7135,.0367,.0389,-.0685,1.0296]),t=new Float32Array([.9869929,-.1470543,.1599627,.4323053,.5183603,.0492912,-.0085287,.0400428,.9684867]),r=new Float32Array([3.2404542,-1.5371385,-.4985314,-.969266,1.8760108,.041556,.0556434,-.2040259,1.0572252]),a=new Float32Array([1,1,1]),n=new Float32Array(3),o=new Float32Array(3),i=new Float32Array(3),u=Math.pow(24/116,3)/8;function s(e,t,r){r[0]=e[0]*t[0]+e[1]*t[1]+e[2]*t[2],r[1]=e[3]*t[0]+e[4]*t[1]+e[5]*t[2],r[2]=e[6]*t[0]+e[7]*t[1]+e[8]*t[2]}function l(e,t,r){r[0]=1*t[0]/e[0],r[1]=1*t[1]/e[1],r[2]=1*t[2]/e[2]}function c(e,t,r){var a=.95047,n=1,o=1.08883;r[0]=t[0]*a/e[0],r[1]=t[1]*n/e[1],r[2]=t[2]*o/e[2]}function f(e){return h(0,1,e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function h(e,t,r){return Math.max(e,Math.min(t,r))}function v(e){return e<0?-v(-e):e>8?Math.pow((e+16)/116,3):e*u}function g(e,t,r){if(0===e[0]&&0===e[1]&&0===e[2])return r[0]=t[0],r[1]=t[1],void(r[2]=t[2]);var a=v(0),n=a,o=v(e[0]),i=a,u=v(e[1]),s=a,l=v(e[2]),c=(1-n)/(1-o),f=1-c,h=(1-i)/(1-u),g=1-h,C=(1-s)/(1-l),p=1-C;r[0]=t[0]*c+f,r[1]=t[1]*h+g,r[2]=t[2]*C+p}function C(r,a,o){if(1===r[0]&&1===r[2])return o[0]=a[0],o[1]=a[1],void(o[2]=a[2]);var i=o;s(e,a,i);var u=n;l(r,i,u),s(t,u,o)}function p(r,a,o){var i=o;s(e,a,i);var u=n;c(r,i,u),s(t,u,o)}function m(e,t,n,u,l,c){var v=h(0,1,t[n]*c),m=h(0,1,t[n+1]*c),y=h(0,1,t[n+2]*c),b=Math.pow(v,e.GR),_=Math.pow(m,e.GG),d=Math.pow(y,e.GB),R=e.MXA*b+e.MXB*_+e.MXC*d,k=e.MYA*b+e.MYB*_+e.MYC*d,w=e.MZA*b+e.MZB*_+e.MZC*d,B=o;B[0]=R,B[1]=k,B[2]=w;var S=i;C(e.whitePoint,B,S);var D=o;g(e.blackPoint,S,D);var G=i;p(a,D,G);var I=o;s(r,G,I),u[l]=255*f(I[0]),u[l+1]=255*f(I[1]),u[l+2]=255*f(I[2])}var y=function(e){function t(e,r,a,n){_classCallCheck(this,t);var o=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"CalRGB",3));if(!e)throw new _util.FormatError("WhitePoint missing - required for color space CalRGB");r=r||new Float32Array(3),a=a||new Float32Array([1,1,1]),n=n||new Float32Array([1,0,0,0,1,0,0,0,1]);var i=e[0],u=e[1],s=e[2];o.whitePoint=e;var l=r[0],c=r[1],f=r[2];if(o.blackPoint=r,o.GR=a[0],o.GG=a[1],o.GB=a[2],o.MXA=n[0],o.MYA=n[1],o.MZA=n[2],o.MXB=n[3],o.MYB=n[4],o.MZB=n[5],o.MXC=n[6],o.MYC=n[7],o.MZC=n[8],i<0||s<0||1!==u)throw new _util.FormatError("Invalid WhitePoint components for "+o.name+", no fallback available");return(l<0||c<0||f<0)&&((0,_util.info)("Invalid BlackPoint for "+o.name+" ["+l+", "+c+", "+f+"], falling back to default."),o.blackPoint=new Float32Array(3)),(o.GR<0||o.GG<0||o.GB<0)&&((0,_util.info)("Invalid Gamma ["+o.GR+", "+o.GG+", "+o.GB+"] for "+o.name+", falling back to default."),o.GR=o.GG=o.GB=1),o}return _inherits(t,e),_createClass(t,[{key:"getRgbItem",value:function(e,t,r,a){m(this,e,t,r,a,1)}},{key:"getRgbBuffer",value:function(e,t,r,a,n,o,i){for(var u=1/((1<<o)-1),s=0;s<r;++s)m(this,e,t,a,n,u),t+=3,n+=3+i}},{key:"getOutputLength",value:function(e,t){return e*(3+t)/3|0}},{key:"isDefaultDecode",value:function(e){return ColorSpace.isDefaultDecode(e,this.numComps)}}]),t}(ColorSpace);return y}(),LabCS=function(){function e(e){var t=void 0;return t=e>=6/29?e*e*e:108/841*(e-4/29),t}function t(e,t,r,a){return r+e*(a-r)/t}function r(r,a,n,o,i,u){var s=a[n],l=a[n+1],c=a[n+2];!1!==o&&(s=t(s,o,0,100),l=t(l,o,r.amin,r.amax),c=t(c,o,r.bmin,r.bmax)),l=l>r.amax?r.amax:l<r.amin?r.amin:l,c=c>r.bmax?r.bmax:c<r.bmin?r.bmin:c;var f=(s+16)/116,h=f+l/500,v=f-c/200,g=r.XW*e(h),C=r.YW*e(f),p=r.ZW*e(v),m=void 0,y=void 0,b=void 0;r.ZW<1?(m=3.1339*g+-1.617*C+-.4906*p,y=-.9785*g+1.916*C+.0333*p,b=.072*g+-.229*C+1.4057*p):(m=3.2406*g+-1.5372*C+-.4986*p,y=-.9689*g+1.8758*C+.0415*p,b=.0557*g+-.204*C+1.057*p),i[u]=255*Math.sqrt(m),i[u+1]=255*Math.sqrt(y),i[u+2]=255*Math.sqrt(b)}var a=function(e){function t(e,r,a){_classCallCheck(this,t);var n=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Lab",3));if(!e)throw new _util.FormatError("WhitePoint missing - required for color space Lab");if(r=r||[0,0,0],a=a||[-100,100,-100,100],n.XW=e[0],n.YW=e[1],n.ZW=e[2],n.amin=a[0],n.amax=a[1],n.bmin=a[2],n.bmax=a[3],n.XB=r[0],n.YB=r[1],n.ZB=r[2],n.XW<0||n.ZW<0||1!==n.YW)throw new _util.FormatError("Invalid WhitePoint components, no fallback available");return(n.XB<0||n.YB<0||n.ZB<0)&&((0,_util.info)("Invalid BlackPoint, falling back to default"),n.XB=n.YB=n.ZB=0),(n.amin>n.amax||n.bmin>n.bmax)&&((0,_util.info)("Invalid Range, falling back to defaults"),n.amin=-100,n.amax=100,n.bmin=-100,n.bmax=100),n}return _inherits(t,e),_createClass(t,[{key:"getRgbItem",value:function(e,t,a,n){r(this,e,t,!1,a,n)}},{key:"getRgbBuffer",value:function(e,t,a,n,o,i,u){for(var s=(1<<i)-1,l=0;l<a;l++)r(this,e,t,s,n,o),t+=3,o+=3+u}},{key:"getOutputLength",value:function(e,t){return e*(3+t)/3|0}},{key:"isDefaultDecode",value:function(e){return!0}},{key:"usesZeroToOneRange",get:function(){return(0,_util.shadow)(this,"usesZeroToOneRange",!1)}}]),t}(ColorSpace);return a}();exports.ColorSpace=ColorSpace;