"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.calculateSHA512=exports.calculateSHA384=exports.calculateSHA256=exports.calculateMD5=exports.PDF20=exports.PDF17=exports.CipherTransformFactory=exports.ARCFourCipher=exports.AES256Cipher=exports.AES128Cipher=void 0;var _createClass=function(){function r(r,t){for(var e=0;e<t.length;e++){var n=t[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}(),_util=require("../shared/util"),_primitives=require("./primitives"),_stream=require("./stream");function _possibleConstructorReturn(r,t){if(!r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?r:t}function _inherits(r,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);r.prototype=Object.create(t&&t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(r,t):r.__proto__=t)}function _classCallCheck(r,t){if(!(r instanceof t))throw new TypeError("Cannot call a class as a function")}var ARCFourCipher=function(){function r(r){this.a=0,this.b=0;var t,e,n=new Uint8Array(256),i=0,o=r.length;for(t=0;t<256;++t)n[t]=t;for(t=0;t<256;++t)e=n[t],i=i+e+r[t%o]&255,n[t]=n[i],n[i]=e;this.s=n}return r.prototype={encryptBlock:function(r){var t,e,n,i=r.length,o=this.a,a=this.b,s=this.s,h=new Uint8Array(i);for(t=0;t<i;++t)o=o+1&255,e=s[o],a=a+e&255,n=s[a],s[o]=n,s[a]=e,h[t]=r[t]^s[e+n&255];return this.a=o,this.b=a,h}},r.prototype.decryptBlock=r.prototype.encryptBlock,r}(),calculateMD5=function(){var r=new Uint8Array([7,12,17,22,7,12,17,22,7,12,17,22,7,12,17,22,5,9,14,20,5,9,14,20,5,9,14,20,5,9,14,20,4,11,16,23,4,11,16,23,4,11,16,23,4,11,16,23,6,10,15,21,6,10,15,21,6,10,15,21,6,10,15,21]),t=new Int32Array([-680876936,-389564586,606105819,-1044525330,-176418897,1200080426,-1473231341,-45705983,1770035416,-1958414417,-42063,-1990404162,1804603682,-40341101,-1502002290,1236535329,-165796510,-1069501632,643717713,-373897302,-701558691,38016083,-660478335,-405537848,568446438,-1019803690,-187363961,1163531501,-1444681467,-51403784,1735328473,-1926607734,-378558,-2022574463,1839030562,-35309556,-1530992060,1272893353,-155497632,-1094730640,681279174,-358537222,-722521979,76029189,-640364487,-421815835,530742520,-995338651,-198630844,1126891415,-1416354905,-57434055,1700485571,-1894986606,-1051523,-2054922799,1873313359,-30611744,-1560198380,1309151649,-145523070,-1120210379,718787259,-343485551]);function e(e,n,i){var o,a,s,h=1732584193,u=-271733879,c=-1732584194,l=271733878,f=i+72&-64,w=new Uint8Array(f);for(o=0;o<i;++o)w[o]=e[n++];w[o++]=128,s=f-8;while(o<s)w[o++]=0;w[o++]=i<<3&255,w[o++]=i>>5&255,w[o++]=i>>13&255,w[o++]=i>>21&255,w[o++]=i>>>29&255,w[o++]=0,w[o++]=0,w[o++]=0;var d=new Int32Array(16);for(o=0;o<f;){for(a=0;a<16;++a,o+=4)d[a]=w[o]|w[o+1]<<8|w[o+2]<<16|w[o+3]<<24;var g,y,p=h,v=u,_=c,W=l;for(a=0;a<64;++a){a<16?(g=v&_|~v&W,y=a):a<32?(g=W&v|~W&_,y=5*a+1&15):a<48?(g=v^_^W,y=3*a+5&15):(g=_^(v|~W),y=7*a&15);var A=W,C=p+g+t[a]+d[y]|0,m=r[a];W=_,_=v,v=v+(C<<m|C>>>32-m)|0,p=A}h=h+p|0,u=u+v|0,c=c+_|0,l=l+W|0}return new Uint8Array([255&h,h>>8&255,h>>16&255,h>>>24&255,255&u,u>>8&255,u>>16&255,u>>>24&255,255&c,c>>8&255,c>>16&255,c>>>24&255,255&l,l>>8&255,l>>16&255,l>>>24&255])}return e}(),Word64=function(){function r(r,t){this.high=0|r,this.low=0|t}return r.prototype={and:function(r){this.high&=r.high,this.low&=r.low},xor:function(r){this.high^=r.high,this.low^=r.low},or:function(r){this.high|=r.high,this.low|=r.low},shiftRight:function(r){r>=32?(this.low=this.high>>>r-32|0,this.high=0):(this.low=this.low>>>r|this.high<<32-r,this.high=this.high>>>r|0)},shiftLeft:function(r){r>=32?(this.high=this.low<<r-32,this.low=0):(this.high=this.high<<r|this.low>>>32-r,this.low=this.low<<r)},rotateRight:function(r){var t,e;32&r?(e=this.low,t=this.high):(t=this.low,e=this.high),r&=31,this.low=t>>>r|e<<32-r,this.high=e>>>r|t<<32-r},not:function(){this.high=~this.high,this.low=~this.low},add:function(r){var t=(this.low>>>0)+(r.low>>>0),e=(this.high>>>0)+(r.high>>>0);t>4294967295&&(e+=1),this.low=0|t,this.high=0|e},copyTo:function(r,t){r[t]=this.high>>>24&255,r[t+1]=this.high>>16&255,r[t+2]=this.high>>8&255,r[t+3]=255&this.high,r[t+4]=this.low>>>24&255,r[t+5]=this.low>>16&255,r[t+6]=this.low>>8&255,r[t+7]=255&this.low},assign:function(r){this.high=r.high,this.low=r.low}},r}(),calculateSHA256=function(){function r(r,t){return r>>>t|r<<32-t}function t(r,t,e){return r&t^~r&e}function e(r,t,e){return r&t^r&e^t&e}function n(t){return r(t,2)^r(t,13)^r(t,22)}function i(t){return r(t,6)^r(t,11)^r(t,25)}function o(t){return r(t,7)^r(t,18)^t>>>3}function a(t){return r(t,17)^r(t,19)^t>>>10}var s=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function h(r,h,u){var c,l,f,w=1779033703,d=3144134277,g=1013904242,y=2773480762,p=1359893119,v=2600822924,_=528734635,W=1541459225,A=64*Math.ceil((u+9)/64),C=new Uint8Array(A);for(c=0;c<u;++c)C[c]=r[h++];C[c++]=128,f=A-8;while(c<f)C[c++]=0;C[c++]=0,C[c++]=0,C[c++]=0,C[c++]=u>>>29&255,C[c++]=u>>21&255,C[c++]=u>>13&255,C[c++]=u>>5&255,C[c++]=u<<3&255;var m=new Uint32Array(64);for(c=0;c<A;){for(l=0;l<16;++l)m[l]=C[c]<<24|C[c+1]<<16|C[c+2]<<8|C[c+3],c+=4;for(l=16;l<64;++l)m[l]=a(m[l-2])+m[l-7]+o(m[l-15])+m[l-16]|0;var S,b,U=w,x=d,k=g,T=y,F=p,E=v,R=_,B=W;for(l=0;l<64;++l)S=B+i(F)+t(F,E,R)+s[l]+m[l],b=n(U)+e(U,x,k),B=R,R=E,E=F,F=T+S|0,T=k,k=x,x=U,U=S+b|0;w=w+U|0,d=d+x|0,g=g+k|0,y=y+T|0,p=p+F|0,v=v+E|0,_=_+R|0,W=W+B|0}return new Uint8Array([w>>24&255,w>>16&255,w>>8&255,255&w,d>>24&255,d>>16&255,d>>8&255,255&d,g>>24&255,g>>16&255,g>>8&255,255&g,y>>24&255,y>>16&255,y>>8&255,255&y,p>>24&255,p>>16&255,p>>8&255,255&p,v>>24&255,v>>16&255,v>>8&255,255&v,_>>24&255,_>>16&255,_>>8&255,255&_,W>>24&255,W>>16&255,W>>8&255,255&W])}return h}(),calculateSHA512=function(){function r(r,t,e,n,i){r.assign(t),r.and(e),i.assign(t),i.not(),i.and(n),r.xor(i)}function t(r,t,e,n,i){r.assign(t),r.and(e),i.assign(t),i.and(n),r.xor(i),i.assign(e),i.and(n),r.xor(i)}function e(r,t,e){r.assign(t),r.rotateRight(28),e.assign(t),e.rotateRight(34),r.xor(e),e.assign(t),e.rotateRight(39),r.xor(e)}function n(r,t,e){r.assign(t),r.rotateRight(14),e.assign(t),e.rotateRight(18),r.xor(e),e.assign(t),e.rotateRight(41),r.xor(e)}function i(r,t,e){r.assign(t),r.rotateRight(1),e.assign(t),e.rotateRight(8),r.xor(e),e.assign(t),e.shiftRight(7),r.xor(e)}function o(r,t,e){r.assign(t),r.rotateRight(19),e.assign(t),e.rotateRight(61),r.xor(e),e.assign(t),e.shiftRight(6),r.xor(e)}var a=[new Word64(1116352408,3609767458),new Word64(1899447441,602891725),new Word64(3049323471,3964484399),new Word64(3921009573,2173295548),new Word64(961987163,4081628472),new Word64(1508970993,3053834265),new Word64(2453635748,2937671579),new Word64(2870763221,3664609560),new Word64(3624381080,2734883394),new Word64(310598401,1164996542),new Word64(607225278,1323610764),new Word64(1426881987,3590304994),new Word64(1925078388,4068182383),new Word64(2162078206,991336113),new Word64(2614888103,633803317),new Word64(3248222580,3479774868),new Word64(3835390401,2666613458),new Word64(4022224774,944711139),new Word64(264347078,2341262773),new Word64(604807628,2007800933),new Word64(770255983,1495990901),new Word64(1249150122,1856431235),new Word64(1555081692,3175218132),new Word64(1996064986,2198950837),new Word64(2554220882,3999719339),new Word64(2821834349,766784016),new Word64(2952996808,2566594879),new Word64(3210313671,3203337956),new Word64(3336571891,1034457026),new Word64(3584528711,2466948901),new Word64(113926993,3758326383),new Word64(338241895,168717936),new Word64(666307205,1188179964),new Word64(773529912,1546045734),new Word64(1294757372,1522805485),new Word64(1396182291,2643833823),new Word64(1695183700,2343527390),new Word64(1986661051,1014477480),new Word64(2177026350,1206759142),new Word64(2456956037,344077627),new Word64(2730485921,1290863460),new Word64(2820302411,3158454273),new Word64(3259730800,3505952657),new Word64(3345764771,106217008),new Word64(3516065817,3606008344),new Word64(3600352804,1432725776),new Word64(4094571909,1467031594),new Word64(275423344,851169720),new Word64(430227734,3100823752),new Word64(506948616,1363258195),new Word64(659060556,3750685593),new Word64(883997877,3785050280),new Word64(958139571,3318307427),new Word64(1322822218,3812723403),new Word64(1537002063,2003034995),new Word64(1747873779,3602036899),new Word64(1955562222,1575990012),new Word64(2024104815,1125592928),new Word64(2227730452,2716904306),new Word64(2361852424,442776044),new Word64(2428436474,593698344),new Word64(2756734187,3733110249),new Word64(3204031479,2999351573),new Word64(3329325298,3815920427),new Word64(3391569614,3928383900),new Word64(3515267271,566280711),new Word64(3940187606,3454069534),new Word64(4118630271,4000239992),new Word64(116418474,1914138554),new Word64(174292421,2731055270),new Word64(289380356,3203993006),new Word64(460393269,320620315),new Word64(685471733,587496836),new Word64(852142971,1086792851),new Word64(1017036298,365543100),new Word64(1126000580,2618297676),new Word64(1288033470,3409855158),new Word64(1501505948,4234509866),new Word64(1607167915,987167468),new Word64(1816402316,1246189591)];function s(s,h,u,c){var l,f,w,d,g,y,p,v;c=!!c,c?(l=new Word64(3418070365,3238371032),f=new Word64(1654270250,914150663),w=new Word64(2438529370,812702999),d=new Word64(355462360,4144912697),g=new Word64(1731405415,4290775857),y=new Word64(2394180231,1750603025),p=new Word64(3675008525,1694076839),v=new Word64(1203062813,3204075428)):(l=new Word64(1779033703,4089235720),f=new Word64(3144134277,2227873595),w=new Word64(1013904242,4271175723),d=new Word64(2773480762,1595750129),g=new Word64(1359893119,2917565137),y=new Word64(2600822924,725511199),p=new Word64(528734635,4215389547),v=new Word64(1541459225,327033209));var _,W,A,C=128*Math.ceil((u+17)/128),m=new Uint8Array(C);for(_=0;_<u;++_)m[_]=s[h++];m[_++]=128,A=C-16;while(_<A)m[_++]=0;m[_++]=0,m[_++]=0,m[_++]=0,m[_++]=0,m[_++]=0,m[_++]=0,m[_++]=0,m[_++]=0,m[_++]=0,m[_++]=0,m[_++]=0,m[_++]=u>>>29&255,m[_++]=u>>21&255,m[_++]=u>>13&255,m[_++]=u>>5&255,m[_++]=u<<3&255;var S=new Array(80);for(_=0;_<80;_++)S[_]=new Word64(0,0);var b,U,x=new Word64(0,0),k=new Word64(0,0),T=new Word64(0,0),F=new Word64(0,0),E=new Word64(0,0),R=new Word64(0,0),B=new Word64(0,0),P=new Word64(0,0),O=new Word64(0,0),D=new Word64(0,0),H=new Word64(0,0),M=new Word64(0,0);for(_=0;_<C;){for(W=0;W<16;++W)S[W].high=m[_]<<24|m[_+1]<<16|m[_+2]<<8|m[_+3],S[W].low=m[_+4]<<24|m[_+5]<<16|m[_+6]<<8|m[_+7],_+=8;for(W=16;W<80;++W)b=S[W],o(b,S[W-2],M),b.add(S[W-7]),i(H,S[W-15],M),b.add(H),b.add(S[W-16]);for(x.assign(l),k.assign(f),T.assign(w),F.assign(d),E.assign(g),R.assign(y),B.assign(p),P.assign(v),W=0;W<80;++W)O.assign(P),n(H,E,M),O.add(H),r(H,E,R,B,M),O.add(H),O.add(a[W]),O.add(S[W]),e(D,x,M),t(H,x,k,T,M),D.add(H),b=P,P=B,B=R,R=E,F.add(O),E=F,F=T,T=k,k=x,b.assign(O),b.add(D),x=b;l.add(x),f.add(k),w.add(T),d.add(F),g.add(E),y.add(R),p.add(B),v.add(P)}return c?(U=new Uint8Array(48),l.copyTo(U,0),f.copyTo(U,8),w.copyTo(U,16),d.copyTo(U,24),g.copyTo(U,32),y.copyTo(U,40)):(U=new Uint8Array(64),l.copyTo(U,0),f.copyTo(U,8),w.copyTo(U,16),d.copyTo(U,24),g.copyTo(U,32),y.copyTo(U,40),p.copyTo(U,48),v.copyTo(U,56)),U}return s}(),calculateSHA384=function(){function r(r,t,e){return calculateSHA512(r,t,e,!0)}return r}(),NullCipher=function(){function r(){}return r.prototype={decryptBlock:function(r){return r}},r}(),AESBaseCipher=function(){function r(){_classCallCheck(this,r),this.constructor===r&&(0,_util.unreachable)("Cannot initialize AESBaseCipher."),this._s=new Uint8Array([99,124,119,123,242,107,111,197,48,1,103,43,254,215,171,118,202,130,201,125,250,89,71,240,173,212,162,175,156,164,114,192,183,253,147,38,54,63,247,204,52,165,229,241,113,216,49,21,4,199,35,195,24,150,5,154,7,18,128,226,235,39,178,117,9,131,44,26,27,110,90,160,82,59,214,179,41,227,47,132,83,209,0,237,32,252,177,91,106,203,190,57,74,76,88,207,208,239,170,251,67,77,51,133,69,249,2,127,80,60,159,168,81,163,64,143,146,157,56,245,188,182,218,33,16,255,243,210,205,12,19,236,95,151,68,23,196,167,126,61,100,93,25,115,96,129,79,220,34,42,144,136,70,238,184,20,222,94,11,219,224,50,58,10,73,6,36,92,194,211,172,98,145,149,228,121,231,200,55,109,141,213,78,169,108,86,244,234,101,122,174,8,186,120,37,46,28,166,180,198,232,221,116,31,75,189,139,138,112,62,181,102,72,3,246,14,97,53,87,185,134,193,29,158,225,248,152,17,105,217,142,148,155,30,135,233,206,85,40,223,140,161,137,13,191,230,66,104,65,153,45,15,176,84,187,22]),this._inv_s=new Uint8Array([82,9,106,213,48,54,165,56,191,64,163,158,129,243,215,251,124,227,57,130,155,47,255,135,52,142,67,68,196,222,233,203,84,123,148,50,166,194,35,61,238,76,149,11,66,250,195,78,8,46,161,102,40,217,36,178,118,91,162,73,109,139,209,37,114,248,246,100,134,104,152,22,212,164,92,204,93,101,182,146,108,112,72,80,253,237,185,218,94,21,70,87,167,141,157,132,144,216,171,0,140,188,211,10,247,228,88,5,184,179,69,6,208,44,30,143,202,63,15,2,193,175,189,3,1,19,138,107,58,145,17,65,79,103,220,234,151,242,207,206,240,180,230,115,150,172,116,34,231,173,53,133,226,249,55,232,28,117,223,110,71,241,26,113,29,41,197,137,111,183,98,14,170,24,190,27,252,86,62,75,198,210,121,32,154,219,192,254,120,205,90,244,31,221,168,51,136,7,199,49,177,18,16,89,39,128,236,95,96,81,127,169,25,181,74,13,45,229,122,159,147,201,156,239,160,224,59,77,174,42,245,176,200,235,187,60,131,83,153,97,23,43,4,126,186,119,214,38,225,105,20,99,85,33,12,125]),this._mix=new Uint32Array([0,235474187,470948374,303765277,941896748,908933415,607530554,708780849,1883793496,2118214995,1817866830,1649639237,1215061108,1181045119,1417561698,1517767529,3767586992,4003061179,4236429990,4069246893,3635733660,3602770327,3299278474,3400528769,2430122216,2664543715,2362090238,2193862645,2835123396,2801107407,3035535058,3135740889,3678124923,3576870512,3341394285,3374361702,3810496343,3977675356,4279080257,4043610186,2876494627,2776292904,3076639029,3110650942,2472011535,2640243204,2403728665,2169303058,1001089995,899835584,666464733,699432150,59727847,226906860,530400753,294930682,1273168787,1172967064,1475418501,1509430414,1942435775,2110667444,1876241833,1641816226,2910219766,2743034109,2976151520,3211623147,2505202138,2606453969,2302690252,2269728455,3711829422,3543599269,3240894392,3475313331,3843699074,3943906441,4178062228,4144047775,1306967366,1139781709,1374988112,1610459739,1975683434,2076935265,1775276924,1742315127,1034867998,866637845,566021896,800440835,92987698,193195065,429456164,395441711,1984812685,2017778566,1784663195,1683407248,1315562145,1080094634,1383856311,1551037884,101039829,135050206,437757123,337553864,1042385657,807962610,573804783,742039012,2531067453,2564033334,2328828971,2227573024,2935566865,2700099354,3001755655,3168937228,3868552805,3902563182,4203181171,4102977912,3736164937,3501741890,3265478751,3433712980,1106041591,1340463100,1576976609,1408749034,2043211483,2009195472,1708848333,1809054150,832877231,1068351396,766945465,599762354,159417987,126454664,361929877,463180190,2709260871,2943682380,3178106961,3009879386,2572697195,2538681184,2236228733,2336434550,3509871135,3745345300,3441850377,3274667266,3910161971,3877198648,4110568485,4211818798,2597806476,2497604743,2261089178,2295101073,2733856160,2902087851,3202437046,2968011453,3936291284,3835036895,4136440770,4169408201,3535486456,3702665459,3467192302,3231722213,2051518780,1951317047,1716890410,1750902305,1113818384,1282050075,1584504582,1350078989,168810852,67556463,371049330,404016761,841739592,1008918595,775550814,540080725,3969562369,3801332234,4035489047,4269907996,3569255213,3669462566,3366754619,3332740144,2631065433,2463879762,2160117071,2395588676,2767645557,2868897406,3102011747,3069049960,202008497,33778362,270040487,504459436,875451293,975658646,675039627,641025152,2084704233,1917518562,1615861247,1851332852,1147550661,1248802510,1484005843,1451044056,933301370,967311729,733156972,632953703,260388950,25965917,328671808,496906059,1206477858,1239443753,1543208500,1441952575,2144161806,1908694277,1675577880,1842759443,3610369226,3644379585,3408119516,3307916247,4011190502,3776767469,4077384432,4245618683,2809771154,2842737049,3144396420,3043140495,2673705150,2438237621,2203032232,2370213795]),this._mixCol=new Uint8Array(256);for(var t=0;t<256;t++)this._mixCol[t]=t<128?t<<1:t<<1^27;this.buffer=new Uint8Array(16),this.bufferPosition=0}return _createClass(r,[{key:"_expandKey",value:function(r){(0,_util.unreachable)("Cannot call `_expandKey` on the base class")}},{key:"_decrypt",value:function(r,t){var e=void 0,n=void 0,i=void 0,o=new Uint8Array(16);o.set(r);for(var a=0,s=this._keySize;a<16;++a,++s)o[a]^=t[s];for(var h=this._cyclesOfRepetition-1;h>=1;--h){e=o[13],o[13]=o[9],o[9]=o[5],o[5]=o[1],o[1]=e,e=o[14],n=o[10],o[14]=o[6],o[10]=o[2],o[6]=e,o[2]=n,e=o[15],n=o[11],i=o[7],o[15]=o[3],o[11]=e,o[7]=n,o[3]=i;for(var u=0;u<16;++u)o[u]=this._inv_s[o[u]];for(var c=0,l=16*h;c<16;++c,++l)o[c]^=t[l];for(var f=0;f<16;f+=4){var w=this._mix[o[f]],d=this._mix[o[f+1]],g=this._mix[o[f+2]],y=this._mix[o[f+3]];e=w^d>>>8^d<<24^g>>>16^g<<16^y>>>24^y<<8,o[f]=e>>>24&255,o[f+1]=e>>16&255,o[f+2]=e>>8&255,o[f+3]=255&e}}e=o[13],o[13]=o[9],o[9]=o[5],o[5]=o[1],o[1]=e,e=o[14],n=o[10],o[14]=o[6],o[10]=o[2],o[6]=e,o[2]=n,e=o[15],n=o[11],i=o[7],o[15]=o[3],o[11]=e,o[7]=n,o[3]=i;for(var p=0;p<16;++p)o[p]=this._inv_s[o[p]],o[p]^=t[p];return o}},{key:"_encrypt",value:function(r,t){var e=this._s,n=void 0,i=void 0,o=void 0,a=new Uint8Array(16);a.set(r);for(var s=0;s<16;++s)a[s]^=t[s];for(var h=1;h<this._cyclesOfRepetition;h++){for(var u=0;u<16;++u)a[u]=e[a[u]];o=a[1],a[1]=a[5],a[5]=a[9],a[9]=a[13],a[13]=o,o=a[2],i=a[6],a[2]=a[10],a[6]=a[14],a[10]=o,a[14]=i,o=a[3],i=a[7],n=a[11],a[3]=a[15],a[7]=o,a[11]=i,a[15]=n;for(var c=0;c<16;c+=4){var l=a[c+0],f=a[c+1],w=a[c+2],d=a[c+3];n=l^f^w^d,a[c+0]^=n^this._mixCol[l^f],a[c+1]^=n^this._mixCol[f^w],a[c+2]^=n^this._mixCol[w^d],a[c+3]^=n^this._mixCol[d^l]}for(var g=0,y=16*h;g<16;++g,++y)a[g]^=t[y]}for(var p=0;p<16;++p)a[p]=e[a[p]];o=a[1],a[1]=a[5],a[5]=a[9],a[9]=a[13],a[13]=o,o=a[2],i=a[6],a[2]=a[10],a[6]=a[14],a[10]=o,a[14]=i,o=a[3],i=a[7],n=a[11],a[3]=a[15],a[7]=o,a[11]=i,a[15]=n;for(var v=0,_=this._keySize;v<16;++v,++_)a[v]^=t[_];return a}},{key:"_decryptBlock2",value:function(r,t){for(var e=r.length,n=this.buffer,i=this.bufferPosition,o=[],a=this.iv,s=0;s<e;++s)if(n[i]=r[s],++i,!(i<16)){for(var h=this._decrypt(n,this._key),u=0;u<16;++u)h[u]^=a[u];a=n,o.push(h),n=new Uint8Array(16),i=0}if(this.buffer=n,this.bufferLength=i,this.iv=a,0===o.length)return new Uint8Array(0);var c=16*o.length;if(t){var l=o[o.length-1],f=l[15];if(f<=16){for(var w=15,d=16-f;w>=d;--w)if(l[w]!==f){f=0;break}c-=f,o[o.length-1]=l.subarray(0,16-f)}}for(var g=new Uint8Array(c),y=0,p=0,v=o.length;y<v;++y,p+=16)g.set(o[y],p);return g}},{key:"decryptBlock",value:function(r,t){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=r.length,i=this.buffer,o=this.bufferPosition;if(e)this.iv=e;else{for(var a=0;o<16&&a<n;++a,++o)i[o]=r[a];if(o<16)return this.bufferLength=o,new Uint8Array(0);this.iv=i,r=r.subarray(16)}return this.buffer=new Uint8Array(16),this.bufferLength=0,this.decryptBlock=this._decryptBlock2,this.decryptBlock(r,t)}},{key:"encrypt",value:function(r,t){var e=r.length,n=this.buffer,i=this.bufferPosition,o=[];t||(t=new Uint8Array(16));for(var a=0;a<e;++a)if(n[i]=r[a],++i,!(i<16)){for(var s=0;s<16;++s)n[s]^=t[s];var h=this._encrypt(n,this._key);t=h,o.push(h),n=new Uint8Array(16),i=0}if(this.buffer=n,this.bufferLength=i,this.iv=t,0===o.length)return new Uint8Array(0);for(var u=16*o.length,c=new Uint8Array(u),l=0,f=0,w=o.length;l<w;++l,f+=16)c.set(o[l],f);return c}}]),r}(),AES128Cipher=function(r){function t(r){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._cyclesOfRepetition=10,e._keySize=160,e._rcon=new Uint8Array([141,1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145,57,114,228,211,189,97,194,159,37,74,148,51,102,204,131,29,58,116,232,203,141,1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145,57,114,228,211,189,97,194,159,37,74,148,51,102,204,131,29,58,116,232,203,141,1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145,57,114,228,211,189,97,194,159,37,74,148,51,102,204,131,29,58,116,232,203,141,1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145,57,114,228,211,189,97,194,159,37,74,148,51,102,204,131,29,58,116,232,203,141,1,2,4,8,16,32,64,128,27,54,108,216,171,77,154,47,94,188,99,198,151,53,106,212,179,125,250,239,197,145,57,114,228,211,189,97,194,159,37,74,148,51,102,204,131,29,58,116,232,203,141]),e._key=e._expandKey(r),e}return _inherits(t,r),_createClass(t,[{key:"_expandKey",value:function(r){var t=176,e=this._s,n=this._rcon,i=new Uint8Array(t);i.set(r);for(var o=16,a=1;o<t;++a){var s=i[o-3],h=i[o-2],u=i[o-1],c=i[o-4];s=e[s],h=e[h],u=e[u],c=e[c],s^=n[a];for(var l=0;l<4;++l)i[o]=s^=i[o-16],o++,i[o]=h^=i[o-16],o++,i[o]=u^=i[o-16],o++,i[o]=c^=i[o-16],o++}return i}}]),t}(AESBaseCipher),AES256Cipher=function(r){function t(r){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e._cyclesOfRepetition=14,e._keySize=224,e._key=e._expandKey(r),e}return _inherits(t,r),_createClass(t,[{key:"_expandKey",value:function(r){var t=240,e=this._s,n=new Uint8Array(t);n.set(r);for(var i=1,o=void 0,a=void 0,s=void 0,h=void 0,u=32,c=1;u<t;++c){u%32===16?(o=e[o],a=e[a],s=e[s],h=e[h]):u%32===0&&(o=n[u-3],a=n[u-2],s=n[u-1],h=n[u-4],o=e[o],a=e[a],s=e[s],h=e[h],o^=i,(i<<=1)>=256&&(i=255&(27^i)));for(var l=0;l<4;++l)n[u]=o^=n[u-32],u++,n[u]=a^=n[u-32],u++,n[u]=s^=n[u-32],u++,n[u]=h^=n[u-32],u++}return n}}]),t}(AESBaseCipher),PDF17=function(){function r(r,t){if(r.length!==t.length)return!1;for(var e=0;e<r.length;e++)if(r[e]!==t[e])return!1;return!0}function t(){}return t.prototype={checkOwnerPassword:function(t,e,n,i){var o=new Uint8Array(t.length+56);o.set(t,0),o.set(e,t.length),o.set(n,t.length+e.length);var a=calculateSHA256(o,0,o.length);return r(a,i)},checkUserPassword:function(t,e,n){var i=new Uint8Array(t.length+8);i.set(t,0),i.set(e,t.length);var o=calculateSHA256(i,0,i.length);return r(o,n)},getOwnerKey:function(r,t,e,n){var i=new Uint8Array(r.length+56);i.set(r,0),i.set(t,r.length),i.set(e,r.length+t.length);var o=calculateSHA256(i,0,i.length),a=new AES256Cipher(o);return a.decryptBlock(n,!1,new Uint8Array(16))},getUserKey:function(r,t,e){var n=new Uint8Array(r.length+8);n.set(r,0),n.set(t,r.length);var i=calculateSHA256(n,0,n.length),o=new AES256Cipher(i);return o.decryptBlock(e,!1,new Uint8Array(16))}},t}(),PDF20=function(){function r(r,t){var e=new Uint8Array(r.length+t.length);return e.set(r,0),e.set(t,r.length),e}function t(t,e,n){var i=calculateSHA256(e,0,e.length).subarray(0,32),o=[0],a=0;while(a<64||o[o.length-1]>a-32){var s=t.length+i.length+n.length,h=new Uint8Array(64*s),u=r(t,i);u=r(u,n);for(var c=0,l=0;c<64;c++,l+=s)h.set(u,l);var f=new AES128Cipher(i.subarray(0,16));o=f.encrypt(h,i.subarray(16,32));for(var w=0,d=0;d<16;d++)w*=1,w%=3,w+=(o[d]>>>0)%3,w%=3;0===w?i=calculateSHA256(o,0,o.length):1===w?i=calculateSHA384(o,0,o.length):2===w&&(i=calculateSHA512(o,0,o.length)),a++}return i.subarray(0,32)}function e(){}function n(r,t){if(r.length!==t.length)return!1;for(var e=0;e<r.length;e++)if(r[e]!==t[e])return!1;return!0}return e.prototype={hash:function(r,e,n){return t(r,e,n)},checkOwnerPassword:function(r,e,i,o){var a=new Uint8Array(r.length+56);a.set(r,0),a.set(e,r.length),a.set(i,r.length+e.length);var s=t(r,a,i);return n(s,o)},checkUserPassword:function(r,e,i){var o=new Uint8Array(r.length+8);o.set(r,0),o.set(e,r.length);var a=t(r,o,[]);return n(a,i)},getOwnerKey:function(r,e,n,i){var o=new Uint8Array(r.length+56);o.set(r,0),o.set(e,r.length),o.set(n,r.length+e.length);var a=t(r,o,n),s=new AES256Cipher(a);return s.decryptBlock(i,!1,new Uint8Array(16))},getUserKey:function(r,e,n){var i=new Uint8Array(r.length+8);i.set(r,0),i.set(e,r.length);var o=t(r,i,[]),a=new AES256Cipher(o);return a.decryptBlock(n,!1,new Uint8Array(16))}},e}(),CipherTransform=function(){function r(r,t){this.StringCipherConstructor=r,this.StreamCipherConstructor=t}return r.prototype={createStream:function(r,t){var e=new this.StreamCipherConstructor;return new _stream.DecryptStream(r,t,(function(r,t){return e.decryptBlock(r,t)}))},decryptString:function(r){var t=new this.StringCipherConstructor,e=(0,_util.stringToBytes)(r);return e=t.decryptBlock(e,!0),(0,_util.bytesToString)(e)}},r}(),CipherTransformFactory=function(){var r=new Uint8Array([40,191,78,94,78,117,138,65,100,0,78,86,255,250,1,8,46,46,0,182,208,104,62,128,47,12,169,254,100,83,105,122]);function t(r,t,e,n,i,o,a,s,h,u,c,l){if(t){var f=Math.min(127,t.length);t=t.subarray(0,f)}else t=[];var w;return w=6===r?new PDF20:new PDF17,w.checkUserPassword(t,s,a)?w.getUserKey(t,h,c):t.length&&w.checkOwnerPassword(t,n,o,e)?w.getOwnerKey(t,i,o,u):null}function e(t,e,n,i,o,a,s,h){var u,c,l=40+n.length+t.length,f=new Uint8Array(l),w=0;if(e)for(c=Math.min(32,e.length);w<c;++w)f[w]=e[w];u=0;while(w<32)f[w++]=r[u++];for(u=0,c=n.length;u<c;++u)f[w++]=n[u];for(f[w++]=255&o,f[w++]=o>>8&255,f[w++]=o>>16&255,f[w++]=o>>>24&255,u=0,c=t.length;u<c;++u)f[w++]=t[u];a>=4&&!h&&(f[w++]=255,f[w++]=255,f[w++]=255,f[w++]=255);var d=calculateMD5(f,0,w),g=s>>3;if(a>=3)for(u=0;u<50;++u)d=calculateMD5(d,0,g);var y,p,v=d.subarray(0,g);if(a>=3){for(w=0;w<32;++w)f[w]=r[w];for(u=0,c=t.length;u<c;++u)f[w++]=t[u];y=new ARCFourCipher(v),p=y.encryptBlock(calculateMD5(f,0,w)),c=v.length;var _,W=new Uint8Array(c);for(u=1;u<=19;++u){for(_=0;_<c;++_)W[_]=v[_]^u;y=new ARCFourCipher(W),p=y.encryptBlock(p)}for(u=0,c=p.length;u<c;++u)if(i[u]!==p[u])return null}else for(y=new ARCFourCipher(v),p=y.encryptBlock(r),u=0,c=p.length;u<c;++u)if(i[u]!==p[u])return null;return v}function n(t,e,n,i){var o,a,s=new Uint8Array(32),h=0;for(a=Math.min(32,t.length);h<a;++h)s[h]=t[h];o=0;while(h<32)s[h++]=r[o++];var u,c,l=calculateMD5(s,0,h),f=i>>3;if(n>=3)for(o=0;o<50;++o)l=calculateMD5(l,0,l.length);if(n>=3){c=e;var w,d=new Uint8Array(f);for(o=19;o>=0;o--){for(w=0;w<f;++w)d[w]=l[w]^o;u=new ARCFourCipher(d),c=u.encryptBlock(c)}}else u=new ARCFourCipher(l.subarray(0,f)),c=u.encryptBlock(e);return c}var i=_primitives.Name.get("Identity");function o(r,o,a){var s=r.get("Filter");if(!(0,_primitives.isName)(s,"Standard"))throw new _util.FormatError("unknown encryption method");this.dict=r;var h=r.get("V");if(!Number.isInteger(h)||1!==h&&2!==h&&4!==h&&5!==h)throw new _util.FormatError("unsupported encryption algorithm");this.algorithm=h;var u=r.get("Length");if(!u)if(h<=3)u=40;else{var c=r.get("CF"),l=r.get("StmF");if((0,_primitives.isDict)(c)&&(0,_primitives.isName)(l)){c.suppressEncryption=!0;var f=c.get(l.name);u=f&&f.get("Length")||128,u<40&&(u<<=3)}}if(!Number.isInteger(u)||u<40||u%8!==0)throw new _util.FormatError("invalid key length");var w=(0,_util.stringToBytes)(r.get("O")).subarray(0,32),d=(0,_util.stringToBytes)(r.get("U")).subarray(0,32),g=r.get("P"),y=r.get("R"),p=(4===h||5===h)&&!1!==r.get("EncryptMetadata");this.encryptMetadata=p;var v,_,W=(0,_util.stringToBytes)(o);if(a){if(6===y)try{a=(0,_util.utf8StringToString)(a)}catch(E){(0,_util.warn)("CipherTransformFactory: Unable to convert UTF8 encoded password.")}v=(0,_util.stringToBytes)(a)}if(5!==h)_=e(W,v,w,d,g,y,u,p);else{var A=(0,_util.stringToBytes)(r.get("O")).subarray(32,40),C=(0,_util.stringToBytes)(r.get("O")).subarray(40,48),m=(0,_util.stringToBytes)(r.get("U")).subarray(0,48),S=(0,_util.stringToBytes)(r.get("U")).subarray(32,40),b=(0,_util.stringToBytes)(r.get("U")).subarray(40,48),U=(0,_util.stringToBytes)(r.get("OE")),x=(0,_util.stringToBytes)(r.get("UE")),k=(0,_util.stringToBytes)(r.get("Perms"));_=t(y,v,w,A,C,m,d,S,b,U,x,k)}if(!_&&!a)throw new _util.PasswordException("No password given",_util.PasswordResponses.NEED_PASSWORD);if(!_&&a){var T=n(v,w,y,u);_=e(W,T,w,d,g,y,u,p)}if(!_)throw new _util.PasswordException("Incorrect Password",_util.PasswordResponses.INCORRECT_PASSWORD);if(this.encryptionKey=_,h>=4){var F=r.get("CF");(0,_primitives.isDict)(F)&&(F.suppressEncryption=!0),this.cf=F,this.stmf=r.get("StmF")||i,this.strf=r.get("StrF")||i,this.eff=r.get("EFF")||this.stmf}}function a(r,t,e,n){var i,o,a=new Uint8Array(e.length+9);for(i=0,o=e.length;i<o;++i)a[i]=e[i];a[i++]=255&r,a[i++]=r>>8&255,a[i++]=r>>16&255,a[i++]=255&t,a[i++]=t>>8&255,n&&(a[i++]=115,a[i++]=65,a[i++]=108,a[i++]=84);var s=calculateMD5(a,0,i);return s.subarray(0,Math.min(e.length+5,16))}function s(r,t,e,n,i){if(!(0,_primitives.isName)(t))throw new _util.FormatError("Invalid crypt filter name.");var o,s=r.get(t.name);if(null!==s&&void 0!==s&&(o=s.get("CFM")),!o||"None"===o.name)return function(){return new NullCipher};if("V2"===o.name)return function(){return new ARCFourCipher(a(e,n,i,!1))};if("AESV2"===o.name)return function(){return new AES128Cipher(a(e,n,i,!0))};if("AESV3"===o.name)return function(){return new AES256Cipher(i)};throw new _util.FormatError("Unknown crypto method")}return o.prototype={createCipherTransform:function(r,t){if(4===this.algorithm||5===this.algorithm)return new CipherTransform(s(this.cf,this.stmf,r,t,this.encryptionKey),s(this.cf,this.strf,r,t,this.encryptionKey));var e=a(r,t,this.encryptionKey,!1),n=function(){return new ARCFourCipher(e)};return new CipherTransform(n,n)}},o}();exports.AES128Cipher=AES128Cipher,exports.AES256Cipher=AES256Cipher,exports.ARCFourCipher=ARCFourCipher,exports.CipherTransformFactory=CipherTransformFactory,exports.PDF17=PDF17,exports.PDF20=PDF20,exports.calculateMD5=calculateMD5,exports.calculateSHA256=calculateSHA256,exports.calculateSHA384=calculateSHA384,exports.calculateSHA512=calculateSHA512;