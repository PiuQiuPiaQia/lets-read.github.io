"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.JpegStream=void 0;var _util=require("../shared/util"),_stream=require("./stream"),_primitives=require("./primitives"),_jpg=require("./jpg"),JpegStream=function(){function e(e,t,r,i){var s=void 0;while(-1!==(s=e.getByte()))if(255===s){e.skip(-1);break}this.stream=e,this.maybeLength=t,this.dict=r,this.params=i,_stream.DecodeStream.call(this,t)}return e.prototype=Object.create(_stream.DecodeStream.prototype),Object.defineProperty(e.prototype,"bytes",{get:function(){return(0,_util.shadow)(this,"bytes",this.stream.getBytes(this.maybeLength))},configurable:!0}),e.prototype.ensureBuffer=function(e){},e.prototype.readBlock=function(){if(!this.eof){var e={decodeTransform:void 0,colorTransform:void 0},t=this.dict.getArray("Decode","D");if(this.forceRGB&&Array.isArray(t)){for(var r=this.dict.get("BitsPerComponent")||8,i=t.length,s=new Int32Array(i),o=!1,a=(1<<r)-1,h=0;h<i;h+=2)s[h]=256*(t[h+1]-t[h])|0,s[h+1]=t[h]*a|0,256===s[h]&&0===s[h+1]||(o=!0);o&&(e.decodeTransform=s)}if((0,_primitives.isDict)(this.params)){var n=this.params.get("ColorTransform");Number.isInteger(n)&&(e.colorTransform=n)}var p=new _jpg.JpegImage(e);p.parse(this.bytes);var c=p.getData({width:this.drawWidth,height:this.drawHeight,forceRGB:this.forceRGB,isSourcePDF:!0});this.buffer=c,this.bufferLength=c.length,this.eof=!0}},e.prototype.getIR=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,_util.createObjectURL)(this.bytes,"image/jpeg",e)},e}();exports.JpegStream=JpegStream;