"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.bidi=void 0;var _util=require("../shared/util"),baseTypes=["BN","BN","BN","BN","BN","BN","BN","BN","BN","S","B","S","WS","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","B","B","B","S","WS","ON","ON","ET","ET","ET","ON","ON","ON","ON","ON","ES","CS","ES","CS","CS","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","CS","ON","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","ON","ON","ON","BN","BN","BN","BN","BN","BN","B","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","BN","CS","ON","ET","ET","ET","ET","ON","ON","ON","ON","L","ON","ON","BN","ON","ON","ET","ET","EN","EN","ON","L","ON","ON","ON","EN","L","ON","ON","ON","ON","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","L","ON","L","L","L","L","L","L","L","L"],arabicTypes=["AN","AN","AN","AN","AN","AN","ON","ON","AL","ET","ET","AL","CS","AL","ON","ON","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","AN","AN","AN","AN","AN","AN","AN","AN","AN","ET","AN","AN","AL","AL","AL","NSM","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","AL","NSM","NSM","NSM","NSM","NSM","NSM","NSM","AN","ON","NSM","NSM","NSM","NSM","NSM","NSM","AL","AL","NSM","NSM","ON","NSM","NSM","NSM","NSM","AL","AL","EN","EN","EN","EN","EN","EN","EN","EN","EN","EN","AL","AL","AL","AL","AL","AL"];function isOdd(L){return 0!==(1&L)}function isEven(L){return 0===(1&L)}function findUnequal(L,N,A){for(var e=N,r=L.length;e<r;++e)if(L[e]!==A)return e;return e}function setValues(L,N,A,e){for(var r=N;r<A;++r)L[r]=e}function reverseValues(L,N,A){for(var e=N,r=A-1;e<r;++e,--r){var t=L[e];L[e]=L[r],L[r]=t}}function createBidiText(L,N,A){return{str:L,dir:A?"ttb":N?"ltr":"rtl"}}var chars=[],types=[];function bidi(L,N,A){var e=!0,r=L.length;if(0===r||A)return createBidiText(L,e,A);chars.length=r,types.length=r;var t,s,S=0;for(t=0;t<r;++t){chars[t]=L.charAt(t);var B=L.charCodeAt(t),E="L";B<=255?E=baseTypes[B]:1424<=B&&B<=1524?E="R":1536<=B&&B<=1791?(E=arabicTypes[255&B],E||(0,_util.warn)("Bidi: invalid Unicode character "+B.toString(16))):1792<=B&&B<=2220&&(E="AL"),"R"!==E&&"AL"!==E&&"AN"!==E||S++,types[t]=E}if(0===S)return e=!0,createBidiText(L,e);-1===N&&(S/r<.3?(e=!0,N=0):(e=!1,N=1));var O=[];for(t=0;t<r;++t)O[t]=N;var i,M=isOdd(N)?"R":"L",a=M,p=a,y=a;for(t=0;t<r;++t)"NSM"===types[t]?types[t]=y:y=types[t];for(y=a,t=0;t<r;++t)i=types[t],"EN"===i?types[t]="AL"===y?"AN":"EN":"R"!==i&&"L"!==i&&"AL"!==i||(y=i);for(t=0;t<r;++t)i=types[t],"AL"===i&&(types[t]="R");for(t=1;t<r-1;++t)"ES"===types[t]&&"EN"===types[t-1]&&"EN"===types[t+1]&&(types[t]="EN"),"CS"!==types[t]||"EN"!==types[t-1]&&"AN"!==types[t-1]||types[t+1]!==types[t-1]||(types[t]=types[t-1]);for(t=0;t<r;++t)if("EN"===types[t]){var n;for(n=t-1;n>=0;--n){if("ET"!==types[n])break;types[n]="EN"}for(n=t+1;n<r;++n){if("ET"!==types[n])break;types[n]="EN"}}for(t=0;t<r;++t)i=types[t],"WS"!==i&&"ES"!==i&&"ET"!==i&&"CS"!==i||(types[t]="ON");for(y=a,t=0;t<r;++t)i=types[t],"EN"===i?types[t]="L"===y?"L":"EN":"R"!==i&&"L"!==i||(y=i);for(t=0;t<r;++t)if("ON"===types[t]){var f=findUnequal(types,t+1,"ON"),o=a;t>0&&(o=types[t-1]);var c=p;f+1<r&&(c=types[f+1]),"L"!==o&&(o="R"),"L"!==c&&(c="R"),o===c&&setValues(types,t,f,o),t=f-1}for(t=0;t<r;++t)"ON"===types[t]&&(types[t]=M);for(t=0;t<r;++t)i=types[t],isEven(O[t])?"R"===i?O[t]+=1:"AN"!==i&&"EN"!==i||(O[t]+=2):"L"!==i&&"AN"!==i&&"EN"!==i||(O[t]+=1);var u,d=-1,v=99;for(t=0,s=O.length;t<s;++t)u=O[t],d<u&&(d=u),v>u&&isOdd(u)&&(v=u);for(u=d;u>=v;--u){var l=-1;for(t=0,s=O.length;t<s;++t)O[t]<u?l>=0&&(reverseValues(chars,l,t),l=-1):l<0&&(l=t);l>=0&&reverseValues(chars,l,O.length)}for(t=0,s=chars.length;t<s;++t){var T=chars[t];"<"!==T&&">"!==T||(chars[t]="")}return createBidiText(chars.join(""),e)}exports.bidi=bidi;