"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.AnnotationLayer=void 0;var _get=function t(e,n,i){null===e&&(e=Function.prototype);var a=Object.getOwnPropertyDescriptor(e,n);if(void 0===a){var r=Object.getPrototypeOf(e);return null===r?void 0:t(r,n,i)}if("value"in a)return a.value;var o=a.get;return void 0!==o?o.call(i):void 0},_createClass=function(){function t(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),_dom_utils=require("./dom_utils"),_util=require("../shared/util");function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==typeof e&&"function"!==typeof e?t:e}function _inherits(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var AnnotationElementFactory=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"create",value:function(t){var e=t.data.annotationType;switch(e){case _util.AnnotationType.LINK:return new LinkAnnotationElement(t);case _util.AnnotationType.TEXT:return new TextAnnotationElement(t);case _util.AnnotationType.WIDGET:var n=t.data.fieldType;switch(n){case"Tx":return new TextWidgetAnnotationElement(t);case"Btn":return t.data.radioButton?new RadioButtonWidgetAnnotationElement(t):t.data.checkBox?new CheckboxWidgetAnnotationElement(t):new PushButtonWidgetAnnotationElement(t);case"Ch":return new ChoiceWidgetAnnotationElement(t)}return new WidgetAnnotationElement(t);case _util.AnnotationType.POPUP:return new PopupAnnotationElement(t);case _util.AnnotationType.LINE:return new LineAnnotationElement(t);case _util.AnnotationType.SQUARE:return new SquareAnnotationElement(t);case _util.AnnotationType.CIRCLE:return new CircleAnnotationElement(t);case _util.AnnotationType.POLYLINE:return new PolylineAnnotationElement(t);case _util.AnnotationType.INK:return new InkAnnotationElement(t);case _util.AnnotationType.POLYGON:return new PolygonAnnotationElement(t);case _util.AnnotationType.HIGHLIGHT:return new HighlightAnnotationElement(t);case _util.AnnotationType.UNDERLINE:return new UnderlineAnnotationElement(t);case _util.AnnotationType.SQUIGGLY:return new SquigglyAnnotationElement(t);case _util.AnnotationType.STRIKEOUT:return new StrikeOutAnnotationElement(t);case _util.AnnotationType.STAMP:return new StampAnnotationElement(t);case _util.AnnotationType.FILEATTACHMENT:return new FileAttachmentAnnotationElement(t);default:return new AnnotationElement(t)}}}]),t}(),AnnotationElement=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];_classCallCheck(this,t),this.isRenderable=n,this.data=e.data,this.layer=e.layer,this.page=e.page,this.viewport=e.viewport,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderInteractiveForms=e.renderInteractiveForms,this.svgFactory=e.svgFactory,n&&(this.container=this._createContainer(i))}return _createClass(t,[{key:"_createContainer",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.data,n=this.page,i=this.viewport,a=document.createElement("section"),r=e.rect[2]-e.rect[0],o=e.rect[3]-e.rect[1];a.setAttribute("data-annotation-id",e.id);var s=_util.Util.normalizeRect([e.rect[0],n.view[3]-e.rect[1]+n.view[1],e.rect[2],n.view[3]-e.rect[3]+n.view[1]]);if(a.style.transform="matrix("+i.transform.join(",")+")",a.style.transformOrigin=-s[0]+"px "+-s[1]+"px",!t&&e.borderStyle.width>0){a.style.borderWidth=e.borderStyle.width+"px",e.borderStyle.style!==_util.AnnotationBorderStyleType.UNDERLINE&&(r-=2*e.borderStyle.width,o-=2*e.borderStyle.width);var l=e.borderStyle.horizontalCornerRadius,c=e.borderStyle.verticalCornerRadius;if(l>0||c>0){var h=l+"px / "+c+"px";a.style.borderRadius=h}switch(e.borderStyle.style){case _util.AnnotationBorderStyleType.SOLID:a.style.borderStyle="solid";break;case _util.AnnotationBorderStyleType.DASHED:a.style.borderStyle="dashed";break;case _util.AnnotationBorderStyleType.BEVELED:(0,_util.warn)("Unimplemented border style: beveled");break;case _util.AnnotationBorderStyleType.INSET:(0,_util.warn)("Unimplemented border style: inset");break;case _util.AnnotationBorderStyleType.UNDERLINE:a.style.borderBottomStyle="solid";break;default:break}e.color?a.style.borderColor=_util.Util.makeCssRgb(0|e.color[0],0|e.color[1],0|e.color[2]):a.style.borderWidth=0}return a.style.left=s[0]+"px",a.style.top=s[1]+"px",a.style.width=r+"px",a.style.height=o+"px",a}},{key:"_createPopup",value:function(t,e,n){e||(e=document.createElement("div"),e.style.height=t.style.height,e.style.width=t.style.width,t.appendChild(e));var i=new PopupElement({container:t,trigger:e,color:n.color,title:n.title,contents:n.contents,hideWrapper:!0}),a=i.render();a.style.left=t.style.width,t.appendChild(a)}},{key:"render",value:function(){(0,_util.unreachable)("Abstract method `AnnotationElement.render` called")}}]),t}(),LinkAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!!(t.data.url||t.data.dest||t.data.action);return _possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){this.container.className="linkAnnotation";var t=this.data,e=this.linkService,n=document.createElement("a");return(0,_dom_utils.addLinkAttributes)(n,{url:t.url,target:t.newWindow?_dom_utils.LinkTarget.BLANK:e.externalLinkTarget,rel:e.externalLinkRel}),t.url||(t.action?this._bindNamedAction(n,t.action):this._bindLink(n,t.dest)),this.container.appendChild(n),this.container}},{key:"_bindLink",value:function(t,e){var n=this;t.href=this.linkService.getDestinationHash(e),t.onclick=function(){return e&&n.linkService.navigateTo(e),!1},e&&(t.className="internalLink")}},{key:"_bindNamedAction",value:function(t,e){var n=this;t.href=this.linkService.getAnchorUrl(""),t.onclick=function(){return n.linkService.executeNamedAction(e),!1},t.className="internalLink"}}]),e}(AnnotationElement),TextAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!!(t.data.hasPopup||t.data.title||t.data.contents);return _possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){this.container.className="textAnnotation";var t=document.createElement("img");return t.style.height=this.container.style.height,t.style.width=this.container.style.width,t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.alt="[{{type}} Annotation]",t.dataset.l10nId="text_annotation_type",t.dataset.l10nArgs=JSON.stringify({type:this.data.name}),this.data.hasPopup||this._createPopup(this.container,t,this.data),this.container.appendChild(t),this.container}}]),e}(AnnotationElement),WidgetAnnotationElement=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return this.container}}]),e}(AnnotationElement),TextWidgetAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=t.renderInteractiveForms||!t.data.hasAppearance&&!!t.data.fieldValue;return _possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=["left","center","right"];this.container.className="textWidgetAnnotation";var e=null;if(this.renderInteractiveForms){if(this.data.multiLine?(e=document.createElement("textarea"),e.textContent=this.data.fieldValue):(e=document.createElement("input"),e.type="text",e.setAttribute("value",this.data.fieldValue)),e.disabled=this.data.readOnly,null!==this.data.maxLen&&(e.maxLength=this.data.maxLen),this.data.comb){var n=this.data.rect[2]-this.data.rect[0],i=n/this.data.maxLen;e.classList.add("comb"),e.style.letterSpacing="calc("+i+"px - 1ch)"}}else{e=document.createElement("div"),e.textContent=this.data.fieldValue,e.style.verticalAlign="middle",e.style.display="table-cell";var a=null;this.data.fontRefName&&(a=this.page.commonObjs.getData(this.data.fontRefName)),this._setTextStyle(e,a)}return null!==this.data.textAlignment&&(e.style.textAlign=t[this.data.textAlignment]),this.container.appendChild(e),this.container}},{key:"_setTextStyle",value:function(t,e){var n=t.style;if(n.fontSize=this.data.fontSize+"px",n.direction=this.data.fontDirection<0?"rtl":"ltr",e){n.fontWeight=e.black?e.bold?"900":"bold":e.bold?"bold":"normal",n.fontStyle=e.italic?"italic":"normal";var i=e.loadedName?'"'+e.loadedName+'", ':"",a=e.fallbackName||"Helvetica, sans-serif";n.fontFamily=i+a}}}]),e}(WidgetAnnotationElement),CheckboxWidgetAnnotationElement=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,t.renderInteractiveForms))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){this.container.className="buttonWidgetAnnotation checkBox";var t=document.createElement("input");return t.disabled=this.data.readOnly,t.type="checkbox",this.data.fieldValue&&"Off"!==this.data.fieldValue&&t.setAttribute("checked",!0),this.container.appendChild(t),this.container}}]),e}(WidgetAnnotationElement),RadioButtonWidgetAnnotationElement=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,t.renderInteractiveForms))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){this.container.className="buttonWidgetAnnotation radioButton";var t=document.createElement("input");return t.disabled=this.data.readOnly,t.type="radio",t.name=this.data.fieldName,this.data.fieldValue===this.data.buttonValue&&t.setAttribute("checked",!0),this.container.appendChild(t),this.container}}]),e}(WidgetAnnotationElement),PushButtonWidgetAnnotationElement=function(t){function e(){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=_get(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"render",this).call(this);return t.className="buttonWidgetAnnotation pushButton",t}}]),e}(LinkAnnotationElement),ChoiceWidgetAnnotationElement=function(t){function e(t){return _classCallCheck(this,e),_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,t.renderInteractiveForms))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){this.container.className="choiceWidgetAnnotation";var t=document.createElement("select");t.disabled=this.data.readOnly,this.data.combo||(t.size=this.data.options.length,this.data.multiSelect&&(t.multiple=!0));for(var e=0,n=this.data.options.length;e<n;e++){var i=this.data.options[e],a=document.createElement("option");a.textContent=i.displayValue,a.value=i.exportValue,this.data.fieldValue.includes(i.displayValue)&&a.setAttribute("selected",!0),t.appendChild(a)}return this.container.appendChild(t),this.container}}]),e}(WidgetAnnotationElement),PopupAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!(!t.data.title&&!t.data.contents);return _possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){var t=["Line","Square","Circle","PolyLine","Polygon","Ink"];if(this.container.className="popupAnnotation",t.includes(this.data.parentType))return this.container;var e='[data-annotation-id="'+this.data.parentId+'"]',n=this.layer.querySelector(e);if(!n)return this.container;var i=new PopupElement({container:this.container,trigger:n,color:this.data.color,title:this.data.title,contents:this.data.contents}),a=parseFloat(n.style.left),r=parseFloat(n.style.width);return this.container.style.transformOrigin=-(a+r)+"px -"+n.style.top,this.container.style.left=a+r+"px",this.container.appendChild(i.render()),this.container}}]),e}(AnnotationElement),PopupElement=function(){function t(e){_classCallCheck(this,t),this.container=e.container,this.trigger=e.trigger,this.color=e.color,this.title=e.title,this.contents=e.contents,this.hideWrapper=e.hideWrapper||!1,this.pinned=!1}return _createClass(t,[{key:"render",value:function(){var t=.7,e=document.createElement("div");e.className="popupWrapper",this.hideElement=this.hideWrapper?e:this.container,this.hideElement.setAttribute("hidden",!0);var n=document.createElement("div");n.className="popup";var i=this.color;if(i){var a=t*(255-i[0])+i[0],r=t*(255-i[1])+i[1],o=t*(255-i[2])+i[2];n.style.backgroundColor=_util.Util.makeCssRgb(0|a,0|r,0|o)}var s=this._formatContents(this.contents),l=document.createElement("h1");return l.textContent=this.title,this.trigger.addEventListener("click",this._toggle.bind(this)),this.trigger.addEventListener("mouseover",this._show.bind(this,!1)),this.trigger.addEventListener("mouseout",this._hide.bind(this,!1)),n.addEventListener("click",this._hide.bind(this,!0)),n.appendChild(l),n.appendChild(s),e.appendChild(n),e}},{key:"_formatContents",value:function(t){for(var e=document.createElement("p"),n=t.split(/(?:\r\n?|\n)/),i=0,a=n.length;i<a;++i){var r=n[i];e.appendChild(document.createTextNode(r)),i<a-1&&e.appendChild(document.createElement("br"))}return e}},{key:"_toggle",value:function(){this.pinned?this._hide(!0):this._show(!0)}},{key:"_show",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];t&&(this.pinned=!0),this.hideElement.hasAttribute("hidden")&&(this.hideElement.removeAttribute("hidden"),this.container.style.zIndex+=1)}},{key:"_hide",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&(this.pinned=!1),this.hideElement.hasAttribute("hidden")||this.pinned||(this.hideElement.setAttribute("hidden",!0),this.container.style.zIndex-=1)}}]),t}(),LineAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!!(t.data.hasPopup||t.data.title||t.data.contents);return _possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,!0))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){this.container.className="lineAnnotation";var t=this.data,e=t.rect[2]-t.rect[0],n=t.rect[3]-t.rect[1],i=this.svgFactory.create(e,n),a=this.svgFactory.createElement("svg:line");return a.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),a.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),a.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),a.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),a.setAttribute("stroke-width",t.borderStyle.width),a.setAttribute("stroke","transparent"),i.appendChild(a),this.container.append(i),this._createPopup(this.container,a,t),this.container}}]),e}(AnnotationElement),SquareAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!!(t.data.hasPopup||t.data.title||t.data.contents);return _possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,!0))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){this.container.className="squareAnnotation";var t=this.data,e=t.rect[2]-t.rect[0],n=t.rect[3]-t.rect[1],i=this.svgFactory.create(e,n),a=t.borderStyle.width,r=this.svgFactory.createElement("svg:rect");return r.setAttribute("x",a/2),r.setAttribute("y",a/2),r.setAttribute("width",e-a),r.setAttribute("height",n-a),r.setAttribute("stroke-width",a),r.setAttribute("stroke","transparent"),r.setAttribute("fill","none"),i.appendChild(r),this.container.append(i),this._createPopup(this.container,r,t),this.container}}]),e}(AnnotationElement),CircleAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!!(t.data.hasPopup||t.data.title||t.data.contents);return _possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,!0))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){this.container.className="circleAnnotation";var t=this.data,e=t.rect[2]-t.rect[0],n=t.rect[3]-t.rect[1],i=this.svgFactory.create(e,n),a=t.borderStyle.width,r=this.svgFactory.createElement("svg:ellipse");return r.setAttribute("cx",e/2),r.setAttribute("cy",n/2),r.setAttribute("rx",e/2-a/2),r.setAttribute("ry",n/2-a/2),r.setAttribute("stroke-width",a),r.setAttribute("stroke","transparent"),r.setAttribute("fill","none"),i.appendChild(r),this.container.append(i),this._createPopup(this.container,r,t),this.container}}]),e}(AnnotationElement),PolylineAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!!(t.data.hasPopup||t.data.title||t.data.contents),i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,!0));return i.containerClassName="polylineAnnotation",i.svgElementName="svg:polyline",i}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){this.container.className=this.containerClassName;for(var t=this.data,e=t.rect[2]-t.rect[0],n=t.rect[3]-t.rect[1],i=this.svgFactory.create(e,n),a=t.vertices,r=[],o=0,s=a.length;o<s;o++){var l=a[o].x-t.rect[0],c=t.rect[3]-a[o].y;r.push(l+","+c)}r=r.join(" ");var h=t.borderStyle.width,u=this.svgFactory.createElement(this.svgElementName);return u.setAttribute("points",r),u.setAttribute("stroke-width",h),u.setAttribute("stroke","transparent"),u.setAttribute("fill","none"),i.appendChild(u),this.container.append(i),this._createPopup(this.container,u,t),this.container}}]),e}(AnnotationElement),PolygonAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t));return n.containerClassName="polygonAnnotation",n.svgElementName="svg:polygon",n}return _inherits(e,t),e}(PolylineAnnotationElement),InkAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!!(t.data.hasPopup||t.data.title||t.data.contents),i=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,!0));return i.containerClassName="inkAnnotation",i.svgElementName="svg:polyline",i}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){this.container.className=this.containerClassName;for(var t=this.data,e=t.rect[2]-t.rect[0],n=t.rect[3]-t.rect[1],i=this.svgFactory.create(e,n),a=t.inkLists,r=0,o=a.length;r<o;r++){for(var s=a[r],l=[],c=0,h=s.length;c<h;c++){var u=s[c].x-t.rect[0],d=t.rect[3]-s[c].y;l.push(u+","+d)}l=l.join(" ");var p=t.borderStyle.width,_=this.svgFactory.createElement(this.svgElementName);_.setAttribute("points",l),_.setAttribute("stroke-width",p),_.setAttribute("stroke","transparent"),_.setAttribute("fill","none"),this._createPopup(this.container,_,t),i.appendChild(_)}return this.container.append(i),this.container}}]),e}(AnnotationElement),HighlightAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!!(t.data.hasPopup||t.data.title||t.data.contents);return _possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,!0))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return this.container.className="highlightAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}]),e}(AnnotationElement),UnderlineAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!!(t.data.hasPopup||t.data.title||t.data.contents);return _possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,!0))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return this.container.className="underlineAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}]),e}(AnnotationElement),SquigglyAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!!(t.data.hasPopup||t.data.title||t.data.contents);return _possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,!0))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return this.container.className="squigglyAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}]),e}(AnnotationElement),StrikeOutAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!!(t.data.hasPopup||t.data.title||t.data.contents);return _possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,!0))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return this.container.className="strikeoutAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}]),e}(AnnotationElement),StampAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=!!(t.data.hasPopup||t.data.title||t.data.contents);return _possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,n,!0))}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){return this.container.className="stampAnnotation",this.data.hasPopup||this._createPopup(this.container,null,this.data),this.container}}]),e}(AnnotationElement),FileAttachmentAnnotationElement=function(t){function e(t){_classCallCheck(this,e);var n=_possibleConstructorReturn(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,!0)),i=n.data.file,a=i.filename,r=i.content;return n.filename=(0,_dom_utils.getFilenameFromUrl)(a),n.content=r,n.linkService.eventBus&&n.linkService.eventBus.dispatch("fileattachmentannotation",{source:n,id:(0,_util.stringToPDFString)(a),filename:a,content:r}),n}return _inherits(e,t),_createClass(e,[{key:"render",value:function(){this.container.className="fileAttachmentAnnotation";var t=document.createElement("div");return t.style.height=this.container.style.height,t.style.width=this.container.style.width,t.addEventListener("dblclick",this._download.bind(this)),this.data.hasPopup||!this.data.title&&!this.data.contents||this._createPopup(this.container,t,this.data),this.container.appendChild(t),this.container}},{key:"_download",value:function(){this.downloadManager?this.downloadManager.downloadData(this.content,this.filename,""):(0,_util.warn)("Download cannot be started due to unavailable download manager")}}]),e}(AnnotationElement),AnnotationLayer=function(){function t(){_classCallCheck(this,t)}return _createClass(t,null,[{key:"render",value:function(t){for(var e=0,n=t.annotations.length;e<n;e++){var i=t.annotations[e];if(i){var a=AnnotationElementFactory.create({data:i,layer:t.div,page:t.page,viewport:t.viewport,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderInteractiveForms:t.renderInteractiveForms||!1,svgFactory:new _dom_utils.DOMSVGFactory});a.isRenderable&&t.div.appendChild(a.render())}}}},{key:"update",value:function(t){for(var e=0,n=t.annotations.length;e<n;e++){var i=t.annotations[e],a=t.div.querySelector('[data-annotation-id="'+i.id+'"]');a&&(a.style.transform="matrix("+t.viewport.transform.join(",")+")")}t.div.removeAttribute("hidden")}}]),t}();exports.AnnotationLayer=AnnotationLayer;