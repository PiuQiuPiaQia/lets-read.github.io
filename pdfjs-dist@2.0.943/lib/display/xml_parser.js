"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var _slicedToArray=function(){function e(e,r){var t=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done);n=!0)if(t.push(s.value),r&&t.length===r)break}catch(u){i=!0,o=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return t}return function(r,t){if(Array.isArray(r))return r;if(Symbol.iterator in Object(r))return e(r,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_get=function e(r,t,n){null===r&&(r=Function.prototype);var i=Object.getOwnPropertyDescriptor(r,t);if(void 0===i){var o=Object.getPrototypeOf(r);return null===o?void 0:e(o,t,n)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(n):void 0},_createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}();function _possibleConstructorReturn(e,r){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!r||"object"!==typeof r&&"function"!==typeof r?e:r}function _inherits(e,r){if("function"!==typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(e,r):e.__proto__=r)}function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}var XMLParserErrorCode={NoError:0,EndOfDocument:-1,UnterminatedCdat:-2,UnterminatedXmlDeclaration:-3,UnterminatedDoctypeDeclaration:-4,UnterminatedComment:-5,MalformedElement:-6,OutOfMemory:-7,UnterminatedAttributeValue:-8,UnterminatedElement:-9,ElementNeverBegun:-10};function isWhitespace(e,r){var t=e[r];return" "===t||"\n"===t||"\r"===t||"\t"===t}function isWhitespaceString(e){for(var r=0,t=e.length;r<t;r++)if(!isWhitespace(e,r))return!1;return!0}var XMLParserBase=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"_resolveEntities",value:function(e){return e.replace(/&([^;]+);/g,(function(e,r){if("#x"===r.substring(0,2))return String.fromCharCode(parseInt(r.substring(2),16));if("#"===r.substring(0,1))return String.fromCharCode(parseInt(r.substring(1),10));switch(r){case"lt":return"<";case"gt":return">";case"amp":return"&";case"quot":return'"'}return this.onResolveEntity(r)}))}},{key:"_parseContent",value:function(e,r){var t=r,n=void 0,i=[];function o(){while(t<e.length&&isWhitespace(e,t))++t}while(t<e.length&&!isWhitespace(e,t)&&">"!==e[t]&&"/"!==e[t])++t;n=e.substring(r,t),o();while(t<e.length&&">"!==e[t]&&"/"!==e[t]&&"?"!==e[t]){o();var s="",a="";while(t<e.length&&!isWhitespace(e,t)&&"="!==e[t])s+=e[t],++t;if(o(),"="!==e[t])return null;++t,o();var u=e[t];if('"'!==u&&"'"!==u)return null;var l=e.indexOf(u,++t);if(l<0)return null;a=e.substring(t,l),i.push({name:s,value:this._resolveEntities(a)}),t=l+1,o()}return{name:n,attributes:i,parsed:t-r}}},{key:"_parseProcessingInstruction",value:function(e,r){var t=r,n=void 0,i=void 0;function o(){while(t<e.length&&isWhitespace(e,t))++t}while(t<e.length&&!isWhitespace(e,t)&&">"!==e[t]&&"/"!==e[t])++t;n=e.substring(r,t),o();var s=t;while(t<e.length&&("?"!==e[t]||">"!==e[t+1]))++t;return i=e.substring(s,t),{name:n,value:i,parsed:t-r}}},{key:"parseXml",value:function(e){var r=0;while(r<e.length){var t=e[r],n=r;if("<"===t){++n;var i=e[n],o=void 0;switch(i){case"/":if(++n,o=e.indexOf(">",n),o<0)return void this.onError(XMLParserErrorCode.UnterminatedElement);this.onEndElement(e.substring(n,o)),n=o+1;break;case"?":++n;var s=this._parseProcessingInstruction(e,n);if("?>"!==e.substring(n+s.parsed,n+s.parsed+2))return void this.onError(XMLParserErrorCode.UnterminatedXmlDeclaration);this.onPi(s.name,s.value),n+=s.parsed+2;break;case"!":if("--"===e.substring(n+1,n+3)){if(o=e.indexOf("--\x3e",n+3),o<0)return void this.onError(XMLParserErrorCode.UnterminatedComment);this.onComment(e.substring(n+3,o)),n=o+3}else if("[CDATA["===e.substring(n+1,n+8)){if(o=e.indexOf("]]>",n+8),o<0)return void this.onError(XMLParserErrorCode.UnterminatedCdat);this.onCdata(e.substring(n+8,o)),n=o+3}else{if("DOCTYPE"!==e.substring(n+1,n+8))return void this.onError(XMLParserErrorCode.MalformedElement);var a=e.indexOf("[",n+8),u=!1;if(o=e.indexOf(">",n+8),o<0)return void this.onError(XMLParserErrorCode.UnterminatedDoctypeDeclaration);if(a>0&&o>a){if(o=e.indexOf("]>",n+8),o<0)return void this.onError(XMLParserErrorCode.UnterminatedDoctypeDeclaration);u=!0}var l=e.substring(n+8,o+(u?1:0));this.onDoctype(l),n=o+(u?2:1)}break;default:var c=this._parseContent(e,n);if(null===c)return void this.onError(XMLParserErrorCode.MalformedElement);var h=!1;if("/>"===e.substring(n+c.parsed,n+c.parsed+2))h=!0;else if(">"!==e.substring(n+c.parsed,n+c.parsed+1))return void this.onError(XMLParserErrorCode.UnterminatedElement);this.onBeginElement(c.name,c.attributes,h),n+=c.parsed+(h?2:1);break}}else{while(n<e.length&&"<"!==e[n])n++;var d=e.substring(r,n);this.onText(this._resolveEntities(d))}r=n}}},{key:"onResolveEntity",value:function(e){return"&"+e+";"}},{key:"onPi",value:function(e,r){}},{key:"onComment",value:function(e){}},{key:"onCdata",value:function(e){}},{key:"onDoctype",value:function(e){}},{key:"onText",value:function(e){}},{key:"onBeginElement",value:function(e,r,t){}},{key:"onEndElement",value:function(e){}},{key:"onError",value:function(e){}}]),e}(),SimpleDOMNode=function(){function e(r,t){_classCallCheck(this,e),this.nodeName=r,this.nodeValue=t,Object.defineProperty(this,"parentNode",{value:null,writable:!0})}return _createClass(e,[{key:"hasChildNodes",value:function(){return this.childNodes&&this.childNodes.length>0}},{key:"firstChild",get:function(){return this.childNodes[0]}},{key:"nextSibling",get:function(){var e=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[e+1]}},{key:"textContent",get:function(){return this.childNodes?this.childNodes.map((function(e){return e.textContent})).join(""):this.nodeValue||""}}]),e}(),SimpleXMLParser=function(e){function r(){_classCallCheck(this,r);var e=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return e._currentFragment=null,e._stack=null,e._errorCode=XMLParserErrorCode.NoError,e}return _inherits(r,e),_createClass(r,[{key:"parseFromString",value:function(e){if(this._currentFragment=[],this._stack=[],this._errorCode=XMLParserErrorCode.NoError,this.parseXml(e),this._errorCode===XMLParserErrorCode.NoError){var r=_slicedToArray(this._currentFragment,1),t=r[0];if(t)return{documentElement:t}}}},{key:"onResolveEntity",value:function(e){switch(e){case"apos":return"'"}return _get(r.prototype.__proto__||Object.getPrototypeOf(r.prototype),"onResolveEntity",this).call(this,e)}},{key:"onText",value:function(e){if(!isWhitespaceString(e)){var r=new SimpleDOMNode("#text",e);this._currentFragment.push(r)}}},{key:"onCdata",value:function(e){var r=new SimpleDOMNode("#text",e);this._currentFragment.push(r)}},{key:"onBeginElement",value:function(e,r,t){var n=new SimpleDOMNode(e);n.childNodes=[],this._currentFragment.push(n),t||(this._stack.push(this._currentFragment),this._currentFragment=n.childNodes)}},{key:"onEndElement",value:function(e){this._currentFragment=this._stack.pop();for(var r=this._currentFragment[this._currentFragment.length-1],t=0,n=r.childNodes.length;t<n;t++)r.childNodes[t].parentNode=r}},{key:"onError",value:function(e){this._errorCode=e}}]),r}(XMLParserBase);exports.SimpleXMLParser=SimpleXMLParser;