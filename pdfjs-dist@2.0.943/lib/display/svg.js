"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SVGGraphics=void 0;var _util=require("../shared/util"),_dom_utils=require("./dom_utils"),_is_node=require("../shared/is_node"),_is_node2=_interopRequireDefault(_is_node);function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}var SVGGraphics=function(){throw new Error("Not implemented: SVGGraphics")},SVG_DEFAULTS={fontStyle:"normal",fontWeight:"normal",fillColor:"#000000"},convertImgDataToPng=function(){for(var t=new Uint8Array([137,80,78,71,13,10,26,10]),e=12,i=new Int32Array(256),r=0;r<256;r++){for(var n=r,s=0;s<8;s++)n=1&n?3988292384^n>>1&2147483647:n>>1&2147483647;i[r]=n}function a(t,e,r){for(var n=-1,s=e;s<r;s++){var a=255&(n^t[s]),l=i[a];n=n>>>8^l}return-1^n}function l(t,e,i,r){var n=r,s=e.length;i[n]=s>>24&255,i[n+1]=s>>16&255,i[n+2]=s>>8&255,i[n+3]=255&s,n+=4,i[n]=255&t.charCodeAt(0),i[n+1]=255&t.charCodeAt(1),i[n+2]=255&t.charCodeAt(2),i[n+3]=255&t.charCodeAt(3),n+=4,i.set(e,n),n+=e.length;var l=a(i,r+4,n);i[n]=l>>24&255,i[n+1]=l>>16&255,i[n+2]=l>>8&255,i[n+3]=255&l}function o(t,e,i){for(var r=1,n=0,s=e;s<i;++s)r=(r+(255&t[s]))%65521,n=(n+r)%65521;return n<<16|r}function u(t){if(!(0,_is_node2.default)())return h(t);try{var e;e=parseInt(process.versions.node)>=8?t:new Buffer(t);var i=require("zlib").deflateSync(e,{level:9});return i instanceof Uint8Array?i:new Uint8Array(i)}catch(r){(0,_util.warn)("Not compressing PNG because zlib.deflateSync is unavailable: "+r)}return h(t)}function h(t){var e=t.length,i=65535,r=Math.ceil(e/i),n=new Uint8Array(2+e+5*r+4),s=0;n[s++]=120,n[s++]=156;var a=0;while(e>i)n[s++]=0,n[s++]=255,n[s++]=255,n[s++]=0,n[s++]=0,n.set(t.subarray(a,a+i),s),s+=i,a+=i,e-=i;n[s++]=1,n[s++]=255&e,n[s++]=e>>8&255,n[s++]=255&~e,n[s++]=(65535&~e)>>8&255,n.set(t.subarray(a),s),s+=t.length-a;var l=o(t,0,t.length);return n[s++]=l>>24&255,n[s++]=l>>16&255,n[s++]=l>>8&255,n[s++]=255&l,n}function c(i,r,n,s){var a,o,h,c=i.width,p=i.height,f=i.data;switch(r){case _util.ImageKind.GRAYSCALE_1BPP:o=0,a=1,h=c+7>>3;break;case _util.ImageKind.RGB_24BPP:o=2,a=8,h=3*c;break;case _util.ImageKind.RGBA_32BPP:o=6,a=8,h=4*c;break;default:throw new Error("invalid format")}var d,S,g=new Uint8Array((1+h)*p),b=0,m=0;for(d=0;d<p;++d)g[b++]=0,g.set(f.subarray(m,m+h),b),m+=h,b+=h;if(r===_util.ImageKind.GRAYSCALE_1BPP&&s)for(b=0,d=0;d<p;d++)for(b++,S=0;S<h;S++)g[b++]^=255;var v=new Uint8Array([c>>24&255,c>>16&255,c>>8&255,255&c,p>>24&255,p>>16&255,p>>8&255,255&p,a,o,0,0,0]),_=u(g),x=t.length+3*e+v.length+_.length,A=new Uint8Array(x),k=0;return A.set(t,k),k+=t.length,l("IHDR",v,A,k),k+=e+v.length,l("IDATA",_,A,k),k+=e+_.length,l("IEND",new Uint8Array(0),A,k),(0,_util.createObjectURL)(A,"image/png",n)}return function(t,e,i){var r=void 0===t.kind?_util.ImageKind.GRAYSCALE_1BPP:t.kind;return c(t,r,e,i)}}(),SVGExtraState=function(){function t(){this.fontSizeScale=1,this.fontWeight=SVG_DEFAULTS.fontWeight,this.fontSize=0,this.textMatrix=_util.IDENTITY_MATRIX,this.fontMatrix=_util.FONT_IDENTITY_MATRIX,this.leading=0,this.textRenderingMode=_util.TextRenderingMode.FILL,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRise=0,this.fillColor=SVG_DEFAULTS.fillColor,this.strokeColor="#000000",this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.lineJoin="",this.lineCap="",this.miterLimit=0,this.dashArray=[],this.dashPhase=0,this.dependencies=[],this.activeClipUrl=null,this.clipGroup=null,this.maskId=""}return t.prototype={clone:function(){return Object.create(this)},setCurrentPoint:function(t,e){this.x=t,this.y=e}},t}();exports.SVGGraphics=SVGGraphics=function(){function t(t){for(var e=[],i=[],r=t.length,n=0;n<r;n++)"save"!==t[n].fn?"restore"===t[n].fn?e=i.pop():e.push(t[n]):(e.push({fnId:92,fn:"group",items:[]}),i.push(e),e=e[e.length-1].items);return e}function e(t){if(Number.isInteger(t))return t.toString();var e=t.toFixed(10),i=e.length-1;if("0"!==e[i])return e;do{i--}while("0"===e[i]);return e.substring(0,"."===e[i]?i:i+1)}function i(t){if(0===t[4]&&0===t[5]){if(0===t[1]&&0===t[2])return 1===t[0]&&1===t[3]?"":"scale("+e(t[0])+" "+e(t[3])+")";if(t[0]===t[3]&&t[1]===-t[2]){var i=180*Math.acos(t[0])/Math.PI;return"rotate("+e(i)+")"}}else if(1===t[0]&&0===t[1]&&0===t[2]&&1===t[3])return"translate("+e(t[4])+" "+e(t[5])+")";return"matrix("+e(t[0])+" "+e(t[1])+" "+e(t[2])+" "+e(t[3])+" "+e(t[4])+" "+e(t[5])+")"}function r(t,e,i){this.svgFactory=new _dom_utils.DOMSVGFactory,this.current=new SVGExtraState,this.transformMatrix=_util.IDENTITY_MATRIX,this.transformStack=[],this.extraStack=[],this.commonObjs=t,this.objs=e,this.pendingClip=null,this.pendingEOFill=!1,this.embedFonts=!1,this.embeddedFonts=Object.create(null),this.cssStyle=null,this.forceDataSchema=!!i}var n="http://www.w3.org/XML/1998/namespace",s="http://www.w3.org/1999/xlink",a=["butt","round","square"],l=["miter","round","bevel"],o=0,u=0;return r.prototype={save:function(){this.transformStack.push(this.transformMatrix);var t=this.current;this.extraStack.push(t),this.current=t.clone()},restore:function(){this.transformMatrix=this.transformStack.pop(),this.current=this.extraStack.pop(),this.pendingClip=null,this.tgrp=null},group:function(t){this.save(),this.executeOpTree(t),this.restore()},loadDependencies:function(t){for(var e=this,i=t.fnArray,r=i.length,n=t.argsArray,s=0;s<r;s++)if(_util.OPS.dependency===i[s])for(var a=n[s],l=0,o=a.length;l<o;l++){var u,h=a[l],c="g_"===h.substring(0,2);u=new Promise(c?function(t){e.commonObjs.get(h,t)}:function(t){e.objs.get(h,t)}),this.current.dependencies.push(u)}return Promise.all(this.current.dependencies)},transform:function(t,e,i,r,n,s){var a=[t,e,i,r,n,s];this.transformMatrix=_util.Util.transform(this.transformMatrix,a),this.tgrp=null},getSVG:function(t,e){var i=this;this.viewport=e;var r=this._initialize(e);return this.loadDependencies(t).then((function(){i.transformMatrix=_util.IDENTITY_MATRIX;var e=i.convertOpList(t);return i.executeOpTree(e),r}))},convertOpList:function(e){var i=e.argsArray,r=e.fnArray,n=r.length,s=[],a=[];for(var l in _util.OPS)s[_util.OPS[l]]=l;for(var o=0;o<n;o++){var u=r[o];a.push({fnId:u,fn:s[u],args:i[o]})}return t(a)},executeOpTree:function(t){for(var e=t.length,i=0;i<e;i++){var r=t[i].fn,n=t[i].fnId,s=t[i].args;switch(0|n){case _util.OPS.beginText:this.beginText();break;case _util.OPS.dependency:break;case _util.OPS.setLeading:this.setLeading(s);break;case _util.OPS.setLeadingMoveText:this.setLeadingMoveText(s[0],s[1]);break;case _util.OPS.setFont:this.setFont(s);break;case _util.OPS.showText:this.showText(s[0]);break;case _util.OPS.showSpacedText:this.showText(s[0]);break;case _util.OPS.endText:this.endText();break;case _util.OPS.moveText:this.moveText(s[0],s[1]);break;case _util.OPS.setCharSpacing:this.setCharSpacing(s[0]);break;case _util.OPS.setWordSpacing:this.setWordSpacing(s[0]);break;case _util.OPS.setHScale:this.setHScale(s[0]);break;case _util.OPS.setTextMatrix:this.setTextMatrix(s[0],s[1],s[2],s[3],s[4],s[5]);break;case _util.OPS.setTextRise:this.setTextRise(s[0]);break;case _util.OPS.setTextRenderingMode:this.setTextRenderingMode(s[0]);break;case _util.OPS.setLineWidth:this.setLineWidth(s[0]);break;case _util.OPS.setLineJoin:this.setLineJoin(s[0]);break;case _util.OPS.setLineCap:this.setLineCap(s[0]);break;case _util.OPS.setMiterLimit:this.setMiterLimit(s[0]);break;case _util.OPS.setFillRGBColor:this.setFillRGBColor(s[0],s[1],s[2]);break;case _util.OPS.setStrokeRGBColor:this.setStrokeRGBColor(s[0],s[1],s[2]);break;case _util.OPS.setDash:this.setDash(s[0],s[1]);break;case _util.OPS.setGState:this.setGState(s[0]);break;case _util.OPS.fill:this.fill();break;case _util.OPS.eoFill:this.eoFill();break;case _util.OPS.stroke:this.stroke();break;case _util.OPS.fillStroke:this.fillStroke();break;case _util.OPS.eoFillStroke:this.eoFillStroke();break;case _util.OPS.clip:this.clip("nonzero");break;case _util.OPS.eoClip:this.clip("evenodd");break;case _util.OPS.paintSolidColorImageMask:this.paintSolidColorImageMask();break;case _util.OPS.paintJpegXObject:this.paintJpegXObject(s[0],s[1],s[2]);break;case _util.OPS.paintImageXObject:this.paintImageXObject(s[0]);break;case _util.OPS.paintInlineImageXObject:this.paintInlineImageXObject(s[0]);break;case _util.OPS.paintImageMaskXObject:this.paintImageMaskXObject(s[0]);break;case _util.OPS.paintFormXObjectBegin:this.paintFormXObjectBegin(s[0],s[1]);break;case _util.OPS.paintFormXObjectEnd:this.paintFormXObjectEnd();break;case _util.OPS.closePath:this.closePath();break;case _util.OPS.closeStroke:this.closeStroke();break;case _util.OPS.closeFillStroke:this.closeFillStroke();break;case _util.OPS.closeEOFillStroke:this.closeEOFillStroke();break;case _util.OPS.nextLine:this.nextLine();break;case _util.OPS.transform:this.transform(s[0],s[1],s[2],s[3],s[4],s[5]);break;case _util.OPS.constructPath:this.constructPath(s[0],s[1]);break;case _util.OPS.endPath:this.endPath();break;case 92:this.group(t[i].items);break;default:(0,_util.warn)("Unimplemented operator "+r);break}}},setWordSpacing:function(t){this.current.wordSpacing=t},setCharSpacing:function(t){this.current.charSpacing=t},nextLine:function(){this.moveText(0,this.current.leading)},setTextMatrix:function(t,i,r,n,s,a){var l=this.current;this.current.textMatrix=this.current.lineMatrix=[t,i,r,n,s,a],this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,l.xcoords=[],l.tspan=this.svgFactory.createElement("svg:tspan"),l.tspan.setAttributeNS(null,"font-family",l.fontFamily),l.tspan.setAttributeNS(null,"font-size",e(l.fontSize)+"px"),l.tspan.setAttributeNS(null,"y",e(-l.y)),l.txtElement=this.svgFactory.createElement("svg:text"),l.txtElement.appendChild(l.tspan)},beginText:function(){this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.current.textMatrix=_util.IDENTITY_MATRIX,this.current.lineMatrix=_util.IDENTITY_MATRIX,this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.txtElement=this.svgFactory.createElement("svg:text"),this.current.txtgrp=this.svgFactory.createElement("svg:g"),this.current.xcoords=[]},moveText:function(t,i){var r=this.current;this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=i,r.xcoords=[],r.tspan=this.svgFactory.createElement("svg:tspan"),r.tspan.setAttributeNS(null,"font-family",r.fontFamily),r.tspan.setAttributeNS(null,"font-size",e(r.fontSize)+"px"),r.tspan.setAttributeNS(null,"y",e(-r.y))},showText:function(t){var r=this.current,s=r.font,a=r.fontSize;if(0!==a){var l,o=r.charSpacing,u=r.wordSpacing,h=r.fontDirection,c=r.textHScale*h,p=t.length,f=s.vertical,d=a*r.fontMatrix[0],S=0;for(l=0;l<p;++l){var g=t[l];if(null!==g)if((0,_util.isNum)(g))S+=-g*a*.001;else{var b=g.width,m=g.fontChar,v=(g.isSpace?u:0)+o,_=b*d+v*h;g.isInFont||s.missingFile?(r.xcoords.push(r.x+S*c),r.tspan.textContent+=m,S+=_):S+=_}else S+=h*u}f?r.y-=S*c:r.x+=S*c,r.tspan.setAttributeNS(null,"x",r.xcoords.map(e).join(" ")),r.tspan.setAttributeNS(null,"y",e(-r.y)),r.tspan.setAttributeNS(null,"font-family",r.fontFamily),r.tspan.setAttributeNS(null,"font-size",e(r.fontSize)+"px"),r.fontStyle!==SVG_DEFAULTS.fontStyle&&r.tspan.setAttributeNS(null,"font-style",r.fontStyle),r.fontWeight!==SVG_DEFAULTS.fontWeight&&r.tspan.setAttributeNS(null,"font-weight",r.fontWeight);var x=r.textRenderingMode&_util.TextRenderingMode.FILL_STROKE_MASK;x===_util.TextRenderingMode.FILL||x===_util.TextRenderingMode.FILL_STROKE?(r.fillColor!==SVG_DEFAULTS.fillColor&&r.tspan.setAttributeNS(null,"fill",r.fillColor),r.fillAlpha<1&&r.tspan.setAttributeNS(null,"fill-opacity",r.fillAlpha)):r.textRenderingMode===_util.TextRenderingMode.ADD_TO_PATH?r.tspan.setAttributeNS(null,"fill","transparent"):r.tspan.setAttributeNS(null,"fill","none"),x!==_util.TextRenderingMode.STROKE&&x!==_util.TextRenderingMode.FILL_STROKE||this._setStrokeAttributes(r.tspan);var A=r.textMatrix;0!==r.textRise&&(A=A.slice(),A[5]+=r.textRise),r.txtElement.setAttributeNS(null,"transform",i(A)+" scale(1, -1)"),r.txtElement.setAttributeNS(n,"xml:space","preserve"),r.txtElement.appendChild(r.tspan),r.txtgrp.appendChild(r.txtElement),this._ensureTransformGroup().appendChild(r.txtElement)}},setLeadingMoveText:function(t,e){this.setLeading(-e),this.moveText(t,e)},addFontStyle:function(t){this.cssStyle||(this.cssStyle=this.svgFactory.createElement("svg:style"),this.cssStyle.setAttributeNS(null,"type","text/css"),this.defs.appendChild(this.cssStyle));var e=(0,_util.createObjectURL)(t.data,t.mimetype,this.forceDataSchema);this.cssStyle.textContent+='@font-face { font-family: "'+t.loadedName+'"; src: url('+e+"); }\n"},setFont:function(t){var i=this.current,r=this.commonObjs.get(t[0]),n=t[1];this.current.font=r,this.embedFonts&&r.data&&!this.embeddedFonts[r.loadedName]&&(this.addFontStyle(r),this.embeddedFonts[r.loadedName]=r),i.fontMatrix=r.fontMatrix?r.fontMatrix:_util.FONT_IDENTITY_MATRIX;var s=r.black?r.bold?"bolder":"bold":r.bold?"bold":"normal",a=r.italic?"italic":"normal";n<0?(n=-n,i.fontDirection=-1):i.fontDirection=1,i.fontSize=n,i.fontFamily=r.loadedName,i.fontWeight=s,i.fontStyle=a,i.tspan=this.svgFactory.createElement("svg:tspan"),i.tspan.setAttributeNS(null,"y",e(-i.y)),i.xcoords=[]},endText:function(){var t=this.current;t.textRenderingMode&_util.TextRenderingMode.ADD_TO_PATH_FLAG&&t.txtElement&&t.txtElement.hasChildNodes()&&(t.element=t.txtElement,this.clip("nonzero"),this.endPath())},setLineWidth:function(t){this.current.lineWidth=t},setLineCap:function(t){this.current.lineCap=a[t]},setLineJoin:function(t){this.current.lineJoin=l[t]},setMiterLimit:function(t){this.current.miterLimit=t},setStrokeAlpha:function(t){this.current.strokeAlpha=t},setStrokeRGBColor:function(t,e,i){var r=_util.Util.makeCssRgb(t,e,i);this.current.strokeColor=r},setFillAlpha:function(t){this.current.fillAlpha=t},setFillRGBColor:function(t,e,i){var r=_util.Util.makeCssRgb(t,e,i);this.current.fillColor=r,this.current.tspan=this.svgFactory.createElement("svg:tspan"),this.current.xcoords=[]},setDash:function(t,e){this.current.dashArray=t,this.current.dashPhase=e},constructPath:function(t,i){var r=this.current,n=r.x,s=r.y;r.path=this.svgFactory.createElement("svg:path");for(var a=[],l=t.length,o=0,u=0;o<l;o++)switch(0|t[o]){case _util.OPS.rectangle:n=i[u++],s=i[u++];var h=i[u++],c=i[u++],p=n+h,f=s+c;a.push("M",e(n),e(s),"L",e(p),e(s),"L",e(p),e(f),"L",e(n),e(f),"Z");break;case _util.OPS.moveTo:n=i[u++],s=i[u++],a.push("M",e(n),e(s));break;case _util.OPS.lineTo:n=i[u++],s=i[u++],a.push("L",e(n),e(s));break;case _util.OPS.curveTo:n=i[u+4],s=i[u+5],a.push("C",e(i[u]),e(i[u+1]),e(i[u+2]),e(i[u+3]),e(n),e(s)),u+=6;break;case _util.OPS.curveTo2:n=i[u+2],s=i[u+3],a.push("C",e(n),e(s),e(i[u]),e(i[u+1]),e(i[u+2]),e(i[u+3])),u+=4;break;case _util.OPS.curveTo3:n=i[u+2],s=i[u+3],a.push("C",e(i[u]),e(i[u+1]),e(n),e(s),e(n),e(s)),u+=4;break;case _util.OPS.closePath:a.push("Z");break}r.path.setAttributeNS(null,"d",a.join(" ")),r.path.setAttributeNS(null,"fill","none"),this._ensureTransformGroup().appendChild(r.path),r.element=r.path,r.setCurrentPoint(n,s)},endPath:function(){if(this.pendingClip){var t=this.current,e="clippath"+o;o++;var r=this.svgFactory.createElement("svg:clipPath");r.setAttributeNS(null,"id",e),r.setAttributeNS(null,"transform",i(this.transformMatrix));var n=t.element.cloneNode(!0);"evenodd"===this.pendingClip?n.setAttributeNS(null,"clip-rule","evenodd"):n.setAttributeNS(null,"clip-rule","nonzero"),this.pendingClip=null,r.appendChild(n),this.defs.appendChild(r),t.activeClipUrl&&(t.clipGroup=null,this.extraStack.forEach((function(t){t.clipGroup=null})),r.setAttributeNS(null,"clip-path",t.activeClipUrl)),t.activeClipUrl="url(#"+e+")",this.tgrp=null}},clip:function(t){this.pendingClip=t},closePath:function(){var t=this.current;if(t.path){var e=t.path.getAttributeNS(null,"d");e+="Z",t.path.setAttributeNS(null,"d",e)}},setLeading:function(t){this.current.leading=-t},setTextRise:function(t){this.current.textRise=t},setTextRenderingMode:function(t){this.current.textRenderingMode=t},setHScale:function(t){this.current.textHScale=t/100},setGState:function(t){for(var e=0,i=t.length;e<i;e++){var r=t[e],n=r[0],s=r[1];switch(n){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"Font":this.setFont(s);break;case"CA":this.setStrokeAlpha(s);break;case"ca":this.setFillAlpha(s);break;default:(0,_util.warn)("Unimplemented graphic state "+n);break}}},fill:function(){var t=this.current;t.element&&(t.element.setAttributeNS(null,"fill",t.fillColor),t.element.setAttributeNS(null,"fill-opacity",t.fillAlpha),this.endPath())},stroke:function(){var t=this.current;t.element&&(this._setStrokeAttributes(t.element),t.element.setAttributeNS(null,"fill","none"),this.endPath())},_setStrokeAttributes:function(t){var i=this.current;t.setAttributeNS(null,"stroke",i.strokeColor),t.setAttributeNS(null,"stroke-opacity",i.strokeAlpha),t.setAttributeNS(null,"stroke-miterlimit",e(i.miterLimit)),t.setAttributeNS(null,"stroke-linecap",i.lineCap),t.setAttributeNS(null,"stroke-linejoin",i.lineJoin),t.setAttributeNS(null,"stroke-width",e(i.lineWidth)+"px"),t.setAttributeNS(null,"stroke-dasharray",i.dashArray.map(e).join(" ")),t.setAttributeNS(null,"stroke-dashoffset",e(i.dashPhase)+"px")},eoFill:function(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fill()},fillStroke:function(){this.stroke(),this.fill()},eoFillStroke:function(){this.current.element&&this.current.element.setAttributeNS(null,"fill-rule","evenodd"),this.fillStroke()},closeStroke:function(){this.closePath(),this.stroke()},closeFillStroke:function(){this.closePath(),this.fillStroke()},closeEOFillStroke:function(){this.closePath(),this.eoFillStroke()},paintSolidColorImageMask:function(){var t=this.current,e=this.svgFactory.createElement("svg:rect");e.setAttributeNS(null,"x","0"),e.setAttributeNS(null,"y","0"),e.setAttributeNS(null,"width","1px"),e.setAttributeNS(null,"height","1px"),e.setAttributeNS(null,"fill",t.fillColor),this._ensureTransformGroup().appendChild(e)},paintJpegXObject:function(t,i,r){var n=this.objs.get(t),a=this.svgFactory.createElement("svg:image");a.setAttributeNS(s,"xlink:href",n.src),a.setAttributeNS(null,"width",e(i)),a.setAttributeNS(null,"height",e(r)),a.setAttributeNS(null,"x","0"),a.setAttributeNS(null,"y",e(-r)),a.setAttributeNS(null,"transform","scale("+e(1/i)+" "+e(-1/r)+")"),this._ensureTransformGroup().appendChild(a)},paintImageXObject:function(t){var e=this.objs.get(t);e?this.paintInlineImageXObject(e):(0,_util.warn)("Dependent image isn't ready yet")},paintInlineImageXObject:function(t,i){var r=t.width,n=t.height,a=convertImgDataToPng(t,this.forceDataSchema,!!i),l=this.svgFactory.createElement("svg:rect");l.setAttributeNS(null,"x","0"),l.setAttributeNS(null,"y","0"),l.setAttributeNS(null,"width",e(r)),l.setAttributeNS(null,"height",e(n)),this.current.element=l,this.clip("nonzero");var o=this.svgFactory.createElement("svg:image");o.setAttributeNS(s,"xlink:href",a),o.setAttributeNS(null,"x","0"),o.setAttributeNS(null,"y",e(-n)),o.setAttributeNS(null,"width",e(r)+"px"),o.setAttributeNS(null,"height",e(n)+"px"),o.setAttributeNS(null,"transform","scale("+e(1/r)+" "+e(-1/n)+")"),i?i.appendChild(o):this._ensureTransformGroup().appendChild(o)},paintImageMaskXObject:function(t){var i=this.current,r=t.width,n=t.height,s=i.fillColor;i.maskId="mask"+u++;var a=this.svgFactory.createElement("svg:mask");a.setAttributeNS(null,"id",i.maskId);var l=this.svgFactory.createElement("svg:rect");l.setAttributeNS(null,"x","0"),l.setAttributeNS(null,"y","0"),l.setAttributeNS(null,"width",e(r)),l.setAttributeNS(null,"height",e(n)),l.setAttributeNS(null,"fill",s),l.setAttributeNS(null,"mask","url(#"+i.maskId+")"),this.defs.appendChild(a),this._ensureTransformGroup().appendChild(l),this.paintInlineImageXObject(t,a)},paintFormXObjectBegin:function(t,i){if(Array.isArray(t)&&6===t.length&&this.transform(t[0],t[1],t[2],t[3],t[4],t[5]),Array.isArray(i)&&4===i.length){var r=i[2]-i[0],n=i[3]-i[1],s=this.svgFactory.createElement("svg:rect");s.setAttributeNS(null,"x",i[0]),s.setAttributeNS(null,"y",i[1]),s.setAttributeNS(null,"width",e(r)),s.setAttributeNS(null,"height",e(n)),this.current.element=s,this.clip("nonzero"),this.endPath()}},paintFormXObjectEnd:function(){},_initialize:function(t){var e=this.svgFactory.create(t.width,t.height),r=this.svgFactory.createElement("svg:defs");e.appendChild(r),this.defs=r;var n=this.svgFactory.createElement("svg:g");return n.setAttributeNS(null,"transform",i(t.transform)),e.appendChild(n),this.svg=n,e},_ensureClipGroup:function(){if(!this.current.clipGroup){var t=this.svgFactory.createElement("svg:g");t.setAttributeNS(null,"clip-path",this.current.activeClipUrl),this.svg.appendChild(t),this.current.clipGroup=t}return this.current.clipGroup},_ensureTransformGroup:function(){return this.tgrp||(this.tgrp=this.svgFactory.createElement("svg:g"),this.tgrp.setAttributeNS(null,"transform",i(this.transformMatrix)),this.current.activeClipUrl?this._ensureClipGroup().appendChild(this.tgrp):this.svg.appendChild(this.tgrp)),this.tgrp}},r}(),exports.SVGGraphics=SVGGraphics;