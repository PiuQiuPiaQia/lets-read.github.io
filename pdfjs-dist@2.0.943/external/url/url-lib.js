(function(){"use strict";var t=Object.create(null);t["ftp"]=21,t["file"]=0,t["gopher"]=70,t["http"]=80,t["https"]=443,t["ws"]=80,t["wss"]=443;var e=Object.create(null);function s(e){return void 0!==t[e]}function i(){c.call(this),this._isInvalid=!0}function h(t){return""===t&&i.call(this),t.toLowerCase()}function a(t){var e=t.charCodeAt(0);return e>32&&e<127&&-1===[34,35,60,62,63,96].indexOf(e)?t:encodeURIComponent(t)}function r(t){var e=t.charCodeAt(0);return e>32&&e<127&&-1===[34,35,60,62,96].indexOf(e)?t:encodeURIComponent(t)}e["%2e"]=".",e[".%2e"]="..",e["%2e."]="..",e["%2e%2e"]="..";var n,o=/[a-zA-Z]/,l=/[a-zA-Z0-9\+\-\.]/;function _(_,c,u){function p(t){y.push(t)}var f=c||"scheme start",m=0,v="",d=!1,g=!1,y=[];t:while((_[m-1]!==n||0===m)&&!this._isInvalid){var w=_[m];switch(f){case"scheme start":if(!w||!o.test(w)){if(c){p("Invalid scheme.");break t}v="",f="no scheme";continue}v+=w.toLowerCase(),f="scheme";break;case"scheme":if(w&&l.test(w))v+=w.toLowerCase();else{if(":"!==w){if(c){if(w===n)break t;p("Code point not allowed in scheme: "+w);break t}v="",m=0,f="no scheme";continue}if(this._scheme=v,v="",c)break t;s(this._scheme)&&(this._isRelative=!0),f="file"===this._scheme?"relative":this._isRelative&&u&&u._scheme===this._scheme?"relative or authority":this._isRelative?"authority first slash":"scheme data"}break;case"scheme data":"?"===w?(this._query="?",f="query"):"#"===w?(this._fragment="#",f="fragment"):w!==n&&"\t"!==w&&"\n"!==w&&"\r"!==w&&(this._schemeData+=a(w));break;case"no scheme":if(u&&s(u._scheme)){f="relative";continue}p("Missing scheme."),i.call(this);break;case"relative or authority":if("/"!==w||"/"!==_[m+1]){p("Expected /, got: "+w),f="relative";continue}f="authority ignore slashes";break;case"relative":if(this._isRelative=!0,"file"!==this._scheme&&(this._scheme=u._scheme),w===n){this._host=u._host,this._port=u._port,this._path=u._path.slice(),this._query=u._query,this._username=u._username,this._password=u._password;break t}if("/"===w||"\\"===w)"\\"===w&&p("\\ is an invalid code point."),f="relative slash";else if("?"===w)this._host=u._host,this._port=u._port,this._path=u._path.slice(),this._query="?",this._username=u._username,this._password=u._password,f="query";else{if("#"!==w){var b=_[m+1],k=_[m+2];("file"!==this._scheme||!o.test(w)||":"!==b&&"|"!==b||k!==n&&"/"!==k&&"\\"!==k&&"?"!==k&&"#"!==k)&&(this._host=u._host,this._port=u._port,this._username=u._username,this._password=u._password,this._path=u._path.slice(),this._path.pop()),f="relative path";continue}this._host=u._host,this._port=u._port,this._path=u._path.slice(),this._query=u._query,this._fragment="#",this._username=u._username,this._password=u._password,f="fragment"}break;case"relative slash":if("/"!==w&&"\\"!==w){"file"!==this._scheme&&(this._host=u._host,this._port=u._port,this._username=u._username,this._password=u._password),f="relative path";continue}"\\"===w&&p("\\ is an invalid code point."),f="file"===this._scheme?"file host":"authority ignore slashes";break;case"authority first slash":if("/"!==w){p("Expected '/', got: "+w),f="authority ignore slashes";continue}f="authority second slash";break;case"authority second slash":if(f="authority ignore slashes","/"!==w){p("Expected '/', got: "+w);continue}break;case"authority ignore slashes":if("/"!==w&&"\\"!==w){f="authority";continue}p("Expected authority, got: "+w);break;case"authority":if("@"===w){d&&(p("@ already seen."),v+="%40"),d=!0;for(var I=0;I<v.length;I++){var q=v[I];if("\t"!==q&&"\n"!==q&&"\r"!==q)if(":"!==q||null!==this._password){var R=a(q);null!==this._password?this._password+=R:this._username+=R}else this._password="";else p("Invalid whitespace in authority.")}v=""}else{if(w===n||"/"===w||"\\"===w||"?"===w||"#"===w){m-=v.length,v="",f="host";continue}v+=w}break;case"file host":if(w===n||"/"===w||"\\"===w||"?"===w||"#"===w){2!==v.length||!o.test(v[0])||":"!==v[1]&&"|"!==v[1]?(0===v.length||(this._host=h.call(this,v),v=""),f="relative path start"):f="relative path";continue}"\t"===w||"\n"===w||"\r"===w?p("Invalid whitespace in file host."):v+=w;break;case"host":case"hostname":if(":"!==w||g){if(w===n||"/"===w||"\\"===w||"?"===w||"#"===w){if(this._host=h.call(this,v),v="",f="relative path start",c)break t;continue}"\t"!==w&&"\n"!==w&&"\r"!==w?("["===w?g=!0:"]"===w&&(g=!1),v+=w):p("Invalid code point in host/hostname: "+w)}else if(this._host=h.call(this,v),v="",f="port","hostname"===c)break t;break;case"port":if(/[0-9]/.test(w))v+=w;else{if(w===n||"/"===w||"\\"===w||"?"===w||"#"===w||c){if(""!==v){var C=parseInt(v,10);C!==t[this._scheme]&&(this._port=C+""),v=""}if(c)break t;f="relative path start";continue}"\t"===w||"\n"===w||"\r"===w?p("Invalid code point in port: "+w):i.call(this)}break;case"relative path start":if("\\"===w&&p("'\\' not allowed in path."),f="relative path","/"!==w&&"\\"!==w)continue;break;case"relative path":var x;if(w!==n&&"/"!==w&&"\\"!==w&&(c||"?"!==w&&"#"!==w))"\t"!==w&&"\n"!==w&&"\r"!==w&&(v+=a(w));else"\\"===w&&p("\\ not allowed in relative path."),(x=e[v.toLowerCase()])&&(v=x),".."===v?(this._path.pop(),"/"!==w&&"\\"!==w&&this._path.push("")):"."===v&&"/"!==w&&"\\"!==w?this._path.push(""):"."!==v&&("file"===this._scheme&&0===this._path.length&&2===v.length&&o.test(v[0])&&"|"===v[1]&&(v=v[0]+":"),this._path.push(v)),v="","?"===w?(this._query="?",f="query"):"#"===w&&(this._fragment="#",f="fragment");break;case"query":c||"#"!==w?w!==n&&"\t"!==w&&"\n"!==w&&"\r"!==w&&(this._query+=r(w)):(this._fragment="#",f="fragment");break;case"fragment":w!==n&&"\t"!==w&&"\n"!==w&&"\r"!==w&&(this._fragment+=w);break}m++}}function c(){this._scheme="",this._schemeData="",this._username="",this._password=null,this._host="",this._port="",this._path=[],this._query="",this._fragment="",this._isInvalid=!1,this._isRelative=!1}function u(t,e){void 0===e||e instanceof u||(e=new u(String(e))),this._url=t,c.call(this);var s=t.replace(/^[ \t\r\n\f]+|[ \t\r\n\f]+$/g,"");_.call(this,s,null,e)}u.prototype={toString(){return this.href},get href(){if(this._isInvalid)return this._url;var t="";return""===this._username&&null===this._password||(t=this._username+(null!==this._password?":"+this._password:"")+"@"),this.protocol+(this._isRelative?"//"+t+this.host:"")+this.pathname+this._query+this._fragment},set href(t){c.call(this),_.call(this,t)},get protocol(){return this._scheme+":"},set protocol(t){this._isInvalid||_.call(this,t+":","scheme start")},get host(){return this._isInvalid?"":this._port?this._host+":"+this._port:this._host},set host(t){!this._isInvalid&&this._isRelative&&_.call(this,t,"host")},get hostname(){return this._host},set hostname(t){!this._isInvalid&&this._isRelative&&_.call(this,t,"hostname")},get port(){return this._port},set port(t){!this._isInvalid&&this._isRelative&&_.call(this,t,"port")},get pathname(){return this._isInvalid?"":this._isRelative?"/"+this._path.join("/"):this._schemeData},set pathname(t){!this._isInvalid&&this._isRelative&&(this._path=[],_.call(this,t,"relative path start"))},get search(){return this._isInvalid||!this._query||"?"===this._query?"":this._query},set search(t){!this._isInvalid&&this._isRelative&&(this._query="?","?"===t[0]&&(t=t.slice(1)),_.call(this,t,"query"))},get hash(){return this._isInvalid||!this._fragment||"#"===this._fragment?"":this._fragment},set hash(t){this._isInvalid||(this._fragment="#","#"===t[0]&&(t=t.slice(1)),_.call(this,t,"fragment"))},get origin(){var t;if(this._isInvalid||!this._scheme)return"";switch(this._scheme){case"data":case"file":case"javascript":case"mailto":return"null";case"blob":try{return new u(this._schemeData).origin||"null"}catch(e){}return"null"}return t=this.host,t?this._scheme+"://"+t:""}},exports.URL=u})();